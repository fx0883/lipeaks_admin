# 订单基础管理功能

## 1. 概述

订单基础管理功能是订单管理模块的核心，包括订单的创建、查询、编辑、详情查看和删除等功能。这些功能构成了订单管理的基础业务流程，是其他高级功能的前提。

## 2. 功能列表

订单基础管理功能包括以下几个主要部分：

1. **订单列表页**：显示订单列表，支持分页、排序和筛选
2. **订单创建页**：创建新订单的表单页面
3. **订单编辑页**：编辑现有订单的表单页面
4. **订单详情页**：查看订单详细信息
5. **订单删除**：删除订单（软删除）

## 3. 订单列表页

订单列表页是用户进入订单管理模块的首页，提供订单数据的概览和操作入口。

### 3.1 功能描述

- 展示订单列表，包含关键信息字段
- 提供高级搜索和筛选功能
- 支持多种排序方式
- 支持批量操作和单条记录操作
- 提供分页浏览功能
- 显示统计信息摘要

### 3.2 界面设计

订单列表页面布局如下：

```
+------------------------------------------------------------------+
| 订单管理                                          创建订单 导出   |
+------------------------------------------------------------------+
| [搜索框]                     高级搜索                             |
+------------------------------------------------------------------+
| 筛选条件: 服务类型 [下拉] | 支付状态 [下拉] | 语种 [下拉] | 更多 |
+------------------------------------------------------------------+
| [ ] 全选 | 批量操作 [下拉]          已选择: 0 项 共计: 120 项    |
+------------------------------------------------------------------+
| 订单编号 | 客户名称 | 服务类型 | 语种 | 金额 | 支付状态 | 操作   |
+------------------------------------------------------------------+
| PQ-2..   | 公司A   | 翻译    | 中英 | ¥1000| 已支付   | 详情.. |
|------------------------------------------------------------------|
| PQ-2..   | 公司B   | 口译    | 中日 | ¥2000| 未支付   | 详情.. |
|------------------------------------------------------------------|
| ...      | ...     | ...     | ... | ...  | ...      | ...    |
+------------------------------------------------------------------+
|  << 1 2 3 4 5 ... >> | 跳转至 [  ] 页 | 每页 [10 ▼] 条          |
+------------------------------------------------------------------+
```

### 3.3 筛选条件

订单列表页支持以下筛选条件：

1. **服务类型**：
   - 全部
   - 文档翻译
   - 口译服务
   - 校对服务
   - 其他服务类型

2. **支付状态**：
   - 全部
   - 已支付
   - 未支付

3. **语种**：
   - 全部
   - 中英
   - 中日
   - 中韩
   - 其他语种组合

4. **客户类型**：
   - 全部
   - 新客户
   - 老客户

5. **服务时间范围**：日期选择器

6. **关键词搜索**：支持搜索订单编号、客户名称、译员、项目经理等

### 3.4 数据表格

订单列表表格包含以下字段：

1. **基础信息**：
   - 订单编号
   - 客户名称
   - 联系人
   - 下单日期

2. **服务信息**：
   - 服务类型
   - 语种
   - 服务时间
   - 项目经理

3. **财务信息**：
   - 客户总价
   - 毛利
   - 毛利率
   - 支付状态

4. **操作栏**：
   - 详情按钮
   - 编辑按钮
   - 更多操作（删除、复制等）

### 3.5 排序功能

支持按以下字段排序：

- 创建时间（默认降序）
- 订单日期
- 客户总金额
- 支付状态

### 3.6 批量操作功能

支持以下批量操作：

- 批量导出
- 批量更新支付状态
- 批量删除

## 4. 订单创建页

订单创建页用于新建订单，采用分步骤表单的形式，提高用户体验。

### 4.1 功能描述

- 通过分步表单创建新订单
- 提供字段验证和错误提示
- 支持表单暂存和恢复
- 支持客户和联系人选择
- 支持服务类型和支付方式的选择
- 自动计算毛利和毛利率

### 4.2 界面设计

创建订单表单分为多个步骤：

```
+------------------------------------------------------------------+
| 创建订单                                               返回列表   |
+------------------------------------------------------------------+
| 步骤: [1.基本信息] > [2.服务信息] > [3.价格信息] > [4.其他信息]  |
+------------------------------------------------------------------+
|                                                                  |
| 第一步: 基本信息                                                 |
|                                                                  |
| 客户: [下拉选择框 ▼]                       [+新建客户]          |
| 联系人: [下拉选择框 ▼]                     [+新建联系人]        |
| 来源平台: [输入框]                                              |
| 项目负责人: [输入框]                                            |
| 客户类型: [下拉选择框 ▼]                                        |
| 下单日期: [日期选择器]                                          |
|                                                                  |
|                                       [上一步] [下一步]          |
+------------------------------------------------------------------+
```

第二步 - 服务信息:

```
+------------------------------------------------------------------+
| 创建订单                                               返回列表   |
+------------------------------------------------------------------+
| 步骤: [1.基本信息] > [2.服务信息] > [3.价格信息] > [4.其他信息]  |
+------------------------------------------------------------------+
|                                                                  |
| 第二步: 服务信息                                                 |
|                                                                  |
| 服务类型: [下拉选择框 ▼]                                        |
| 语种: [下拉选择框 ▼]                                            |
| 客户数量: [输入框]                                              |
| 翻译数量: [输入框]                                              |
| 服务时间: [日期选择器]                                          |
| 项目地点: [输入框]                                              |
| 译员: [输入框]                                                  |
|                                                                  |
|                                       [上一步] [下一步]          |
+------------------------------------------------------------------+
```

第三步 - 价格信息:

```
+------------------------------------------------------------------+
| 创建订单                                               返回列表   |
+------------------------------------------------------------------+
| 步骤: [1.基本信息] > [2.服务信息] > [3.价格信息] > [4.其他信息]  |
+------------------------------------------------------------------+
|                                                                  |
| 第三步: 价格信息                                                 |
|                                                                  |
| 客户单价: [输入框]                                              |
| 客户总价: [输入框]                                              |
| 译员单价: [输入框]                                              |
| 译员费用: [输入框]                                              |
| 译员支付状态: [下拉选择框 ▼]                                    |
| 译员支付方式: [下拉选择框 ▼]                                    |
| 项目费用: [输入框]                                              |
|                                                                  |
| 毛利: ¥500.00                     毛利率: 25.00%                |
|                                                                  |
|                                       [上一步] [下一步]          |
+------------------------------------------------------------------+
```

第四步 - 其他信息:

```
+------------------------------------------------------------------+
| 创建订单                                               返回列表   |
+------------------------------------------------------------------+
| 步骤: [1.基本信息] > [2.服务信息] > [3.价格信息] > [4.其他信息]  |
+------------------------------------------------------------------+
|                                                                  |
| 第四步: 其他信息                                                 |
|                                                                  |
| 支付状态: [下拉选择框 ▼]                                        |
| 支付日期: [日期选择器]                                          |
| 支付方式: [下拉选择框 ▼]                                        |
| 支付备注: [输入框]                                              |
|                                                                  |
| 发票状态: [下拉选择框 ▼]                                        |
| 发票信息: [输入框]                                              |
|                                                                  |
| 备注: [多行文本框]                                              |
| 回访记录: [多行文本框]                                          |
|                                                                  |
|                             [上一步] [保存草稿] [提交]           |
+------------------------------------------------------------------+
```

### 4.3 表单验证规则

- **必填字段验证**：
  - 客户
  - 服务类型
  - 语种
  - 客户数量
  - 客户总价

- **格式验证**：
  - 日期格式验证
  - 金额格式验证（数字且大于等于0）
  - 电话/邮箱格式验证

- **业务规则验证**：
  - 如果支付状态为"已支付"，则支付日期和支付方式为必填
  - 如果发票状态为"已开具"，则发票信息为必填

### 4.4 自动计算功能

- **毛利计算**：客户总价 - 译员费用 - 项目费用
- **毛利率计算**：毛利 / 客户总价 * 100%

## 5. 订单编辑页

订单编辑页用于修改现有订单信息，布局与创建页类似，但预填充了现有订单数据。

### 5.1 功能描述

- 加载并显示现有订单数据
- 支持修改除订单编号外的所有字段
- 记录修改历史，生成新版本
- 提供表单验证和错误提示
- 可以取消编辑，返回详情页

### 5.2 界面设计

编辑订单表单与创建订单表单结构相同，但会预先填充已有订单数据。页面顶部增加版本信息显示：

```
+------------------------------------------------------------------+
| 编辑订单 #PQ-202507-1234 (当前版本: 2)                  返回详情 |
+------------------------------------------------------------------+
| 步骤: [1.基本信息] > [2.服务信息] > [3.价格信息] > [4.其他信息]  |
+------------------------------------------------------------------+
|                                                                  |
| ... (各步骤表单，与创建订单类似)                                 |
|                                                                  |
|                             [取消] [保存草稿] [提交]             |
+------------------------------------------------------------------+
```

### 5.3 版本控制

- 编辑订单时，系统自动记录修改内容
- 每次保存生成新的历史版本记录
- 保存字段变更的前后值，便于比较和审计

## 6. 订单详情页

订单详情页用于查看订单的完整信息，并提供各种操作入口。

### 6.1 功能描述

- 展示订单的所有信息，分类显示
- 显示订单的创建和修改历史
- 提供编辑、删除、导出等操作入口
- 显示订单的关联客户和联系人信息
- 显示订单历史版本信息
- 提供版本比较功能

### 6.2 界面设计

```
+------------------------------------------------------------------+
| 订单详情 #PQ-202507-1234                                返回列表 |
+------------------------------------------------------------------+
| [编辑] [删除] [导出] [历史版本] [更多操作 ▼]                     |
+------------------------------------------------------------------+
|                                                                  |
| 基本信息                                                         |
| +-----------------------------------------------------------------+
| | 订单编号: PQ-202507-1234    | 创建时间: 2025-07-10 11:22:33    |
| | 客户: 北京科技有限公司      | 联系人: 李四                      |
| | 来源平台: 官网             | 项目负责人: 五组                  |
| | 客户类型: 老客户           | 下单日期: 2025-07-10             |
| +-----------------------------------------------------------------+
|                                                                  |
| 服务信息                                                         |
| +-----------------------------------------------------------------+
| | 服务类型: 文档翻译         | 语种: 中英                        |
| | 客户数量: 5000字           | 翻译数量: 5000字                  |
| | 服务时间: 2025-07-15       | 项目地点: 线上                    |
| | 译员: 张三                 |                                   |
| +-----------------------------------------------------------------+
|                                                                  |
| 价格信息                                                         |
| +-----------------------------------------------------------------+
| | 客户单价: 0.3元/字         | 客户总价: ¥1500.00                |
| | 译员单价: 0.15元/字        | 译员费用: ¥750.00                 |
| | 项目费用: ¥50.00           | 毛利: ¥700.00 (46.67%)           |
| | 项目明细: 技术文档翻译     | 费用明细: 版式调整费用50元        |
| +-----------------------------------------------------------------+
|                                                                  |
| 支付信息                                                         |
| +-----------------------------------------------------------------+
| | 支付状态: 已支付           | 支付日期: 2025-07-20              |
| | 支付方式: 微信支付         | 支付备注:                         |
| | 发票状态: 待开具           | 发票信息: 需要开具增值税专用发票  |
| +-----------------------------------------------------------------+
|                                                                  |
| 其他信息                                                         |
| +-----------------------------------------------------------------+
| | 备注: 客户要求保持原文格式                                     |
| | 回访记录:                                                      |
| +-----------------------------------------------------------------+
|                                                                  |
| 版本历史                                                         |
| +-----------------------------------------------------------------+
| | 版本3: 2025-07-12 更新支付状态 (admin)                         |
| | 版本2: 2025-07-11 更新译员信息 (admin)                         |
| | 版本1: 2025-07-10 创建订单 (admin)                             |
| +-----------------------------------------------------------------+
+------------------------------------------------------------------+
```

### 6.3 详情页标签页

详情页可以采用标签页形式组织不同类别的信息：

1. **基本信息**：订单基础信息和客户信息
2. **服务信息**：服务类型、语种、数量等
3. **价格信息**：客户价格、译员费用、项目费用、毛利等
4. **支付信息**：支付状态、支付方式、发票信息等
5. **历史记录**：订单的版本历史和变更记录

## 7. 订单删除功能

订单删除采用软删除方式，保留数据但在界面上隐藏。

### 7.1 功能描述

- 支持单条订单删除
- 支持批量订单删除
- 删除前需二次确认
- 软删除实现，标记is_deleted=true
- 可通过API恢复已删除订单（如有需要）

### 7.2 界面设计

删除确认对话框：

```
+------------------------------------------------------------------+
|                          确认删除                                |
+------------------------------------------------------------------+
|                                                                  |
|  您确定要删除订单 #PQ-202507-1234 吗？                          |
|                                                                  |
|  此操作将无法撤销，但数据仍会保留在系统中。                      |
|                                                                  |
|                                        [取消] [确认删除]         |
+------------------------------------------------------------------+
```

批量删除确认对话框：

```
+------------------------------------------------------------------+
|                          确认批量删除                            |
+------------------------------------------------------------------+
|                                                                  |
|  您确定要删除所选的 5 个订单吗？                                |
|                                                                  |
|  此操作将无法撤销，但数据仍会保留在系统中。                      |
|                                                                  |
|                                        [取消] [确认删除]         |
+------------------------------------------------------------------+
```

## 8. 订单状态管理

### 8.1 订单支付状态

订单支付状态的管理是订单生命周期的重要部分：

- **未支付（unpaid）**：新创建订单的默认状态
- **已支付（paid）**：客户已完成支付

支付状态变更时，需要记录支付日期、支付方式和备注等信息。

### 8.2 订单发票状态

订单发票状态的管理：

- **无需开具（not_required）**：客户不需要发票
- **待开具（pending）**：需要开具发票但尚未开具
- **已开具（issued）**：已开具发票

发票状态变更时，需要记录发票信息。

## 9. 业务流程

### 9.1 创建订单流程

1. 用户点击"创建订单"按钮
2. 系统显示分步骤创建表单
3. 用户填写基本信息，选择客户和联系人
4. 用户填写服务信息
5. 用户填写价格信息
6. 用户填写其他信息
7. 用户提交表单
8. 系统验证表单数据
9. 系统创建订单并生成订单编号
10. 系统创建历史记录（版本1）
11. 系统显示成功消息，并跳转到订单详情页

### 9.2 编辑订单流程

1. 用户在订单列表或详情页点击"编辑"按钮
2. 系统加载订单数据并显示编辑表单
3. 用户修改订单信息
4. 用户提交表单
5. 系统验证表单数据
6. 系统更新订单信息
7. 系统创建新的历史记录（新版本）
8. 系统显示成功消息，并跳转到订单详情页

### 9.3 删除订单流程

1. 用户在订单列表或详情页点击"删除"按钮
2. 系统显示确认对话框
3. 用户确认删除
4. 系统将订单标记为已删除（is_deleted=true）
5. 系统在列表中隐藏该订单
6. 系统显示成功消息

## 10. 异常处理

### 10.1 表单验证错误

- 显示具体的错误消息，指出错误字段
- 保留用户已输入的数据
- 自动滚动到第一个错误字段位置

### 10.2 服务器错误

- 显示友好的错误提示
- 提供重试选项
- 记录错误日志，便于排查

### 10.3 并发编辑冲突

- 检测并发编辑情况
- 提示用户数据已被他人修改
- 提供刷新选项，加载最新数据 