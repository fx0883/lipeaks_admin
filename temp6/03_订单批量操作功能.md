# 订单批量操作功能

## 1. 概述

订单批量操作功能是提升管理效率的重要工具，包括批量导入导出、批量更新和批量删除等功能，使管理员能够高效地处理大量订单数据，减少重复操作。

## 2. 功能列表

订单批量操作功能包括以下几个主要部分：

1. **数据导出**：将订单数据导出为Excel或CSV文件
2. **数据导入**：从Excel文件导入订单数据
3. **批量更新**：批量更新多个订单的状态或其他字段
4. **批量删除**：批量删除多个订单

## 3. 数据导出功能

数据导出功能用于将订单数据导出为Excel或CSV文件，便于离线分析、报表生成或数据备份。

### 3.1 功能描述

- 支持导出当前筛选条件下的订单列表
- 支持导出选中的订单
- 支持导出所有订单
- 支持多种导出格式（Excel、CSV）
- 支持自定义导出字段

### 3.2 界面设计

导出订单对话框：

```
+------------------------------------------------------------------+
|                          导出订单                                |
+------------------------------------------------------------------+
|                                                                  |
| 导出范围:                                                        |
| O 所有订单                                                       |
| O 当前筛选条件下的订单 (共120条)                                 |
| O 选中的订单 (共5条)                                             |
|                                                                  |
| 导出格式:                                                        |
| O Excel (.xlsx)                                                  |
| O CSV (.csv)                                                     |
|                                                                  |
| 导出字段:                                                        |
| [✓] 基本信息 (订单编号、客户名称、下单日期...)                   |
| [✓] 服务信息 (服务类型、语种、数量...)                           |
| [✓] 价格信息 (客户价格、译员费用、毛利...)                       |
| [✓] 支付信息 (支付状态、支付方式、发票信息...)                   |
| [✓] 其他信息 (备注、回访记录...)                                 |
|                                                                  |
|                                       [取消] [确认导出]          |
+------------------------------------------------------------------+
```

### 3.3 导出文件格式

#### Excel 格式

导出的Excel文件将包含以下工作表：

1. **订单列表**：包含所有订单的主要信息
2. **统计摘要**：包含导出数据的统计信息

每个工作表的表头将包含字段名称，并应用适当的格式化（如日期、货币等）。

#### CSV 格式

CSV格式将导出为单一文件，包含所有选定的字段，以逗号分隔。

### 3.4 导出流程

1. 用户点击"导出"按钮
2. 系统显示导出选项对话框
3. 用户选择导出范围、格式和字段
4. 用户点击"确认导出"
5. 系统处理数据并生成文件
6. 浏览器下载生成的文件

## 4. 数据导入功能

数据导入功能用于从Excel文件批量导入订单数据，快速创建或更新大量订单。

### 4.1 功能描述

- 支持从Excel文件导入订单数据
- 支持创建新订单或更新现有订单
- 提供数据验证和错误报告
- 支持模板下载
- 支持导入预览和确认

### 4.2 界面设计

导入订单步骤界面：

```
+------------------------------------------------------------------+
|                          导入订单                                |
+------------------------------------------------------------------+
|                                                                  |
| 步骤: [1.下载模板] > [2.上传文件] > [3.预览确认] > [4.导入完成]  |
+------------------------------------------------------------------+
|                                                                  |
| 第一步: 下载导入模板                                             |
|                                                                  |
| 导入模板说明:                                                    |
| 1. 请使用提供的模板格式填写订单信息                              |
| 2. 必填字段: 客户ID/名称、服务类型、语种、客户数量、客户总价     |
| 3. 日期格式: YYYY-MM-DD                                         |
| 4. 数量和金额请使用纯数字，不要包含单位                          |
|                                                                  |
| [下载Excel导入模板]                                             |
|                                                                  |
|                                       [取消] [下一步]            |
+------------------------------------------------------------------+
```

第二步 - 上传文件:

```
+------------------------------------------------------------------+
|                          导入订单                                |
+------------------------------------------------------------------+
|                                                                  |
| 步骤: [1.下载模板] > [2.上传文件] > [3.预览确认] > [4.导入完成]  |
+------------------------------------------------------------------+
|                                                                  |
| 第二步: 上传文件                                                 |
|                                                                  |
| 选择Excel文件:                                                   |
|                                                                  |
| [          选择文件          ] 或 将文件拖放到此处               |
|                                                                  |
| 导入选项:                                                        |
| [✓] 更新现有订单 (如果订单编号或客户ID与服务类型组合已存在)      |
| [ ] 导入时忽略错误行                                             |
|                                                                  |
|                                     [上一步] [取消] [下一步]     |
+------------------------------------------------------------------+
```

第三步 - 预览确认:

```
+------------------------------------------------------------------+
|                          导入订单                                |
+------------------------------------------------------------------+
|                                                                  |
| 步骤: [1.下载模板] > [2.上传文件] > [3.预览确认] > [4.导入完成]  |
+------------------------------------------------------------------+
|                                                                  |
| 第三步: 预览确认                                                 |
|                                                                  |
| 文件解析结果:                                                    |
| - 总记录数: 50条                                                |
| - 有效记录: 45条                                                |
| - 错误记录: 5条                                                 |
|                                                                  |
| 数据预览:                                                        |
| +-----------------------------------------------------------------+
| | 状态 | 客户名称 | 服务类型 | 语种 | 客户数量 | 客户总价 | 错误信息 |
| +-----------------------------------------------------------------+
| | 有效 | 公司A   | 翻译    | 中英 | 5000字  | 1500.00 |          |
| | 错误 | 公司B   |         | 中日 | 3000字  | 1200.00 | 服务类型必填 |
| | ...  | ...     | ...     | ... | ...     | ...     | ...      |
| +-----------------------------------------------------------------+
|                                                                  |
| [下载错误报告]                                                  |
|                                                                  |
|                                [上一步] [取消] [开始导入]        |
+------------------------------------------------------------------+
```

第四步 - 导入完成:

```
+------------------------------------------------------------------+
|                          导入订单                                |
+------------------------------------------------------------------+
|                                                                  |
| 步骤: [1.下载模板] > [2.上传文件] > [3.预览确认] > [4.导入完成]  |
+------------------------------------------------------------------+
|                                                                  |
| 第四步: 导入完成                                                 |
|                                                                  |
| 导入结果:                                                        |
| - 总记录数: 45条                                                |
| - 成功创建: 30条                                                |
| - 成功更新: 10条                                                |
| - 失败记录: 5条                                                 |
|                                                                  |
| [查看导入的订单]                                                |
| [下载导入结果报告]                                              |
|                                                                  |
|                                          [完成] [再次导入]       |
+------------------------------------------------------------------+
```

### 4.3 导入模板设计

导入模板将包含以下工作表：

1. **说明**：包含导入说明、字段解释和示例
2. **订单数据**：包含导入数据的表格，标记必填字段

订单数据表格将包含以下主要字段：

- 客户名称/ID（必填）
- 联系人名称/ID（可选）
- 服务类型（必填）
- 语种（必填）
- 客户数量（必填）
- 客户总价（必填）
- 其他可选字段（如下单日期、服务时间、译员信息等）

### 4.4 数据验证规则

在导入过程中，系统将执行以下验证：

1. **必填字段验证**：确保所有必填字段均有值
2. **格式验证**：确保日期、数字等格式正确
3. **参照完整性**：确保客户ID和联系人ID在系统中存在
4. **业务规则验证**：确保数据符合业务规则（如正数金额）

### 4.5 导入流程

1. 用户下载导入模板
2. 用户填写模板并上传文件
3. 系统验证文件格式和数据有效性
4. 系统显示预览和错误报告
5. 用户确认导入
6. 系统执行导入操作
7. 系统显示导入结果
8. 用户可以查看导入的订单或下载结果报告

## 5. 批量更新功能

批量更新功能允许用户同时更新多个订单的特定字段，提高工作效率。

### 5.1 功能描述

- 支持批量更新选中订单的指定字段
- 支持常用字段的批量更新（如支付状态、发票状态）
- 提供操作确认和结果反馈
- 保留操作历史记录

### 5.2 界面设计

批量更新对话框：

```
+------------------------------------------------------------------+
|                          批量更新订单                            |
+------------------------------------------------------------------+
|                                                                  |
| 选中订单: 5 条                                                   |
|                                                                  |
| 更新字段:                                                        |
| [支付状态 ▼]                                                    |
|                                                                  |
| 新值:                                                            |
| [已支付 ▼]                                                      |
|                                                                  |
| 关联字段:                                                        |
| 支付日期: [2025-07-20]                                          |
| 支付方式: [微信支付 ▼]                                          |
| 支付备注: [批量更新]                                            |
|                                                                  |
|                                         [取消] [确认更新]        |
+------------------------------------------------------------------+
```

### 5.3 可批量更新的字段

以下字段支持批量更新：

1. **支付信息**：
   - 支付状态
   - 支付方式
   - 支付日期
   - 发票状态

2. **服务信息**：
   - 服务时间
   - 项目负责人
   - 项目地点

3. **其他信息**：
   - 订单状态（如有）
   - 备注（追加或覆盖）

### 5.4 批量更新流程

1. 用户在订单列表中选择多个订单
2. 用户点击"批量操作"并选择"批量更新"
3. 系统显示批量更新对话框
4. 用户选择要更新的字段和新值
5. 用户点击"确认更新"
6. 系统显示确认对话框，列出将受影响的订单数量
7. 用户确认操作
8. 系统执行批量更新
9. 系统为每个更新的订单创建历史记录
10. 系统显示更新结果

## 6. 批量删除功能

批量删除功能允许用户同时删除多个订单，提高工作效率。

### 6.1 功能描述

- 支持批量删除选中的订单
- 提供二次确认机制，防止误操作
- 显示操作结果反馈
- 采用软删除方式，保留数据但在界面上隐藏

### 6.2 界面设计

批量删除确认对话框：

```
+------------------------------------------------------------------+
|                          批量删除订单                            |
+------------------------------------------------------------------+
|                                                                  |
| 您确定要删除以下 5 个订单吗？                                    |
|                                                                  |
| - PQ-202507-1234 (北京科技有限公司)                             |
| - PQ-202507-1235 (上海环球公司)                                 |
| - PQ-202507-1236 (广州贸易有限公司)                             |
| - PQ-202507-1237 (深圳电子科技有限公司)                         |
| - PQ-202507-1238 (杭州互联网公司)                               |
|                                                                  |
| 此操作将无法撤销，但数据仍会保留在系统中。                        |
|                                                                  |
|                                        [取消] [确认删除]         |
+------------------------------------------------------------------+
```

### 6.3 批量删除流程

1. 用户在订单列表中选择多个订单
2. 用户点击"批量操作"并选择"批量删除"
3. 系统显示批量删除确认对话框
4. 用户确认操作
5. 系统执行批量删除（软删除）
6. 系统更新列表，移除已删除的订单
7. 系统显示操作结果

## 7. 批量操作结果展示

对于所有批量操作，系统都应提供清晰的结果反馈，包括成功和失败的详细信息。

### 7.1 结果对话框

批量操作结果对话框：

```
+------------------------------------------------------------------+
|                          操作结果                                |
+------------------------------------------------------------------+
|                                                                  |
| 批量更新订单结果:                                                |
|                                                                  |
| ✓ 成功处理: 4 个订单                                            |
| ✗ 处理失败: 1 个订单                                            |
|                                                                  |
| 失败详情:                                                        |
| - PQ-202507-1238: 数据验证错误 - 支付日期格式无效               |
|                                                                  |
|                                           [关闭] [查看详情]      |
+------------------------------------------------------------------+
```

### 7.2 结果通知

除了结果对话框，系统还应在页面顶部显示简要的操作结果通知：

```
+------------------------------------------------------------------+
| ✓ 成功更新4个订单，1个订单处理失败                               |
+------------------------------------------------------------------+
```

## 8. 权限控制

批量操作功能应设置适当的权限控制，确保只有授权用户才能执行这些操作。

### 8.1 权限设置

- 导出权限：普通用户可能只能导出自己负责的订单
- 导入权限：可能只限于管理员或特定角色
- 批量更新权限：可能需要特定角色
- 批量删除权限：可能只限于高级管理员

### 8.2 权限检查

在显示批量操作按钮或执行批量操作前，系统应检查用户权限，并根据权限控制功能的可见性和可用性。

## 9. 异常处理

### 9.1 导入异常处理

- 文件格式错误：显示友好错误提示，说明所需格式
- 数据验证错误：生成详细的错误报告，指出每行的具体问题
- 导入中断：提供恢复机制，避免重复导入

### 9.2 批量操作异常处理

- 部分成功/部分失败：显示详细的成功/失败记录
- 全部失败：显示失败原因，提供修复建议
- 操作超时：提供异步处理机制，避免长时间等待

## 10. 性能优化

为确保批量操作不影响系统性能，应采取以下优化措施：

### 10.1 分批处理

- 大量记录导入时采用分批处理
- 每批次处理后更新进度条
- 提供取消操作选项

### 10.2 异步处理

- 长时间运行的批量操作应异步处理
- 用户可以在操作完成前执行其他任务
- 操作完成后通过系统通知通知用户

### 10.3 限制批处理大小

- 设置单次导入的最大记录数
- 设置单次批量更新/删除的最大记录数
- 超出限制时提供分批处理建议 