# 客户管理功能页面设计

## 1. 页面结构概览

客户管理功能包含以下几个主要页面：

```
views/
  customer/
    index.vue            # 客户列表页面
    detail.vue           # 客户详情页面
    create.vue           # 客户创建页面
    edit.vue             # 客户编辑页面
```

## 2. 页面详细设计

### 2.1 客户列表页面 (index.vue)

#### 页面描述
客户列表页面是客户管理功能的主入口，提供客户列表的展示、搜索、筛选和基本操作功能。

#### 页面布局
```
+--------------------------------------------------------------+
| 标题栏 "客户管理"                           [创建] [批量操作] |
+--------------------------------------------------------------+
| 筛选区域                                                     |
| +----------------------------------------------------------+ |
| | 搜索框 | 客户类型▼ | 价值等级▼ | 状态▼ | [筛选] [重置]   | |
| +----------------------------------------------------------+ |
+--------------------------------------------------------------+
| 客户列表                                                     |
| +----------------------------------------------------------+ |
| | 客户名称 | 类型 | 价值等级 | 状态 | 联系人 | 电话 | 操作  | |
| |----------------------------------------------------------|  |
| | 客户A    | 公司 | VIP     | 活跃 | 张三   | 1380 | [...] | |
| | 客户B    | 个人 | 普通    | 活跃 | 李四   | 1390 | [...] | |
| | ...      | ...  | ...     | ...  | ...    | ...  | ...   | |
| +----------------------------------------------------------+ |
+--------------------------------------------------------------+
| 分页控件  < 1 2 3 ... >  共XX条记录                          |
+--------------------------------------------------------------+
```

#### 数据与状态
```typescript
// 表格加载状态
const tableLoading = computed(() => customerStore.loading.list);

// 表格数据
const customerList = computed(() => customerStore.customerList.data);

// 分页信息
const pagination = reactive({
  total: computed(() => customerStore.customerList.total),
  currentPage: 1,
  pageSize: 10
});

// 搜索条件
const searchForm = reactive({
  search: "",
  type: "all",
  value_level: "all",
  status: "all",
  industry_type: "",
  company_size: ""
});

// 类型选项
const typeOptions = [
  { value: "all", label: t("customer.typeAll") },
  { value: "company", label: t("customer.typeCompany") },
  { value: "individual", label: t("customer.typeIndividual") },
  { value: "government", label: t("customer.typeGovernment") },
  { value: "non_profit", label: t("customer.typeNonProfit") }
];

// 价值等级选项
const valueLevelOptions = [
  { value: "all", label: t("customer.valueLevelAll") },
  { value: "vip", label: t("customer.valueLevelVip") },
  { value: "high", label: t("customer.valueLevelHigh") },
  { value: "normal", label: t("customer.valueLevelNormal") },
  { value: "low", label: t("customer.valueLevelLow") }
];

// 状态选项
const statusOptions = [
  { value: "all", label: t("customer.statusAll") },
  { value: "active", label: t("customer.statusActive") },
  { value: "inactive", label: t("customer.statusInactive") },
  { value: "potential", label: t("customer.statusPotential") },
  { value: "deleted", label: t("customer.statusDeleted") }
];

// 确认对话框状态
const confirmDialog = reactive({
  visible: false,
  title: "",
  content: "",
  type: "warning" as "warning" | "danger" | "info",
  loading: false,
  confirmCallback: null as (() => void) | null
});

// 创建客户对话框状态
const createCustomerDialog = reactive({
  visible: false,
  loading: false
});

// 批量操作对话框状态
const batchOperationDialog = reactive({
  visible: false,
  loading: false,
  operation: "create" as "create" | "update" | "delete"
});
```

#### 主要功能与交互

1. **页面加载**
   - 页面加载时，调用`fetchCustomerList`获取客户列表
   - 根据用户权限决定是否显示批量操作按钮

2. **搜索与筛选**
   - 用户输入搜索关键词
   - 用户选择客户类型、价值等级和状态等筛选条件
   - 点击筛选按钮时，调用`fetchCustomerList`获取筛选结果
   - 点击重置按钮时，清空筛选条件并刷新列表

3. **客户操作**
   - 点击查看按钮，跳转到客户详情页面
   - 点击编辑按钮，跳转到客户编辑页面
   - 点击删除按钮，显示确认对话框
   - 确认删除后，调用`removeCustomer`删除客户

4. **创建客户**
   - 点击创建按钮，显示创建客户对话框
   - 填写表单并提交，调用`createCustomer`创建客户
   - 创建成功后，刷新客户列表

5. **批量操作**
   - 点击批量操作按钮，显示批量操作下拉菜单
   - 选择批量创建、批量更新或批量删除
   - 显示对应的批量操作对话框
   - 提交批量操作，调用相应的API

6. **分页控制**
   - 点击分页按钮，切换页码
   - 切换每页显示条数
   - 页码或每页条数变化时，刷新客户列表

#### 权限控制
- 超级管理员可以查看所有客户
- 租户管理员只能查看与其租户相关的客户
- 根据用户权限决定是否显示创建、编辑和删除按钮

### 2.2 客户详情页面 (detail.vue)

#### 页面描述
客户详情页面展示客户的详细信息，并提供客户状态管理、联系人关系管理和租户关系管理功能。

#### 页面布局
```
+--------------------------------------------------------------+
| 标题栏 "客户详情：[客户名称]"         [编辑] [删除] [返回]   |
+--------------------------------------------------------------+
| 客户基本信息卡片                                             |
| +----------------------------------------------------------+ |
| | 客户名称：XXX                                            | |
| | 客户类型：XXX    价值等级：[VIP]    状态：[活跃]         | |
| | ...                                                      | |
| +----------------------------------------------------------+ |
+--------------------------------------------------------------+
| 标签页                                                       |
| +----------------------------------------------------------+ |
| | [基本信息] [联系人关系] [租户关系]                       | |
| |----------------------------------------------------------| |
| | 标签页内容区域                                           | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| +----------------------------------------------------------+ |
+--------------------------------------------------------------+
```

#### 数据与状态
```typescript
// 获取客户ID
const customerId = computed(() => Number(route.params.id));

// 当前客户
const customer = computed(() => customerStore.currentCustomer);

// 当前活动标签页
const activeTab = ref("basic");

// 联系人关系列表
const memberRelations = computed(() => customerStore.customerMemberRelations.data);

// 联系人关系分页信息
const memberPagination = reactive({
  total: computed(() => customerStore.customerMemberRelations.total),
  currentPage: 1,
  pageSize: 10
});

// 租户关系列表
const tenantRelations = computed(() => customerStore.customerTenantRelations.data);

// 租户关系分页信息
const tenantPagination = reactive({
  total: computed(() => customerStore.customerTenantRelations.total),
  currentPage: 1,
  pageSize: 10
});

// 确认对话框状态
const confirmDialog = reactive({
  visible: false,
  title: "",
  content: "",
  type: "warning" as "warning" | "danger" | "info",
  loading: false,
  confirmCallback: null as (() => void) | null
});

// 添加联系人关系对话框状态
const addMemberRelationDialog = reactive({
  visible: false,
  loading: false
});

// 编辑联系人关系对话框状态
const editMemberRelationDialog = reactive({
  visible: false,
  loading: false,
  currentRelation: null as CustomerMemberRelation | null
});

// 添加租户关系对话框状态
const addTenantRelationDialog = reactive({
  visible: false,
  loading: false
});

// 编辑租户关系对话框状态
const editTenantRelationDialog = reactive({
  visible: false,
  loading: false,
  currentRelation: null as CustomerTenantRelation | null
});
```

#### 主要功能与交互

1. **页面加载**
   - 页面加载时，调用`fetchCustomerDetail`获取客户详情
   - 根据用户权限决定是否显示编辑和删除按钮

2. **标签页切换**
   - 点击标签页时，切换活动标签页
   - 切换到联系人关系标签页时，调用`fetchCustomerMemberRelations`获取联系人关系列表
   - 切换到租户关系标签页时，调用`fetchCustomerTenantRelations`获取租户关系列表

3. **客户状态管理**
   - 提供客户状态切换按钮
   - 点击状态切换按钮时，显示确认对话框
   - 确认后，调用相应的API更新客户状态

4. **联系人关系管理**
   - 点击添加按钮，显示添加联系人关系对话框
   - 点击编辑按钮，显示编辑联系人关系对话框
   - 点击删除按钮，显示确认对话框
   - 点击设为主要联系人按钮，调用`setPrimaryMemberRelation`

5. **租户关系管理**
   - 点击添加按钮，显示添加租户关系对话框
   - 点击编辑按钮，显示编辑租户关系对话框
   - 点击删除按钮，显示确认对话框
   - 点击设为主要租户关系按钮，调用`setPrimaryTenantRelation`

6. **编辑与删除客户**
   - 点击编辑按钮，跳转到客户编辑页面
   - 点击删除按钮，显示确认对话框
   - 确认删除后，调用`removeCustomer`删除客户，并返回客户列表页面

#### 权限控制
- 超级管理员可以查看和管理所有客户
- 租户管理员只能查看与其租户相关的客户
- 根据用户权限决定是否显示编辑、删除和关系管理按钮

### 2.3 客户创建页面 (create.vue)

#### 页面描述
客户创建页面提供表单用于创建新客户，支持填写客户的详细信息。

#### 页面布局
```
+--------------------------------------------------------------+
| 标题栏 "创建客户"                                    [返回]   |
+--------------------------------------------------------------+
| 客户表单                                                     |
| +----------------------------------------------------------+ |
| | 表单内容区域                                             | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| +----------------------------------------------------------+ |
| [保存] [取消]                                                |
+--------------------------------------------------------------+
```

#### 数据与状态
```typescript
// 表单加载状态
const formLoading = computed(() => customerStore.loading.create);

// 表单提交状态
const isSubmitting = ref(false);
```

#### 主要功能与交互

1. **页面加载**
   - 页面加载时，初始化表单

2. **表单填写**
   - 用户填写客户信息表单
   - 表单分为基本信息、公司信息、联系信息和其他信息四个部分
   - 提供表单验证功能

3. **表单提交**
   - 点击保存按钮时，进行表单验证
   - 验证通过后，调用`createCustomer`创建客户
   - 创建成功后，显示成功提示并返回客户列表页面或跳转到客户详情页面

4. **取消操作**
   - 点击取消按钮时，提示用户是否放弃编辑
   - 确认后，返回客户列表页面

#### 权限控制
- 只有超级管理员可以创建客户
- 如果用户没有创建权限，显示无权限提示并返回列表页面

### 2.4 客户编辑页面 (edit.vue)

#### 页面描述
客户编辑页面提供表单用于编辑现有客户的信息，支持修改客户的详细信息。

#### 页面布局
```
+--------------------------------------------------------------+
| 标题栏 "编辑客户：[客户名称]"                        [返回]   |
+--------------------------------------------------------------+
| 客户表单                                                     |
| +----------------------------------------------------------+ |
| | 表单内容区域                                             | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| |                                                          | |
| +----------------------------------------------------------+ |
| [保存] [取消]                                                |
+--------------------------------------------------------------+
```

#### 数据与状态
```typescript
// 获取客户ID
const customerId = computed(() => Number(route.params.id));

// 当前客户
const customer = computed(() => customerStore.currentCustomer);

// 表单加载状态
const formLoading = computed(() => customerStore.loading.update);

// 表单提交状态
const isSubmitting = ref(false);
```

#### 主要功能与交互

1. **页面加载**
   - 页面加载时，调用`fetchCustomerDetail`获取客户详情
   - 使用客户详情初始化表单

2. **表单填写**
   - 用户编辑客户信息表单
   - 表单分为基本信息、公司信息、联系信息和其他信息四个部分
   - 提供表单验证功能

3. **表单提交**
   - 点击保存按钮时，进行表单验证
   - 验证通过后，调用`updateCustomerInfo`更新客户信息
   - 更新成功后，显示成功提示并返回客户详情页面

4. **取消操作**
   - 点击取消按钮时，提示用户是否放弃编辑
   - 确认后，返回客户详情页面

#### 权限控制
- 超级管理员可以编辑所有客户
- 租户管理员只能编辑与其租户相关的客户
- 如果用户没有编辑权限，显示无权限提示并返回详情页面

## 3. 页面交互流程图

### 3.1 客户管理主流程

```
+----------------+      +----------------+      +----------------+
|                |      |                |      |                |
| 客户列表页面   +----->+ 客户详情页面   +----->+ 客户编辑页面   |
|                |      |                |      |                |
+----------------+      +----------------+      +----------------+
       |                       ^                       |
       |                       |                       |
       v                       |                       |
+----------------+             |                       |
|                |             |                       |
| 客户创建页面   +-------------+-----------------------+
|                |
+----------------+
```

### 3.2 客户列表页面流程

```
+----------------+
| 进入列表页面   |
+-------+--------+
        |
        v
+-------+--------+
| 加载客户列表   |
+-------+--------+
        |
        v
+-------+--------+     +----------------+     +----------------+
| 用户操作选择   +---->+ 搜索/筛选客户  +---->+ 更新客户列表   |
+-------+--------+     +----------------+     +----------------+
        |
        |
        |     +----------------+     +----------------+     +----------------+
        +---->+ 创建新客户     +---->+ 填写客户表单   +---->+ 提交创建客户   |
        |     +----------------+     +----------------+     +----------------+
        |
        |     +----------------+
        +---->+ 查看客户详情   |
        |     +----------------+
        |
        |     +----------------+
        +---->+ 编辑客户       |
        |     +----------------+
        |
        |     +----------------+     +----------------+     +----------------+
        +---->+ 删除客户       +---->+ 确认删除       +---->+ 执行删除操作   |
              +----------------+     +----------------+     +----------------+
```

### 3.3 客户详情页面流程

```
+----------------+
| 进入详情页面   |
+-------+--------+
        |
        v
+-------+--------+
| 加载客户详情   |
+-------+--------+
        |
        v
+-------+--------+     +----------------+     +----------------+
| 切换标签页     +---->+ 联系人关系标签 +---->+ 加载联系人关系 |
+-------+--------+     +----------------+     +----------------+
        |                                            |
        |                                            v
        |                                     +----------------+     +----------------+
        |                                     | 管理联系人关系 +---->+ 添加/编辑/删除 |
        |                                     +----------------+     +----------------+
        |
        |             +----------------+     +----------------+
        +------------>+ 租户关系标签   +---->+ 加载租户关系   |
        |             +----------------+     +----------------+
        |                                            |
        |                                            v
        |                                     +----------------+     +----------------+
        |                                     | 管理租户关系   +---->+ 添加/编辑/删除 |
        |                                     +----------------+     +----------------+
        |
        |             +----------------+
        +------------>+ 编辑客户       |
        |             +----------------+
        |
        |             +----------------+     +----------------+     +----------------+
        +------------>+ 删除客户       +---->+ 确认删除       +---->+ 执行删除操作   |
                      +----------------+     +----------------+     +----------------+
```

## 4. 响应式设计

为了确保客户管理功能在不同设备上的良好体验，我们采用以下响应式设计策略：

### 4.1 桌面端（>= 1200px）
- 完整显示所有功能和表格列
- 使用多列布局展示表单
- 标签页水平排列

### 4.2 平板端（768px - 1199px）
- 保留大部分功能和表格列
- 可能隐藏部分非关键表格列
- 使用两列布局展示表单
- 标签页水平排列

### 4.3 移动端（< 768px）
- 简化界面，只显示最关键的功能和表格列
- 使用单列布局展示表单
- 标签页可能改为下拉选择或垂直排列
- 操作按钮可能合并为下拉菜单

## 5. 国际化支持

所有页面和组件都支持国际化，文本通过i18n工具获取。主要的国际化文本包括：

- 页面标题和描述
- 按钮文本
- 表单标签和提示
- 表格列标题
- 状态和类型描述
- 确认对话框文本
- 错误和成功提示

## 6. 主题支持

所有页面和组件都支持明暗主题切换，通过以下方式实现：

- 使用Element Plus的主题变量
- 使用CSS变量定义颜色和样式
- 响应系统主题变更
- 支持用户手动切换主题

## 7. 性能优化

为了提高页面性能和用户体验，我们采用以下优化策略：

- 使用Vue的异步组件加载
- 实现数据分页和懒加载
- 优化表单验证逻辑
- 使用虚拟滚动处理大量数据
- 缓存常用数据和组件状态
- 优化API调用，减少不必要的请求 