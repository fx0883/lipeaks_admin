# 文章评论集成功能实施计划

## 📋 需求概述
在文章预览页面添加评论管理入口，支持跳转到评论管理页面并自动筛选该文章的评论，同时优化评论列表的层级展示。

## ✅ 实施方案

### 1. 评论展示方式
- **选项C（分离展示）**
- 主列表显示顶级评论和回复数
- 点击"查看回复(N条)"展开该评论的所有子评论

### 2. 入口位置
- **选项A+C组合**
- 在统计卡片的评论数上加链接
- 同时添加一个独立的评论管理区块

### 3. 跳转方式
- **选项A（新标签页）**
- 保持文章预览页面打开
- 在新标签管理评论

### 4. 默认筛选
- 自动筛选该文章
- 显示所有状态（便于审核）
- 显示所有层级（便于整体管理）

---

## 📝 详细实施清单

### 任务1: 修改文章详情页（detail.vue）
**文件**: `/src/views/cms/article/detail.vue`

- [ ] 1.1 在统计卡片的评论数上添加可点击链接
  - 修改评论统计项，添加 `el-link` 组件
  - 点击跳转到评论管理页并传递文章ID参数
  - 新标签页打开

- [ ] 1.2 添加独立的评论管理区块
  - 在统计卡片之后新增一个 `el-card`
  - 标题："评论管理"
  - 显示评论总数
  - 添加"查看并管理评论"按钮
  - 新标签页打开评论管理页

- [ ] 1.3 实现跳转逻辑函数
  - 创建 `handleViewComments()` 方法
  - 使用 `router.resolve()` 生成路由URL
  - 传递查询参数 `article={articleId}`
  - 使用 `window.open()` 在新标签页打开

### 任务2: 修改评论列表页（comment/index.vue）
**文件**: `/src/views/cms/comment/index.vue`

- [ ] 2.1 优化URL参数接收
  - 在 `onMounted` 时读取 URL 的 `article` 参数
  - 如果存在文章ID参数，自动填充到搜索表单
  - 自动触发搜索

- [ ] 2.2 添加文章信息显示
  - 当筛选了特定文章时，显示文章标题
  - 添加"返回文章"按钮（可选）
  - 显示当前筛选条件标签

- [ ] 2.3 实现回复展开功能
  - 为每条顶级评论添加"查看回复(N条)"按钮
  - 点击按钮时，在该行下方展开子评论列表
  - 使用嵌套表格或可展开行实现
  - 子评论带缩进标识

- [ ] 2.4 添加回复获取API调用
  - 在Store中添加 `fetchCommentReplies(commentId)` 方法（如果不存在）
  - 调用 `/cms/comments/?parent={commentId}` API
  - 缓存已加载的回复数据

### 任务3: 更新Store层（cms.ts）
**文件**: `/src/store/modules/cms.ts`

- [ ] 3.1 检查 `fetchCommentReplies` 方法
  - 如果不存在，添加该方法
  - 支持获取指定评论的所有回复
  - 返回回复列表数据

- [ ] 3.2 添加评论回复缓存机制（可选优化）
  - 在state中添加 `commentReplies` 对象
  - 按父评论ID存储回复列表
  - 避免重复请求

### 任务4: 优化路由配置（可选）
**文件**: `/src/router/modules/remaining.ts` 或相关路由文件

- [ ] 4.1 确认评论管理页面路由
  - 检查 `/cms/comment` 路由是否存在
  - 确保支持查询参数传递

### 任务5: 样式优化
**文件**: 相关 `.vue` 文件的 `<style>` 部分

- [ ] 5.1 文章详情页样式
  - 评论管理区块样式
  - 统计数据链接样式
  - 悬停效果

- [ ] 5.2 评论列表页样式
  - 回复展开按钮样式
  - 子评论缩进样式
  - 文章信息展示样式
  - 层级标识样式

### 任务6: 国际化文本（可选）
**文件**: `/src/locales/zh-CN.ts` 等

- [ ] 6.1 添加新的翻译文本
  - "评论管理"
  - "查看并管理评论"
  - "查看回复(N条)"
  - "展开回复"
  - "收起回复"
  - "当前文章评论"

---

## 🎯 实施步骤

### 阶段1: 添加跳转入口（核心功能）
1. 修改 `detail.vue` 统计卡片的评论数
2. 添加独立的评论管理区块
3. 实现跳转逻辑

### 阶段2: 优化评论列表页
1. 接收URL参数并自动筛选
2. 显示当前文章信息
3. 添加回复展开功能

### 阶段3: 完善Store和API
1. 确保回复获取API可用
2. 添加必要的缓存机制

### 阶段4: 样式和体验优化
1. 美化界面
2. 添加过渡动画
3. 完善交互反馈

---

## 🧪 测试清单

### 功能测试
- [ ] 点击统计卡片的评论数，能在新标签页打开评论管理页
- [ ] 评论管理页自动筛选对应文章的评论
- [ ] 评论管理区块的按钮功能正常
- [ ] 回复展开/收起功能正常
- [ ] 子评论正确显示层级关系

### 兼容性测试
- [ ] 没有评论的文章显示正常
- [ ] 只有顶级评论的文章显示正常
- [ ] 有多层嵌套回复的文章显示正常

### 边界测试
- [ ] 没有文章ID参数时，评论列表正常显示所有评论
- [ ] 文章ID不存在时，显示友好提示
- [ ] 大量回复时，加载性能正常

---

## 📊 预期效果

### 文章详情页效果
```
文章详情页面
├─ 标题和操作按钮
├─ 基本信息卡片
├─ 内容卡片
├─ 统计卡片
│  ├─ 浏览量
│  ├─ 评论数 [可点击跳转] ⭐
│  ├─ 点赞数
│  └─ 字数
└─ 评论管理卡片 ⭐
   ├─ 标题："评论管理"
   ├─ 显示：当前文章有 X 条评论
   └─ 按钮：[查看并管理评论 →]
```

### 评论管理页效果
```
评论管理页面（已筛选文章10251）
├─ 页面标题："评论管理"
├─ 文章信息：📝 文章《标题》的评论 [返回文章]
├─ 搜索筛选区（article已自动填充）
├─ 批量操作按钮
└─ 评论列表
   ├─ 🔸 顶级评论1 [查看回复(3条)]
   │  └─ [展开后显示3条回复，带缩进]
   ├─ 🔸 顶级评论2 [查看回复(0条)]
   └─ 🔸 顶级评论3 [查看回复(1条)]
```

---

## 🚀 开始实施

准备就绪，等待执行指令！
