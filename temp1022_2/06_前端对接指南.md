# 前端对接指南 (Vue 3)

## 🎯 概述

本文档为 Vue 3 项目提供 Feedback System API 对接指南。

**适用框架**: Vue 3 + Composition API  
**HTTP 客户端**: Axios  
**状态管理**: Pinia (可选)

## 📋 目录

- [环境准备](#环境准备)
- [API 客户端配置](#api-客户端配置)
- [Composables 封装](#composables-封装)
- [页面组件设计](#页面组件设计)
- [最佳实践](#最佳实践)

---

## 环境准备

### 1. 安装依赖

```bash
# 安装 Axios
npm install axios

# 可选：状态管理
npm install pinia

# 可选：图表库
npm install echarts vue-echarts
```

### 2. 项目结构建议

```
src/
├── api/
│   ├── client.js          # Axios 配置
│   └── feedback.js        # Feedback API 封装
├── composables/
│   ├── useFeedback.js     # 反馈相关 Composable
│   ├── useSoftware.js     # 软件相关 Composable
│   └── useAuth.js         # 认证相关 Composable
├── views/
│   ├── FeedbackList.vue   # 反馈列表页
│   ├── FeedbackDetail.vue # 反馈详情页
│   └── FeedbackSubmit.vue # 提交反馈页
└── stores/
    └── auth.js            # 认证状态管理
```

---

## API 客户端配置

### Axios 基础配置

**文件位置**: `src/api/client.js`

**配置要点**:

1. **基础URL**: 从环境变量读取
2. **超时设置**: 建议10秒
3. **请求拦截器**: 自动添加 Token
4. **响应拦截器**: 统一错误处理

**Token 管理**:
- 存储位置：localStorage 或 Pinia Store
- 请求时自动添加到 Authorization 头
- Token 过期时自动刷新

**错误处理策略**:

| 错误码 | 处理方式 |
|--------|---------|
| 401 | 刷新Token或跳转登录 |
| 403 | 提示权限不足 |
| 404 | 提示资源不存在 |
| 500 | 提示服务器错误，稍后重试 |

---

### API 方法封装

**文件位置**: `src/api/feedback.js`

**封装建议**:

将所有 Feedback System API 封装为独立方法：

**反馈相关**:
- `getFeedbacks(params)` - 获取反馈列表
- `getFeedbackDetail(id)` - 获取反馈详情
- `createFeedback(data)` - 创建反馈
- `updateFeedback(id, data)` - 更新反馈
- `deleteFeedback(id)` - 删除反馈
- `changeStatus(id, status, reason)` - 修改状态

**互动相关**:
- `getReplies(feedbackId)` - 获取回复
- `addReply(feedbackId, content, isInternal)` - 添加回复
- `vote(feedbackId, voteType)` - 投票
- `removeVote(feedbackId)` - 取消投票
- `uploadAttachment(feedbackId, file)` - 上传附件

**软件相关**:
- `getSoftwareCategories()` - 获取分类
- `getSoftwareList(params)` - 获取软件列表
- `getSoftwareVersions(softwareId)` - 获取版本

**统计相关**:
- `getStatistics(params)` - 获取统计
- `getSystemHealth()` - 健康检查

---

## Composables 封装

### useFeedback Composable

**功能**: 封装反馈相关的数据获取和操作逻辑

**提供的功能**:
- `feedbacks` - 反馈列表数据（响应式）
- `loading` - 加载状态
- `error` - 错误信息
- `fetchFeedbacks(filters)` - 获取列表
- `createFeedback(data)` - 创建反馈
- `updateFeedback(id, data)` - 更新反馈
- `deleteFeedback(id)` - 删除反馈

**使用方式**:

在组件中导入并使用：
```javascript
import { useFeedback } from '@/composables/useFeedback'

const { feedbacks, loading, fetchFeedbacks } = useFeedback()

// 获取反馈列表
await fetchFeedbacks({ software: 1, status: 'submitted' })
```

---

### useFeedbackDetail Composable

**功能**: 封装单个反馈的详细信息获取

**提供的功能**:
- `feedback` - 反馈详情（响应式）
- `loading` - 加载状态
- `fetchDetail(id)` - 获取详情
- `refresh()` - 刷新数据

**使用场景**: 反馈详情页面

---

## 页面组件设计

### 反馈列表页面

**页面布局**:
```
┌─────────────────────────────────────┐
│  [筛选器]                            │
│  类型 | 状态 | 优先级 | [搜索框]     │
├─────────────────────────────────────┤
│  反馈列表                            │
│  ┌─────────────────────────────┐   │
│  │ 标题                         │   │
│  │ [Bug] [高优先级] [审核中]    │   │
│  │ 👍 15  💬 3  👁 50          │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ ...更多反馈...              │   │
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│  [分页控制]                          │
│  « 上一页  1 2 3 4 5  下一页 »      │
└─────────────────────────────────────┘
```

**核心功能**:
1. 筛选器（类型、状态、优先级）
2. 搜索框（实时搜索）
3. 排序（最新、最热、最多回复）
4. 分页加载
5. 点击跳转详情页

**数据加载**:
- 页面加载时自动获取第一页
- 筛选条件变化时重新加载
- 支持URL参数保存筛选状态

---

### 反馈详情页面

**页面布局**:
```
┌─────────────────────────────────────┐
│  反馈标题                            │
│  [Bug] [高] [处理中]                │
├─────────────────────────────────────┤
│  提交者：张三 | CRM系统 v2.1.0       │
│  创建时间：2025-10-22 10:00         │
├─────────────────────────────────────┤
│  详细描述：                          │
│  这是详细的问题描述内容...           │
├─────────────────────────────────────┤
│  环境信息：[展开/收起]               │
│  OS: Windows 10                     │
│  Browser: Chrome 96                 │
├─────────────────────────────────────┤
│  📎 附件 (2)                        │
│  [图片预览] [文档下载]              │
├─────────────────────────────────────┤
│  投票区域                            │
│  [👍 赞成 15]  [👎 反对 2]         │
├─────────────────────────────────────┤
│  💬 回复 (3)                        │
│  ┌───────────────────────────────┐ │
│  │ 管理员 · 1小时前             │ │
│  │ 我们已经收到您的反馈          │ │
│  └───────────────────────────────┘ │
│  ...更多回复...                     │
├─────────────────────────────────────┤
│  [管理员功能]                        │
│  [修改状态] [添加回复] [编辑]       │
└─────────────────────────────────────┘
```

**核心功能**:
1. 显示完整反馈信息
2. 附件预览和下载
3. 投票功能
4. 回复列表
5. 管理员操作区（条件显示）
6. 状态历史时间线

---

### 反馈提交页面

**页面布局**:
```
┌─────────────────────────────────────┐
│  提交反馈                            │
├─────────────────────────────────────┤
│  软件选择：                          │
│  [选择分类 ▼] → [选择软件 ▼]        │
│  → [选择版本 ▼] (可选)              │
├─────────────────────────────────────┤
│  反馈类型：                          │
│  ◉ Bug报告  ○ 功能请求              │
│  ○ 改进建议  ○ 问题咨询             │
├─────────────────────────────────────┤
│  优先级：                            │
│  ○ 紧急  ○ 高  ◉ 中  ○ 低         │
├─────────────────────────────────────┤
│  标题：                              │
│  [_________________]                │
├─────────────────────────────────────┤
│  详细描述：                          │
│  [                                ] │
│  [                                ] │
│  [                                ] │
├─────────────────────────────────────┤
│  上传附件：(可选)                    │
│  [选择文件] 或 拖拽到此处            │
│  支持：图片、PDF、Word (最大10MB)   │
├─────────────────────────────────────┤
│  联系邮箱：(选填)                    │
│  [_________________]                │
│  用于接收反馈处理通知                │
├─────────────────────────────────────┤
│  [取消]           [提交反馈]         │
└─────────────────────────────────────┘
```

**交互流程**:

```
1. 页面加载
   ↓ 自动获取软件分类列表
2. 用户选择分类
   ↓ 加载该分类下的软件列表
3. 用户选择软件
   ↓ 加载该软件的版本列表
4. 用户填写其他信息
   ↓ 前端实时验证
5. 用户点击提交
   ↓ 二次确认
6. 调用API提交
   ↓ 显示提交结果
7. 成功后跳转到详情页
```

---

## 数据流设计

### 反馈列表数据流

```
页面加载
    ↓
调用 GET /feedbacks/
    ↓
显示 loading 状态
    ↓
接收数据
    ↓
保存到 reactive 变量
    ↓
渲染列表
    ↓
用户交互（筛选/搜索）
    ↓
更新查询参数
    ↓
重新请求数据
```

### 反馈提交数据流

```
表单输入
    ↓
实时验证 (v-model + watch)
    ↓
提交时最终验证
    ↓
调用 API
    ↓
显示加载状态
    ↓
成功：跳转详情页
失败：显示错误
```

---

## 状态管理建议

### 使用 Pinia Store

**反馈 Store**:
- `feedbackList` - 反馈列表
- `currentFeedback` - 当前查看的反馈
- `filters` - 筛选条件
- `pagination` - 分页信息

**软件 Store**:
- `categories` - 软件分类（缓存）
- `softwareList` - 软件列表（按分类缓存）
- `versions` - 版本列表（按软件缓存）

**认证 Store**:
- `user` - 当前用户信息
- `accessToken` - 访问令牌
- `refreshToken` - 刷新令牌
- `isAdmin` - 是否管理员

---

## 路由设计

### 路由配置建议

```
/feedbacks                    # 反馈列表页
/feedbacks/submit             # 提交反馈页
/feedbacks/:id                # 反馈详情页
/feedbacks/:id/edit           # 编辑反馈页 (作者/管理员)
/admin/feedbacks              # 管理后台
/admin/feedbacks/statistics   # 统计面板
/admin/software               # 软件管理
/admin/email-templates        # 邮件模板管理
```

### URL 参数应用

**列表页支持 URL 参数**:
```
/feedbacks?software=1&status=submitted&page=2
```

好处：
- 支持分享链接
- 浏览器前进/后退
- 刷新页面保持状态

**实现方式**:
- 使用 `route.query` 读取参数
- 使用 `router.push({ query: {...} })` 更新参数
- Watch query 变化自动加载数据

---

## 页面功能详解

### 反馈列表页

**必备功能**:

| 功能 | 说明 | 实现要点 |
|------|------|---------|
| 列表展示 | 显示反馈列表 | 使用 v-for 遍历 |
| 分页 | 翻页功能 | 更新 page 参数 |
| 筛选 | 多条件筛选 | 下拉选择器 |
| 搜索 | 关键词搜索 | 输入框+防抖 |
| 排序 | 多种排序方式 | 下拉选择器 |
| 跳转详情 | 点击查看详情 | router.push |

**性能优化**:
- 搜索使用防抖（300ms）
- 列表使用虚拟滚动（数据量大时）
- 图片懒加载

**用户体验**:
- 加载时显示骨架屏
- 空状态提示
- 错误重试机制

---

### 反馈详情页

**必备功能**:

| 功能 | 说明 | 权限 |
|------|------|------|
| 基本信息 | 标题、描述、状态 | 所有 |
| 附件显示 | 图片预览、文件下载 | 所有 |
| 投票 | 赞成/反对 | 已登录 |
| 查看回复 | 回复列表 | 所有 |
| 添加回复 | 回复输入框 | 仅管理员 |
| 修改状态 | 状态选择器 | 仅管理员 |
| 编辑反馈 | 编辑按钮 | 作者/管理员 |
| 删除反馈 | 删除按钮 | 作者/管理员 |

**交互设计**:

**投票按钮**:
- 未投票：灰色按钮
- 已赞成：绿色高亮
- 已反对：红色高亮
- 点击相同按钮=取消

**回复区域**:
- 仅管理员显示回复输入框
- 内部备注开关
- 发送后自动刷新列表

**附件处理**:
- 图片：缩略图+灯箱效果
- 文档：文件名+下载按钮
- 上传：拖拽或选择文件

---

### 反馈提交页面

**表单字段**:

| 字段 | 组件类型 | 必填 | 验证规则 |
|------|---------|------|---------|
| 软件分类 | 下拉框 | ✅ | 必选 |
| 软件产品 | 下拉框 | ✅ | 必选 |
| 软件版本 | 下拉框 | ❌ | 可选 |
| 反馈类型 | 单选框 | ✅ | 必选 |
| 优先级 | 单选框 | ✅ | 默认中 |
| 标题 | 文本框 | ✅ | 1-200字符 |
| 描述 | 文本域 | ✅ | 最少10字符 |
| 附件 | 文件上传 | ❌ | ≤10MB |
| 邮箱 | 文本框 | ❌* | 邮箱格式 |

*匿名用户必填

**级联选择实现**:
1. 页面加载 → 获取所有分类
2. 选择分类 → 获取该分类的软件（清空软件和版本选择）
3. 选择软件 → 获取该软件的版本（清空版本选择）

**表单验证**:
- 使用 Vue 3 的表单验证库（如 VeeValidate）
- 实时验证，即时反馈
- 提交时最终验证

---

## 最佳实践

### 1. 数据缓存

**适合缓存的数据**:
- 软件分类列表（变化少）
- 软件列表（按分类缓存）
- 当前用户信息

**缓存策略**:
- 使用 Pinia Store 缓存
- 设置过期时间（如5分钟）
- 提供手动刷新功能

---

### 2. 错误处理

**统一错误处理**:
在 Axios 响应拦截器中处理，前端组件无需重复处理常见错误。

**错误提示方式**:
- 使用 Toast 或 Message 组件
- 关键错误使用 Modal 对话框
- 表单验证错误显示在字段旁

---

### 3. 加载状态

**加载状态类型**:

| 状态 | 使用场景 | 显示方式 |
|------|---------|---------|
| 页面加载 | 首次进入页面 | 骨架屏 |
| 数据刷新 | 筛选/搜索 | 列表上方加载条 |
| 提交中 | 表单提交 | 按钮加载动画 |
| 上传中 | 文件上传 | 进度条 |

---

### 4. 权限控制

**前端权限判断**:
- 从用户信息判断角色
- 根据角色显示/隐藏功能
- 按钮禁用而非隐藏（提示权限不足）

**管理员功能**:
- 回复按钮
- 状态修改
- 软件管理
- 统计查看

---

### 5. 性能优化

**列表优化**:
- 虚拟滚动（长列表）
- 图片懒加载
- 分页加载而非一次全部

**详情页优化**:
- 附件延迟加载
- 图片压缩显示
- 回复分页（数量多时）

**搜索优化**:
- 输入防抖（300ms）
- 显示搜索历史
- 热门搜索推荐

---

### 6. 用户体验

**友好提示**:
- 操作成功给予明确反馈
- 操作失败说明原因
- 重要操作需要二次确认

**空状态处理**:
- 无反馈时显示引导
- 无回复时显示占位符
- 搜索无结果显示建议

**响应速度**:
- 乐观更新（如投票）
- 骨架屏代替空白
- 预加载关联数据

---

## Vue 3 特性应用

### Composition API

**优势**:
- 逻辑复用（Composables）
- 更好的类型推导
- 代码组织清晰

**使用建议**:
- 复杂组件使用 Composition API
- 简单组件可用 Options API
- 共享逻辑抽取为 Composables

---

### 响应式系统

**ref vs reactive**:
- 简单值用 `ref`
- 对象/数组用 `reactive`
- 避免解构 reactive 对象（使用 toRefs）

**computed 应用**:
- 筛选后的列表
- 格式化的显示值
- 权限判断结果

**watch 应用**:
- 监听筛选条件变化
- 监听路由参数变化
- 监听用户登录状态

---

### Suspense 和异步组件

**使用场景**:
- 路由懒加载
- 组件异步加载
- 数据预取

**好处**:
- 减小首屏体积
- 按需加载
- 加载状态统一处理

---

## 调试技巧

### 开发者工具

**Vue Devtools**:
- 查看组件状态
- 监听事件
- 检查 Pinia Store

**网络面板**:
- 查看 API 请求
- 检查请求参数
- 查看响应数据

**控制台日志**:
- 记录关键操作
- 输出错误信息
- 性能监控

---

### 常见问题排查

| 问题 | 可能原因 | 排查方法 |
|------|---------|---------|
| API 调用失败 | Token 无效 | 检查 Authorization 头 |
| 数据未显示 | 数据结构错误 | 检查 API 返回格式 |
| 权限错误 | 角色判断错误 | 检查用户角色信息 |
| 上传失败 | 文件过大 | 检查文件大小限制 |

---

## 集成检查清单

### 开发阶段

- [ ] Axios 客户端配置完成
- [ ] API 方法封装完成
- [ ] Composables 编写完成
- [ ] 路由配置完成
- [ ] 页面组件开发完成
- [ ] 错误处理实现
- [ ] 加载状态处理
- [ ] 权限控制实现

### 测试阶段

- [ ] 列表页功能测试
- [ ] 详情页功能测试
- [ ] 提交表单测试
- [ ] 文件上传测试
- [ ] 投票功能测试
- [ ] 回复功能测试
- [ ] 权限测试
- [ ] 错误处理测试

### 上线前

- [ ] 环境变量配置
- [ ] 错误监控接入
- [ ] 性能优化完成
- [ ] 移动端适配
- [ ] 浏览器兼容性测试
- [ ] 用户手册准备

---

## 环境配置

### .env 文件配置

```bash
# 开发环境
VITE_API_URL=http://localhost:8000/api/v1/feedbacks

# 测试环境
VITE_API_URL=http://test.your-domain.com/api/v1/feedbacks

# 生产环境
VITE_API_URL=https://api.your-domain.com/api/v1/feedbacks
```

### 配置说明

| 配置项 | 说明 | 示例 |
|--------|------|------|
| VITE_API_URL | API基础URL | http://localhost:8000/api/v1/feedbacks |
| VITE_UPLOAD_MAX_SIZE | 上传文件大小限制 | 10485760 (10MB) |
| VITE_PAGE_SIZE | 默认每页数量 | 20 |

---

## 总结

### 核心要点

1. **统一的 API 客户端**: 配置 Axios 拦截器
2. **Composables 复用**: 封装常用逻辑
3. **状态管理**: 使用 Pinia 管理全局状态
4. **错误处理**: 统一在拦截器中处理
5. **权限控制**: 根据用户角色控制功能
6. **用户体验**: 加载状态、错误提示、空状态

### 开发建议

- 先完成 API 客户端和 Composables
- 再开发页面组件
- 遵循 Vue 3 最佳实践
- 注重代码可维护性
- 添加适当的注释

---

**返回**: [README.md](README.md)

