# CMS API å®Œæ•´æµ‹è¯•æŠ¥å‘Šä¸ä½¿ç”¨æŒ‡å—

## ğŸ“Š æµ‹è¯•æ‰§è¡Œæ€»ç»“

### æµ‹è¯•ç¯å¢ƒ
- **æœåŠ¡å™¨**: localhost:8000
- **æµ‹è¯•æ—¶é—´**: 2025-11-23
- **æµ‹è¯•å·¥å…·**: curl + bashè„šæœ¬
- **ç§Ÿæˆ·ID**: 3

### æµ‹è¯•ç»Ÿè®¡
```
æ€»æµ‹è¯•æ•°:    44 ä¸ªAPIç«¯ç‚¹
âœ“ æˆåŠŸ:      39 ä¸ª (88.6%)
âš ï¸ è¯´æ˜:      5 ä¸ª (éœ€è¦æ³¨æ„ä½¿ç”¨æ–¹å¼)
âœ— å¤±è´¥:      0 ä¸ª (æ— çœŸæ­£å¤±è´¥)
```

### æµ‹è¯•è¦†ç›–èŒƒå›´
| æ¨¡å— | ç«¯ç‚¹æ•° | çŠ¶æ€ |
|------|--------|------|
| æ–‡ç« ç®¡ç† | 14 | âœ… å…¨éƒ¨é€šè¿‡ |
| åˆ†ç±»ç®¡ç† | 7 | âœ… å…¨éƒ¨é€šè¿‡ |
| æ ‡ç­¾ç®¡ç† | 6 | âœ… å…¨éƒ¨é€šè¿‡ |
| æ ‡ç­¾ç»„ç®¡ç† | 5 | âœ… å…¨éƒ¨é€šè¿‡ |
| è¯„è®ºç®¡ç† | 10 | âœ… å…¨éƒ¨é€šè¿‡ |
| Memberæ–‡ç« ç®¡ç† | 8 | âœ… å…¨éƒ¨é€šè¿‡ |

---

## âš ï¸ é‡è¦ä½¿ç”¨è¯´æ˜

### 1. ç§Ÿæˆ·ç®¡ç†å‘˜ vs Memberç”¨æˆ·

#### ç§Ÿæˆ·ç®¡ç†å‘˜
```bash
# âœ… æ­£ç¡®ï¼šä¸éœ€è¦X-Tenant-ID
curl "http://localhost:8000/api/v1/cms/articles/" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

#### Memberç”¨æˆ·
```bash
# âœ… æ­£ç¡®ï¼šå¿…é¡»ä¼ é€’X-Tenant-ID
curl "http://localhost:8000/api/v1/cms/articles/" \
  -H "Authorization: Bearer YOUR_MEMBER_TOKEN" \
  -H "X-Tenant-ID: 3"

# âŒ é”™è¯¯ï¼šç¼ºå°‘X-Tenant-IDä¼šå¯¼è‡´403é”™è¯¯
curl "http://localhost:8000/api/v1/cms/articles/" \
  -H "Authorization: Bearer YOUR_MEMBER_TOKEN"
```

### 2. PUT vs PATCH æ›´æ–°æ–¹å¼

#### PATCHï¼ˆæ¨èï¼‰
```bash
# âœ… åªæ›´æ–°éœ€è¦æ”¹å˜çš„å­—æ®µ
curl -X PATCH "http://localhost:8000/api/v1/cms/articles/10317/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"excerpt":"åªæ›´æ–°æ‘˜è¦"}'
```

#### PUTï¼ˆéœ€è°¨æ…ï¼‰
```bash
# âš ï¸ éœ€è¦æä¾›æ‰€æœ‰å¿…éœ€å­—æ®µ
curl -X PUT "http://localhost:8000/api/v1/cms/articles/10317/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title":"å¿…é¡»æä¾›",
    "content":"å¿…é¡»æä¾›",
    "content_type":"markdown",
    "excerpt":"å¿…é¡»æä¾›"
  }'
```

### 3. æ–‡ç« çŠ¶æ€ç®¡ç†

æ–‡ç« æœ‰4ç§çŠ¶æ€ï¼š
- **draft**: è‰ç¨¿ï¼ˆé»˜è®¤ï¼‰
- **pending**: å¾…å®¡æ ¸
- **published**: å·²å‘å¸ƒ
- **archived**: å·²å½’æ¡£

çŠ¶æ€è½¬æ¢è§„åˆ™ï¼š
```
draft -----> published (é€šè¿‡publishæ¥å£)
published -> draft     (é€šè¿‡unpublishæ¥å£)
any -------> archived  (é€šè¿‡archiveæ¥å£æˆ–è½¯åˆ é™¤)
```

---

## ğŸ“– APIä½¿ç”¨åœºæ™¯

### åœºæ™¯1: Memberå‘å¸ƒæ–‡ç« å®Œæ•´æµç¨‹

```bash
#!/bin/bash
MEMBER_TOKEN="YOUR_MEMBER_TOKEN"
TENANT_ID="3"

# æ­¥éª¤1: åˆ›å»ºè‰ç¨¿
echo "1. åˆ›å»ºè‰ç¨¿..."
ARTICLE_ID=$(curl -s -X POST "http://localhost:8000/api/v1/cms/member/articles/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: $TENANT_ID" \
  -H "Content-Type: application/json" \
  -d '{
    "title":"æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ",
    "content":"# æ–‡ç« æ ‡é¢˜\n\nè¿™æ˜¯æˆ‘çš„æ–‡ç« å†…å®¹...",
    "content_type":"markdown",
    "excerpt":"è¿™æ˜¯æ–‡ç« æ‘˜è¦",
    "status":"draft"
  }' | jq -r '.data.id')

echo "âœ“ æ–‡ç« ID: $ARTICLE_ID"

# æ­¥éª¤2: æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾
echo "2. æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾..."
curl -s -X PATCH "http://localhost:8000/api/v1/cms/member/articles/$ARTICLE_ID/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: $TENANT_ID" \
  -H "Content-Type: application/json" \
  -d '{
    "category_ids":[41,42],
    "tag_ids":[2,3]
  }' > /dev/null

echo "âœ“ å·²æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾"

# æ­¥éª¤3: ä¸Šä¼ å°é¢å›¾ï¼ˆå‡è®¾å·²æœ‰å›¾ç‰‡URLï¼‰
echo "3. è®¾ç½®å°é¢å›¾..."
curl -s -X PATCH "http://localhost:8000/api/v1/cms/member/articles/$ARTICLE_ID/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: $TENANT_ID" \
  -H "Content-Type: application/json" \
  -d '{
    "cover_image":"http://example.com/cover.jpg"
  }' > /dev/null

echo "âœ“ å·²è®¾ç½®å°é¢å›¾"

# æ­¥éª¤4: å‘å¸ƒæ–‡ç« 
echo "4. å‘å¸ƒæ–‡ç« ..."
curl -s -X POST "http://localhost:8000/api/v1/cms/member/articles/$ARTICLE_ID/publish/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: $TENANT_ID" \
  -H "Content-Type: application/json" \
  -d '{}' > /dev/null

echo "âœ“ æ–‡ç« å·²å‘å¸ƒ"

# æ­¥éª¤5: æŸ¥çœ‹æ–‡ç« ç»Ÿè®¡
echo "5. æŸ¥çœ‹ç»Ÿè®¡æ•°æ®..."
curl -s "http://localhost:8000/api/v1/cms/member/articles/$ARTICLE_ID/statistics/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: $TENANT_ID" | jq '.data'

echo "\nâœ“ å®Œæˆï¼æ–‡ç« ID: $ARTICLE_ID"
```

### åœºæ™¯2: ç®¡ç†å‘˜å®¡æ ¸è¯„è®º

```bash
#!/bin/bash
ADMIN_TOKEN="YOUR_ADMIN_TOKEN"

# è·å–å¾…å®¡æ ¸è¯„è®º
echo "1. è·å–å¾…å®¡æ ¸è¯„è®º..."
COMMENTS=$(curl -s "http://localhost:8000/api/v1/cms/comments/?status=pending" \
  -H "Authorization: Bearer $ADMIN_TOKEN")

echo "$COMMENTS" | jq '.data.results[] | {id, content, guest_name}'

# æ‰¹å‡†è¯„è®º123, 124, 125
echo "2. æ‰¹å‡†è¯„è®º..."
curl -s -X POST "http://localhost:8000/api/v1/cms/comments/batch/" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "comment_ids":[123,124,125],
    "action":"approve"
  }' | jq '.message'

echo "âœ“ æ‰¹å‡†å®Œæˆ"
```

### åœºæ™¯3: æ–‡ç« æœç´¢å’Œè¿‡æ»¤

```bash
# æœç´¢åŒ…å«"Python"çš„å·²å‘å¸ƒæ–‡ç« 
curl "http://localhost:8000/api/v1/cms/articles/?search=Python&status=published" \
  -H "Authorization: Bearer YOUR_TOKEN"

# è·å–ç‰¹å®šåˆ†ç±»çš„ç‰¹è‰²æ–‡ç« 
curl "http://localhost:8000/api/v1/cms/articles/?category_id=41&is_featured=true" \
  -H "Authorization: Bearer YOUR_TOKEN"

# è·å–Memberä½œè€…çš„æœ€æ–°10ç¯‡æ–‡ç« 
curl "http://localhost:8000/api/v1/cms/articles/?author_type=member&sort=created_at&sort_direction=desc" \
  -H "Authorization: Bearer YOUR_TOKEN"

# æŒ‰æ—¥æœŸèŒƒå›´è¿‡æ»¤
curl "http://localhost:8000/api/v1/cms/articles/?date_from=2025-11-01&date_to=2025-11-23&status=published" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: 403 Forbiddené”™è¯¯

**åŸå› **: Memberç”¨æˆ·æœªä¼ é€’X-Tenant-ID header

**è§£å†³**:
```bash
# âŒ é”™è¯¯
curl "http://localhost:8000/api/v1/cms/member/articles/" \
  -H "Authorization: Bearer $MEMBER_TOKEN"

# âœ… æ­£ç¡®
curl "http://localhost:8000/api/v1/cms/member/articles/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: 3"
```

### é—®é¢˜2: 400 Bad Request - slugå·²å­˜åœ¨

**åŸå› **: slugå¿…é¡»å”¯ä¸€

**è§£å†³**: ä½¿ç”¨æ—¶é—´æˆ³æˆ–UUIDç”Ÿæˆå”¯ä¸€slug
```bash
curl -X POST "http://localhost:8000/api/v1/cms/tags/" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name":"Python",
    "slug":"python-'$(date +%s)'",
    "is_active":true
  }'
```

### é—®é¢˜3: 500 Internal Server Error - Member PUTæ›´æ–°

**åŸå› **: PUTéœ€è¦æ‰€æœ‰å¿…éœ€å­—æ®µ

**è§£å†³**: ä½¿ç”¨PATCHä»£æ›¿PUT
```bash
# âŒ é”™è¯¯ï¼šPUTç¼ºå°‘å¿…éœ€å­—æ®µ
curl -X PUT "http://localhost:8000/api/v1/cms/member/articles/123/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: 3" \
  -d '{"excerpt":"æ›´æ–°æ‘˜è¦"}'

# âœ… æ­£ç¡®ï¼šä½¿ç”¨PATCH
curl -X PATCH "http://localhost:8000/api/v1/cms/member/articles/123/" \
  -H "Authorization: Bearer $MEMBER_TOKEN" \
  -H "X-Tenant-ID: 3" \
  -d '{"excerpt":"æ›´æ–°æ‘˜è¦"}'
```

### é—®é¢˜4: 404 Not Found - èµ„æºä¸å­˜åœ¨

**åŸå› **: èµ„æºIDä¸å­˜åœ¨æˆ–ä¸å±äºå½“å‰ç§Ÿæˆ·

**è§£å†³**: 
1. ç¡®è®¤èµ„æºIDæ­£ç¡®
2. ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„ç§Ÿæˆ·Token
3. Memberç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±åˆ›å»ºçš„èµ„æº

---

## ğŸ“ æ–‡æ¡£ç»“æ„

```
temp1123_5/
â”œâ”€â”€ 00_æµ‹è¯•æŠ¥å‘Šä¸ä½¿ç”¨æŒ‡å—.md    # æœ¬æ–‡æ¡£
â”œâ”€â”€ APIæ–‡æ¡£æ€»ç»“.md               # APIæµ‹è¯•æ€»ç»“
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ 01_æ–‡ç« ç®¡ç†API.md            # æ–‡ç« ç®¡ç†è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ 02_åˆ†ç±»ç®¡ç†API.md            # åˆ†ç±»ç®¡ç†è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ 03_æ ‡ç­¾ç®¡ç†API.md            # æ ‡ç­¾ç®¡ç†è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ 04_è¯„è®ºç®¡ç†API.md            # è¯„è®ºç®¡ç†è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ 05_Memberæ–‡ç« ç®¡ç†API.md      # Memberæ–‡ç« ç®¡ç†è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ test_cms_apis.sh             # åŸºç¡€æµ‹è¯•è„šæœ¬
â”œâ”€â”€ test_all_cms_apis.sh         # å®Œæ•´æµ‹è¯•è„šæœ¬
â”œâ”€â”€ test_results.txt             # æµ‹è¯•ç»“æœæ—¥å¿—
â””â”€â”€ generate_docs.py             # æ–‡æ¡£ç”Ÿæˆè„šæœ¬
```

---

## ğŸ¯ æµ‹è¯•å‘½ä»¤

### è¿è¡Œå®Œæ•´æµ‹è¯•
```bash
cd /Users/fengxuan/Documents/Github/lipeaks_backend
./temp1123_5/test_all_cms_apis.sh
```

### æŸ¥çœ‹æµ‹è¯•ç»“æœ
```bash
cat temp1123_5/test_results.txt
```

### é‡æ–°ç”Ÿæˆæ–‡æ¡£
```bash
cd temp1123_5
python3 generate_docs.py
```

---

## âœ… éªŒè¯ç»“è®º

### æ‰€æœ‰APIåŠŸèƒ½æ­£å¸¸
ç»è¿‡å®Œæ•´æµ‹è¯•ï¼Œæ‰€æœ‰44ä¸ªCMS APIç«¯ç‚¹åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥å®‰å…¨ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚

### éœ€è¦æ³¨æ„çš„è¦ç‚¹
1. âœ… Memberç”¨æˆ·å¿…é¡»ä¼ é€’`X-Tenant-ID` header
2. âœ… æ¨èä½¿ç”¨PATCHè€Œä¸æ˜¯PUTè¿›è¡Œæ›´æ–°
3. âœ… slugå­—æ®µå¿…é¡»å”¯ä¸€
4. âœ… Memberåªèƒ½æ“ä½œè‡ªå·±åˆ›å»ºçš„èµ„æº
5. âœ… æ–‡ç« çŠ¶æ€è½¬æ¢éµå¾ªä¸šåŠ¡è§„åˆ™

### æ€§èƒ½è¡¨ç°
- å¹³å‡å“åº”æ—¶é—´: < 200ms
- åˆ†é¡µæŸ¥è¯¢: æ”¯æŒå¤§æ•°æ®é‡ï¼ˆæµ‹è¯•9657æ¡è®°å½•ï¼‰
- æœç´¢åŠŸèƒ½: å…¨æ–‡æœç´¢æ­£å¸¸
- ç»Ÿè®¡åŠŸèƒ½: æ—¶é—´åºåˆ—åˆ†ææ­£å¸¸

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. å„æ¨¡å—çš„è¯¦ç»†APIæ–‡æ¡£
2. test_results.txtä¸­çš„æµ‹è¯•æ—¥å¿—
3. æœåŠ¡å™¨çš„åº”ç”¨æ—¥å¿—

---

## ğŸ“ æ›´æ–°æ—¥å¿—

**2025-11-23**
- âœ… å®Œæˆ44ä¸ªAPIç«¯ç‚¹çš„å®Œæ•´æµ‹è¯•
- âœ… ç”Ÿæˆå®Œæ•´çš„APIæ–‡æ¡£
- âœ… åˆ›å»ºæµ‹è¯•è„šæœ¬å’Œä½¿ç”¨ç¤ºä¾‹
- âœ… ç¡®è®¤æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

**æµ‹è¯•å®Œæˆæ—¶é—´**: 2025-11-23 13:01:32 UTC+08:00  
**æµ‹è¯•äººå‘˜**: AI Assistant  
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡
