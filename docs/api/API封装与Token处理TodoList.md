# API封装与Token处理TodoList

## 已完成任务

1. ✅ 创建API类型定义文件：`src/types/api.ts`
   - 定义了API响应基础接口
   - 定义了分页数据接口
   - 定义了用户信息接口
   - 定义了登录和刷新令牌响应数据接口

2. ✅ 修改用户API文件：`src/api/user.ts`
   - 使用新的API类型定义
   - 简化了代码结构

3. ✅ 修改HTTP请求工具：`src/utils/http/index.ts`
   - 实现了静默刷新Token功能
   - 实现了请求自动重试功能
   - 统一处理了API错误响应
   - 添加了CSRF Token支持
   - 修改了请求白名单，将refresh从白名单中移除

4. ✅ 修改用户存储模块：`src/store/modules/user.ts`
   - 同时使用localStorage和cookie存储Token
   - 在登录和刷新Token时，更新localStorage中的token信息
   - 在登出时，清除localStorage中的token和用户信息

## 待测试任务

1. 测试登录功能
   - [ ] 验证登录请求格式是否正确
   - [ ] 验证token是否正确存储到localStorage和cookie
   - [ ] 验证用户信息是否正确存储

2. 测试Token刷新功能
   - [ ] 验证401响应是否触发Token刷新
   - [ ] 验证刷新Token请求参数格式是否为`{ refresh_token: refreshToken }`
   - [ ] 验证刷新Token成功后是否正确更新存储的token

3. 测试请求重试功能
   - [ ] 验证Token刷新成功后是否自动重试失败的请求
   - [ ] 验证重试请求是否使用了新的token
   - [ ] 验证多个请求同时失败时是否都能正确重试

4. 测试错误处理功能
   - [ ] 验证不同错误状态码是否有对应的友好提示
   - [ ] 验证网络错误是否有友好提示
   - [ ] 验证Token刷新失败是否正确跳转到登录页面

## 后续优化方向

1. 添加Token自动续期功能
   - [ ] 在Token即将过期前主动刷新，避免用户操作中断

2. 优化错误处理逻辑
   - [ ] 提供更详细的错误信息
   - [ ] 根据不同的错误类型采取不同的处理策略

3. 增加请求重试次数限制
   - [ ] 避免无限重试导致的问题
   - [ ] 可配置不同API的重试策略

4. 添加请求取消功能
   - [ ] 支持手动取消长时间未响应的请求
   - [ ] 在页面切换时自动取消不必要的请求 