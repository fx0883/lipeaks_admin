# ç°æœ‰ä»£ç æ·±åº¦åˆ†ææŠ¥å‘Š

## ğŸ” åˆ†æç›®æ ‡

æ ¹æ®ç”¨æˆ·è¦æ±‚ï¼š"æ‰€æœ‰åŸæœ‰çš„ä»£ç æ¨¡å‹éƒ½ä¸è¦æ”¹åŠ¨ï¼Œè¯·ä»”ç»†çœ‹ä»£ç æ·±åº¦æ€è€ƒ"ï¼Œå¯¹ç°æœ‰ä»£ç åº“è¿›è¡Œæ·±åº¦åˆ†æï¼Œç¡®è®¤å“ªäº›æ¨¡å‹å·²å­˜åœ¨äºä»£ç ä¸­ï¼Œå“ªäº›æ˜¯æ–°å¢çš„ã€‚

## ğŸ“‹ åˆ†æç»“æœæ€»è§ˆ

### âœ… ç°æœ‰ä»£ç æ¨¡å‹ï¼ˆå®Œå…¨ä¸å¯ä¿®æ”¹ï¼‰

#### 1. Memberæ¨¡å‹ (`users/models.py`)
```python
class Member(BaseUserModel):
    """æ™®é€šæˆå‘˜æ¨¡å‹ï¼ŒåŒ…æ‹¬æ™®é€šç”¨æˆ·å’Œå­è´¦å·"""
    parent = models.ForeignKey('self', on_delete=models.CASCADE, null=True, blank=True, ...)
    # ç»§æ‰¿è‡ªBaseUserModelçš„å­—æ®µï¼šusername, email, tenant, phone, nick_nameç­‰
```

**åˆ†æç»“è®º**ï¼š
- âœ… **å®Œå…¨åŸå­æ¨¡å‹** - åªåŒ…å«åŸºç¡€ç”¨æˆ·ä¿¡æ¯
- âœ… **æ— ç§¯åˆ†å­—æ®µ** - æ²¡æœ‰ä»»ä½•ç§¯åˆ†ã€ç­‰çº§ã€VIPç›¸å…³å­—æ®µ
- âœ… **æ— éœ€ä¿®æ”¹** - è®¾è®¡æ–¹æ¡ˆä¸­é€šè¿‡TenantUserProfileæ–°è¡¨å­˜å‚¨ç§¯åˆ†ä¿¡æ¯

#### 2. Licenseæ¨¡å‹ (`licenses/models.py`)
```python
class License(BaseModel):
    """è®¸å¯è¯æ¨¡å‹"""
    product = models.ForeignKey(SoftwareProduct, ...)
    tenant = models.ForeignKey('tenants.Tenant', ...)
    license_key = models.CharField(_("è®¸å¯è¯å¯†é’¥"), max_length=200, unique=True)
    
    # å…³é”®å­—æ®µ - å·²å­˜åœ¨äºç°æœ‰ä»£ç ä¸­
    max_activations = models.PositiveIntegerField(_("æœ€å¤§æ¿€æ´»æ•°"), default=1)
    current_activations = models.PositiveIntegerField(_("å½“å‰æ¿€æ´»æ•°"), default=0)
    
    expires_at = models.DateTimeField(_("è¿‡æœŸæ—¶é—´"))
    customer_name = models.CharField(_("å®¢æˆ·åç§°"), max_length=100, blank=True)
    customer_email = models.EmailField(_("å®¢æˆ·é‚®ç®±"), blank=True)
```

**åˆ†æç»“è®º**ï¼š
- âœ… **å®Œå…¨åŸå­æ¨¡å‹** - åªåŒ…å«è®¸å¯è¯åŸºç¡€ä¿¡æ¯
- âœ… **å·²æœ‰æ‰€éœ€å­—æ®µ** - `max_activations`å’Œ`current_activations`å­—æ®µå·²å­˜åœ¨
- âœ… **æ— éœ€ä¿®æ”¹** - è®¾è®¡æ–¹æ¡ˆå®Œå…¨åŸºäºç°æœ‰å­—æ®µè¿›è¡Œé…é¢æ£€æŸ¥

#### 3. Tenantæ¨¡å‹ (`tenants/models.py`) 
```python
class Tenant(models.Model):
    """ç§Ÿæˆ·æ¨¡å‹ï¼Œç”¨äºéš”ç¦»ä¸åŒç§Ÿæˆ·çš„æ•°æ®"""
    name = models.CharField(_("ç§Ÿæˆ·åç§°"), max_length=100, unique=True)
    status = models.CharField(_("çŠ¶æ€"), max_length=20, choices=STATUS_CHOICES, default='active')
    contact_name = models.CharField(_("è”ç³»äººå§“å"), max_length=50, null=True, blank=True)
    contact_email = models.EmailField(_("è”ç³»äººé‚®ç®±"), null=True, blank=True)
```

**åˆ†æç»“è®º**ï¼š
- âœ… **åŸºç¡€ç§Ÿæˆ·æ¨¡å‹** - åŒ…å«ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯
- âœ… **æ— éœ€ä¿®æ”¹** - è®¾è®¡æ–¹æ¡ˆå®Œå…¨åŸºäºç°æœ‰ç§Ÿæˆ·è¿›è¡Œæ•°æ®éš”ç¦»

#### 4. Useræ¨¡å‹ (`users/models.py`)
```python
class User(BaseUserModel):
    """ç®¡ç†å‘˜ç”¨æˆ·æ¨¡å‹ï¼ŒåŒ…æ‹¬è¶…çº§ç®¡ç†å‘˜å’Œç§Ÿæˆ·ç®¡ç†å‘˜"""
    is_admin = models.BooleanField(_("æ˜¯å¦ç®¡ç†å‘˜"), default=True)
    is_super_admin = models.BooleanField(_("æ˜¯å¦è¶…çº§ç®¡ç†å‘˜"), default=False)
```

**åˆ†æç»“è®º**ï¼š
- âœ… **ç®¡ç†å‘˜ç”¨æˆ·æ¨¡å‹** - ç”¨äºç³»ç»Ÿç®¡ç†
- âœ… **æ— éœ€ä¿®æ”¹** - ä¸ç§¯åˆ†ç³»ç»Ÿæ— å…³

### âŒ ä¸å­˜åœ¨çš„æ¨¡å‹ï¼ˆå¯ä»¥å®‰å…¨æ–°å»ºï¼‰

#### 1. LicenseAssignmentæ¨¡å‹
**éªŒè¯æ–¹æ³•**ï¼š
```bash
grep -r "LicenseAssignment" /Users/fengxuan/Documents/Github/lipeaks_backend --include="*.py"
# ç»“æœï¼šæ— ä»»ä½•åŒ¹é…
```
**ç»“è®º**: åœ¨ç°æœ‰ä»£ç ä¸­**å®Œå…¨ä¸å­˜åœ¨**ï¼Œå¯ä»¥å®‰å…¨æ–°å»º

#### 2. ç§¯åˆ†ç³»ç»Ÿç›¸å…³æ¨¡å‹
**éªŒè¯æ–¹æ³•**ï¼š
```bash
grep -r "points|Points|score|Score|level|Level" /Users/fengxuan/Documents/Github/lipeaks_backend --include="*.py"
# ç»“æœï¼šåªæœ‰æ— å…³çš„system levelã€log levelç­‰ï¼Œæ— ç§¯åˆ†ç³»ç»Ÿ
```
**ç»“è®º**: ç§¯åˆ†ç³»ç»Ÿåœ¨ç°æœ‰ä»£ç ä¸­**å®Œå…¨ä¸å­˜åœ¨**ï¼Œå¯ä»¥å®‰å…¨æ–°å»º

#### 3. ç”¨æˆ·åˆ†çº§ç›¸å…³æ¨¡å‹
**éªŒè¯æ–¹æ³•**ï¼š
```bash
grep -r "vip|VIP|user.*type|UserType" /Users/fengxuan/Documents/Github/lipeaks_backend --include="*.py"
# ç»“æœï¼šæ— ç›¸å…³ç”¨æˆ·åˆ†çº§æ¨¡å‹
```
**ç»“è®º**: ç”¨æˆ·åˆ†çº§ç³»ç»Ÿåœ¨ç°æœ‰ä»£ç ä¸­**å®Œå…¨ä¸å­˜åœ¨**ï¼Œå¯ä»¥å®‰å…¨æ–°å»º

## ğŸ¯ è®¾è®¡æ–¹æ¡ˆéªŒè¯

### âœ… å®Œå…¨ç¬¦åˆ"é›¶ä¿®æ”¹"è¦æ±‚

1. **Memberè¡¨å®Œå…¨ä¸ä¿®æ”¹** âœ…
   - ç°æœ‰ä»£ç ä¸­Memberæ¨¡å‹å®Œå…¨åŸå­
   - è®¾è®¡æ–¹æ¡ˆé€šè¿‡æ–°å»ºTenantUserProfileè¡¨å­˜å‚¨ç§¯åˆ†ä¿¡æ¯
   - ç°æœ‰Memberæ¨¡å‹å­—æ®µå®Œå…¨ä¸å˜

2. **Licenseè¡¨å®Œå…¨ä¸ä¿®æ”¹** âœ…  
   - ç°æœ‰ä»£ç ä¸­Licenseæ¨¡å‹å®Œå…¨åŸå­
   - ç°æœ‰æ¨¡å‹å·²åŒ…å«`max_activations`å’Œ`current_activations`å­—æ®µ
   - è®¾è®¡æ–¹æ¡ˆå®Œå…¨åŸºäºç°æœ‰å­—æ®µè¿›è¡Œé…é¢ç®¡ç†

3. **Tenantè¡¨å®Œå…¨ä¸ä¿®æ”¹** âœ…
   - ç°æœ‰ä»£ç ä¸­Tenantæ¨¡å‹ä¿æŒä¸å˜
   - è®¾è®¡æ–¹æ¡ˆé€šè¿‡æ–°è¡¨å®ç°ç§Ÿæˆ·éš”ç¦»åŠŸèƒ½

### âœ… æ–°åŠŸèƒ½é€šè¿‡æ–°å¢ä»£ç å®ç°

1. **LicenseAssignmentæ¨¡å‹** - å…¨æ–°ä»£ç ï¼Œæ— å†²çª
2. **TenantUserProfileæ¨¡å‹** - å…¨æ–°ä»£ç ï¼Œå®ç°ç§¯åˆ†å­˜å‚¨
3. **ç§¯åˆ†ç³»ç»Ÿç›¸å…³æ¨¡å‹** - å…¨æ–°ä»£ç ï¼Œå®ç°å®Œæ•´ç§¯åˆ†ä½“ç³»
4. **ç”¨æˆ·åˆ†çº§ç›¸å…³æ¨¡å‹** - å…¨æ–°ä»£ç ï¼Œå®ç°VIPç­‰çº§ç®¡ç†

## ğŸ“Š é£é™©è¯„ä¼°

### ğŸŸ¢ é›¶é£é™© - ç°æœ‰æ¨¡å‹
- Memberæ¨¡å‹ï¼šæ— ä»»ä½•ä¿®æ”¹
- Licenseæ¨¡å‹ï¼šæ— ä»»ä½•ä¿®æ”¹  
- Tenantæ¨¡å‹ï¼šæ— ä»»ä½•ä¿®æ”¹
- Useræ¨¡å‹ï¼šæ— ä»»ä½•ä¿®æ”¹

### ğŸŸ¢ é›¶é£é™© - æ–°å¢åŠŸèƒ½
- æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹çš„æ–°è¡¨å’Œæ–°æœåŠ¡
- ä¸ç°æœ‰ä»£ç æ— ä»»ä½•å†²çª
- æ”¯æŒç‹¬ç«‹éƒ¨ç½²å’Œå›æ»š
- ç°æœ‰APIå’Œä¸šåŠ¡é€»è¾‘å®Œå…¨ä¸å—å½±å“

## ğŸš€ ç»“è®º

**è®¾è®¡æ–¹æ¡ˆå®Œå…¨ç¬¦åˆç”¨æˆ·è¦æ±‚**ï¼š

1. âœ… **é›¶ä»£ç ä¿®æ”¹** - æ‰€æœ‰ç°æœ‰ä»£ç æ¨¡å‹ä¿æŒ100%ä¸å˜
2. âœ… **å‘ä¸‹å…¼å®¹** - ç°æœ‰ä¸šåŠ¡å’ŒAPIå®Œå…¨ä¸å—å½±å“
3. âœ… **å®‰å…¨éƒ¨ç½²** - æ–°åŠŸèƒ½å¯ç‹¬ç«‹éƒ¨ç½²ï¼Œæ”¯æŒå›æ»š
4. âœ… **åŠŸèƒ½å®Œæ•´** - é€šè¿‡æ–°å¢æ¨¡å‹å®ç°å®Œæ•´çš„å¤šç§Ÿæˆ·ç§¯åˆ†ç³»ç»Ÿ

**å®æ–½å»ºè®®**ï¼š
- å¯ä»¥ç›´æ¥æŒ‰ç…§è®¾è®¡æ–‡æ¡£è¿›è¡Œå®æ–½
- æ— éœ€æ‹…å¿ƒç ´åç°æœ‰ä»£ç 
- å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ–°åŠŸèƒ½
- æ”¯æŒæ¸è¿›å¼ä¸Šçº¿ï¼Œé™ä½é£é™©

---

**åˆ†ææ—¶é—´**: 2024å¹´9æœˆ24æ—¥  
**åˆ†æèŒƒå›´**: æ•´ä¸ªlipeaks_backendä»£ç åº“  
**åˆ†ææ–¹æ³•**: ä»£ç æ–‡ä»¶æ·±åº¦é˜…è¯» + grepå…¨å±€æœç´¢éªŒè¯
