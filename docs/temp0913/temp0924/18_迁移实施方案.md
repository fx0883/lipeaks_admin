# è¿ç§»å®æ–½æ–¹æ¡ˆ

## ğŸ¯ è¿ç§»ç›®æ ‡ä¸ç­–ç•¥

### è¿ç§»ç›®æ ‡
- **é›¶åœæœºè¿ç§»**: ä¸šåŠ¡æ— æ„ŸçŸ¥å‡çº§åˆ°æ–°çš„ç»Ÿä¸€ç­‰çº§ç³»ç»Ÿ
- **æ•°æ®å®Œæ•´æ€§**: ç¡®ä¿ç°æœ‰ç”¨æˆ·æ•°æ®å’Œæƒé™ä¸ä¸¢å¤±
- **å¹³æ»‘è¿‡æ¸¡**: ç”¨æˆ·ä½“éªŒè¿ç»­ï¼Œæƒé™é€æ­¥ä¼˜åŒ–
- **å¿«é€Ÿå›æ»š**: é‡åˆ°é—®é¢˜èƒ½å¤Ÿå¿«é€Ÿå›åˆ°åŸç³»ç»Ÿ

### è¿ç§»ç­–ç•¥
- **åˆ†é˜¶æ®µå®æ–½**: åˆ†4ä¸ªé˜¶æ®µé€æ­¥è¿ç§»ï¼Œæ¯é˜¶æ®µå¯ç‹¬ç«‹éªŒè¯
- **ç°åº¦å‘å¸ƒ**: å…ˆåœ¨å°éƒ¨åˆ†ç”¨æˆ·ä¸­æµ‹è¯•ï¼Œé€æ­¥æ‰©å¤§èŒƒå›´
- **åŒç³»ç»Ÿå¹¶è¡Œ**: æ–°æ—§ç³»ç»Ÿå¹¶è¡Œè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç¡®ä¿ç¨³å®šæ€§
- **æ•°æ®åŒæ­¥**: å®æ—¶åŒæ­¥å…³é”®æ•°æ®ï¼Œä¿è¯ä¸€è‡´æ€§

## ğŸ“… è¯¦ç»†å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½å»ºè®¾ (ç¬¬1-2å‘¨)

#### Week 1: æ•°æ®æ¨¡å‹åˆ›å»º

##### Day 1-2: åˆ›å»ºæ–°è¡¨ç»“æ„
```sql
-- 1. åˆ›å»ºç”¨æˆ·ç­‰çº§è¡¨
CREATE TABLE user_level (
    -- å®Œæ•´è¡¨ç»“æ„è§æ•°æ®æ¨¡å‹è®¾è®¡æ–‡æ¡£
);

-- æ’å…¥åˆå§‹ç­‰çº§æ•°æ®
INSERT INTO user_level (level_name, level_code, level_order, min_points, max_points, ...) VALUES
('é’é“œ', 'bronze', 1, 0, 999, ...),
('ç™½é“¶', 'silver', 2, 1000, 2999, ...),
-- ... å…¶ä»–ç­‰çº§

-- 2. åˆ›å»ºç”¨æˆ·æ ‡ç­¾è¡¨
CREATE TABLE user_type_tag (
    -- å®Œæ•´è¡¨ç»“æ„
);

-- æ’å…¥åˆå§‹æ ‡ç­¾æ•°æ®
INSERT INTO user_type_tag (tag_name, tag_code, tag_category, ...) VALUES
('VIPç”¨æˆ·', 'vip', 'payment', ...),
('ä¼ä¸šç”¨æˆ·', 'enterprise', 'business', ...),
-- ... å…¶ä»–æ ‡ç­¾

-- 3. åˆ›å»ºç§¯åˆ†è®°å½•è¡¨
CREATE TABLE user_points (
    -- å®Œæ•´è¡¨ç»“æ„
);

-- 4. åˆ›å»ºç”¨æˆ·æ ‡ç­¾å…³è”è¡¨
CREATE TABLE member_type_tag (
    -- å®Œæ•´è¡¨ç»“æ„
);
```

##### Day 3-4: æ‰©å±•ç°æœ‰Memberè¡¨
```sql
-- ä¸ºMemberè¡¨æ·»åŠ æ–°å­—æ®µ
ALTER TABLE member ADD COLUMN total_points INTEGER NOT NULL DEFAULT 0;
ALTER TABLE member ADD COLUMN available_points INTEGER NOT NULL DEFAULT 0;
ALTER TABLE member ADD COLUMN current_level_id BIGINT REFERENCES user_level(id);
ALTER TABLE member ADD COLUMN level_updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW();

-- åˆ›å»ºå¿…è¦ç´¢å¼•
CREATE INDEX idx_member_total_points ON member (total_points DESC);
CREATE INDEX idx_member_level ON member (current_level_id);

-- æ·»åŠ çº¦æŸ
ALTER TABLE member ADD CONSTRAINT valid_points CHECK (total_points >= 0 AND available_points >= 0);
```

##### Day 5: éªŒè¯æ•°æ®ç»“æ„
```python
# éªŒè¯è„šæœ¬
def validate_table_structure():
    """éªŒè¯æ–°å»ºè¡¨ç»“æ„çš„å®Œæ•´æ€§"""
    
    # æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
    tables_to_check = ['user_level', 'user_type_tag', 'user_points', 'member_type_tag']
    for table in tables_to_check:
        assert table_exists(table), f"è¡¨ {table} ä¸å­˜åœ¨"
    
    # æ£€æŸ¥å­—æ®µå®Œæ•´æ€§
    member_fields = get_table_fields('member')
    required_fields = ['total_points', 'available_points', 'current_level_id', 'level_updated_at']
    for field in required_fields:
        assert field in member_fields, f"Memberè¡¨ç¼ºå°‘å­—æ®µ {field}"
    
    # æ£€æŸ¥ç´¢å¼•
    indexes = get_table_indexes('member')
    required_indexes = ['idx_member_total_points', 'idx_member_level']
    for index in required_indexes:
        assert index in indexes, f"ç¼ºå°‘ç´¢å¼• {index}"
    
    print("âœ… æ•°æ®ç»“æ„éªŒè¯é€šè¿‡")
```

#### Week 2: æ ¸å¿ƒæœåŠ¡å¼€å‘

##### Day 1-2: å¼€å‘ç§¯åˆ†æœåŠ¡
```python
# å®ç°ç§¯åˆ†ç®¡ç†æ ¸å¿ƒæœåŠ¡
class PointsService:
    def add_points(self, member_id, points, category, **kwargs):
        """æ·»åŠ ç§¯åˆ†çš„æ ¸å¿ƒå®ç°"""
        pass
    
    def spend_points(self, member_id, points, category, **kwargs):
        """æ¶ˆè´¹ç§¯åˆ†çš„æ ¸å¿ƒå®ç°"""
        pass
    
    def calculate_available_points(self, member_id):
        """è®¡ç®—ç”¨æˆ·å¯ç”¨ç§¯åˆ†"""
        pass

# ç¼–å†™å•å…ƒæµ‹è¯•
class TestPointsService(TestCase):
    def test_add_points_success(self):
        """æµ‹è¯•æˆåŠŸæ·»åŠ ç§¯åˆ†"""
        pass
    
    def test_spend_points_insufficient(self):
        """æµ‹è¯•ç§¯åˆ†ä¸è¶³çš„æƒ…å†µ"""
        pass
```

##### Day 3-4: å¼€å‘æƒé™æœåŠ¡
```python
# å®ç°æƒé™è®¡ç®—æ ¸å¿ƒæœåŠ¡
class PermissionService:
    def get_user_permissions(self, member_id, force_refresh=False):
        """è·å–ç”¨æˆ·å®Œæ•´æƒé™"""
        pass
    
    def check_permission(self, member_id, permission_key):
        """æ£€æŸ¥ç‰¹å®šæƒé™"""
        pass
    
    def invalidate_cache(self, member_id):
        """æ¸…é™¤æƒé™ç¼“å­˜"""
        pass

# æ€§èƒ½æµ‹è¯•
def test_permission_calculation_performance():
    """æµ‹è¯•æƒé™è®¡ç®—æ€§èƒ½"""
    start_time = time.time()
    for i in range(1000):
        permissions = PermissionService().get_user_permissions(test_user_id)
    end_time = time.time()
    
    avg_time = (end_time - start_time) / 1000
    assert avg_time < 0.01, f"æƒé™è®¡ç®—å¹³å‡è€—æ—¶ {avg_time:.3f}s è¶…è¿‡10msé™åˆ¶"
```

##### Day 5: é›†æˆæµ‹è¯•å’Œä¼˜åŒ–
```python
# é›†æˆæµ‹è¯•å¥—ä»¶
class IntegrationTestSuite:
    def test_points_to_level_flow(self):
        """æµ‹è¯•ç§¯åˆ†åˆ°ç­‰çº§çš„å®Œæ•´æµç¨‹"""
        # 1. ç”¨æˆ·è·å¾—ç§¯åˆ†
        result = PointsService().add_points(user_id, 1000, 'login')
        assert result['success']
        
        # 2. æ£€æŸ¥ç­‰çº§æ˜¯å¦è‡ªåŠ¨æ›´æ–°
        user = Member.objects.get(id=user_id)
        assert user.current_level.level_code == 'silver'
        
        # 3. æ£€æŸ¥æƒé™æ˜¯å¦æ›´æ–°
        permissions = PermissionService().get_user_permissions(user_id)
        assert permissions['level']['code'] == 'silver'
        
        # 4. æ£€æŸ¥è®¸å¯è¯é…é¢æ˜¯å¦æ›´æ–°
        assert permissions['quota']['max_licenses'] == 5
```

### ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®è¿ç§»å‡†å¤‡ (ç¬¬3å‘¨)

#### ç°æœ‰æ•°æ®åˆ†æä¸æ˜ å°„

##### Day 1-2: ç°æœ‰ç”¨æˆ·ç±»å‹æ•°æ®åˆ†æ
```python
# æ•°æ®åˆ†æè„šæœ¬
def analyze_existing_user_types():
    """åˆ†æç°æœ‰ç”¨æˆ·ç±»å‹åˆ†å¸ƒ"""
    
    # ç»Ÿè®¡ç°æœ‰ç”¨æˆ·ç±»å‹åˆ†å¸ƒ
    user_type_stats = Member.objects.values('user_type_id').annotate(
        count=Count('id')
    ).order_by('-count')
    
    print("ç°æœ‰ç”¨æˆ·ç±»å‹åˆ†å¸ƒï¼š")
    for stat in user_type_stats:
        user_type = UserType.objects.get(id=stat['user_type_id']) if stat['user_type_id'] else None
        print(f"  {user_type.name if user_type else 'æœªè®¾ç½®'}: {stat['count']} ç”¨æˆ·")
    
    # åˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®
    active_users = Member.objects.filter(
        last_login__gte=timezone.now() - timedelta(days=30)
    ).count()
    
    license_users = Member.objects.filter(
        license_assignments__isnull=False
    ).distinct().count()
    
    print(f"æ´»è·ƒç”¨æˆ· (30å¤©å†…): {active_users}")
    print(f"æŒæœ‰è®¸å¯è¯ç”¨æˆ·: {license_users}")
    
    return {
        'user_type_distribution': user_type_stats,
        'active_users': active_users,
        'license_users': license_users
    }

# åˆ›å»ºè¿ç§»æ˜ å°„è¡¨
USER_TYPE_TO_TAG_MAPPING = {
    1: 'vip',        # åŸVIPç”¨æˆ· -> VIPæ ‡ç­¾
    2: 'enterprise', # åŸä¼ä¸šç”¨æˆ· -> ä¼ä¸šæ ‡ç­¾
    3: 'education',  # åŸæ•™è‚²ç”¨æˆ· -> æ•™è‚²æ ‡ç­¾
    # å…¶ä»–ç±»å‹æš‚ä¸æ˜ å°„ï¼Œç”¨æˆ·ä¿æŒä¸€èˆ¬ç”¨æˆ·ç­‰çº§
}
```

##### Day 3-4: ç§¯åˆ†è®¡ç®—ç­–ç•¥åˆ¶å®š
```python
def calculate_historical_points(member_id):
    """æ ¹æ®å†å²è¡Œä¸ºè®¡ç®—ç”¨æˆ·åº”æœ‰ç§¯åˆ†"""
    
    member = Member.objects.get(id=member_id)
    total_points = 0
    point_records = []
    
    # 1. æ³¨å†Œæ—¶é—´ç§¯åˆ† (åŸºç¡€ç§¯åˆ†)
    days_since_registration = (timezone.now().date() - member.created_at.date()).days
    registration_points = min(days_since_registration * 5, 500)  # æœ€å¤š500åˆ†
    total_points += registration_points
    point_records.append({
        'category': 'registration',
        'points': registration_points,
        'description': 'æ³¨å†Œæ—¶é•¿å¥–åŠ±'
    })
    
    # 2. è®¸å¯è¯æ´»åŠ¨ç§¯åˆ†
    license_assignments = member.license_assignments.filter(
        is_deleted=False
    ).count()
    license_points = license_assignments * 50  # æ¯ä¸ªè®¸å¯è¯50åˆ†
    total_points += license_points
    point_records.append({
        'category': 'license_activity',
        'points': license_points,
        'description': f'è®¸å¯è¯ç”³è¯·æ´»åŠ¨ ({license_assignments}ä¸ª)'
    })
    
    # 3. ç™»å½•æ´»è·ƒåº¦ç§¯åˆ†
    # å‡è®¾æ ¹æ®æœ€åç™»å½•æ—¶é—´æ¨ç®—æ´»è·ƒåº¦
    if member.last_login:
        days_since_login = (timezone.now() - member.last_login).days
        if days_since_login <= 7:
            activity_points = 200  # é«˜æ´»è·ƒ
        elif days_since_login <= 30:
            activity_points = 100  # ä¸­æ´»è·ƒ
        else:
            activity_points = 50   # ä½æ´»è·ƒ
        
        total_points += activity_points
        point_records.append({
            'category': 'activity',
            'points': activity_points,
            'description': 'ç”¨æˆ·æ´»è·ƒåº¦å¥–åŠ±'
        })
    
    # 4. ä»˜è´¹ç”¨æˆ·é¢å¤–ç§¯åˆ†
    if hasattr(member, 'payment_records'):
        payment_total = member.payment_records.aggregate(
            total=Sum('amount')
        )['total'] or 0
        payment_points = int(payment_total * 5)  # æ¯å…ƒ5åˆ†
        total_points += payment_points
        point_records.append({
            'category': 'payment',
            'points': payment_points,
            'description': f'å†å²ä»˜è´¹å¥–åŠ± (Â¥{payment_total})'
        })
    
    return {
        'total_points': total_points,
        'point_breakdown': point_records,
        'recommended_level': UserLevel.get_level_by_points(total_points)
    }
```

##### Day 5: è¿ç§»è„šæœ¬å¼€å‘
```python
def migrate_user_data_dry_run():
    """æ•°æ®è¿ç§»é¢„æ¼”ï¼ˆä¸å®é™…ä¿®æ”¹æ•°æ®ï¼‰"""
    
    migration_stats = {
        'total_users': 0,
        'users_with_points': 0,
        'users_with_tags': 0,
        'level_distribution': {},
        'tag_distribution': {},
        'errors': []
    }
    
    for member in Member.objects.all():
        try:
            migration_stats['total_users'] += 1
            
            # è®¡ç®—ç§¯åˆ†
            point_data = calculate_historical_points(member.id)
            if point_data['total_points'] > 0:
                migration_stats['users_with_points'] += 1
                
                # ç»Ÿè®¡ç­‰çº§åˆ†å¸ƒ
                level_code = point_data['recommended_level'].level_code
                migration_stats['level_distribution'][level_code] = \
                    migration_stats['level_distribution'].get(level_code, 0) + 1
            
            # æ£€æŸ¥æ ‡ç­¾æ˜ å°„
            if member.user_type_id in USER_TYPE_TO_TAG_MAPPING:
                migration_stats['users_with_tags'] += 1
                tag_code = USER_TYPE_TO_TAG_MAPPING[member.user_type_id]
                migration_stats['tag_distribution'][tag_code] = \
                    migration_stats['tag_distribution'].get(tag_code, 0) + 1
                    
        except Exception as e:
            migration_stats['errors'].append({
                'member_id': member.id,
                'error': str(e)
            })
    
    print("è¿ç§»é¢„æ¼”ç»“æœï¼š")
    print(f"  æ€»ç”¨æˆ·æ•°: {migration_stats['total_users']}")
    print(f"  å°†è·å¾—ç§¯åˆ†çš„ç”¨æˆ·: {migration_stats['users_with_points']}")
    print(f"  å°†è·å¾—æ ‡ç­¾çš„ç”¨æˆ·: {migration_stats['users_with_tags']}")
    print(f"  ç­‰çº§åˆ†å¸ƒ: {migration_stats['level_distribution']}")
    print(f"  æ ‡ç­¾åˆ†å¸ƒ: {migration_stats['tag_distribution']}")
    print(f"  é”™è¯¯æ•°é‡: {len(migration_stats['errors'])}")
    
    return migration_stats
```

### ç¬¬ä¸‰é˜¶æ®µï¼šç°åº¦è¿ç§»å®æ–½ (ç¬¬4-5å‘¨)

#### Week 4: å°è§„æ¨¡ç°åº¦æµ‹è¯•

##### Day 1-2: é€‰æ‹©ç°åº¦ç”¨æˆ·ç¾¤ä½“
```python
def select_gray_users(percentage=5):
    """é€‰æ‹©ç°åº¦æµ‹è¯•ç”¨æˆ·ï¼ˆ5%ç”¨æˆ·ï¼‰"""
    
    # é€‰æ‹©ç­–ç•¥ï¼š
    # 1. æ´»è·ƒç”¨æˆ·ä¼˜å…ˆ
    # 2. ä¸åŒç”¨æˆ·ç±»å‹å‡åŒ€åˆ†å¸ƒ
    # 3. åŒ…å«éƒ¨åˆ†æ–°ç”¨æˆ·å’Œè€ç”¨æˆ·
    
    total_users = Member.objects.count()
    gray_user_count = max(int(total_users * percentage / 100), 10)  # è‡³å°‘10ä¸ªç”¨æˆ·
    
    # æŒ‰æ´»è·ƒåº¦å’Œç”¨æˆ·ç±»å‹åˆ†å±‚é‡‡æ ·
    gray_users = []
    
    # 1. é€‰æ‹©æ´»è·ƒç”¨æˆ· (50%)
    active_users = Member.objects.filter(
        last_login__gte=timezone.now() - timedelta(days=7)
    ).order_by('?')[:gray_user_count // 2]
    gray_users.extend(active_users)
    
    # 2. é€‰æ‹©è€ç”¨æˆ· (30%)
    old_users = Member.objects.filter(
        created_at__lte=timezone.now() - timedelta(days=90)
    ).exclude(id__in=[u.id for u in gray_users]).order_by('?')[:gray_user_count * 3 // 10]
    gray_users.extend(old_users)
    
    # 3. é€‰æ‹©æ–°ç”¨æˆ· (20%)
    new_users = Member.objects.filter(
        created_at__gte=timezone.now() - timedelta(days=30)
    ).exclude(id__in=[u.id for u in gray_users]).order_by('?')[:gray_user_count - len(gray_users)]
    gray_users.extend(new_users)
    
    # æ ‡è®°ç°åº¦ç”¨æˆ·
    gray_user_ids = [u.id for u in gray_users]
    
    # åˆ›å»ºç°åº¦æ ‡è®°ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
    cache.set('gray_users_v1', gray_user_ids, timeout=30*24*60*60)  # 30å¤©è¿‡æœŸ
    
    print(f"é€‰æ‹©äº† {len(gray_users)} ä¸ªç°åº¦ç”¨æˆ·")
    return gray_user_ids

def is_gray_user(member_id):
    """åˆ¤æ–­æ˜¯å¦ä¸ºç°åº¦ç”¨æˆ·"""
    gray_users = cache.get('gray_users_v1', [])
    return member_id in gray_users
```

##### Day 3-4: ç°åº¦ç”¨æˆ·æ•°æ®è¿ç§»
```python
@transaction.atomic
def migrate_gray_users():
    """è¿ç§»ç°åº¦ç”¨æˆ·æ•°æ®"""
    
    gray_user_ids = cache.get('gray_users_v1', [])
    if not gray_user_ids:
        raise ValueError("æœªæ‰¾åˆ°ç°åº¦ç”¨æˆ·åˆ—è¡¨")
    
    migration_results = {
        'success_count': 0,
        'error_count': 0,
        'errors': []
    }
    
    for member_id in gray_user_ids:
        try:
            migrate_single_user(member_id)
            migration_results['success_count'] += 1
            
        except Exception as e:
            migration_results['error_count'] += 1
            migration_results['errors'].append({
                'member_id': member_id,
                'error': str(e)
            })
            logger.error(f"è¿ç§»ç”¨æˆ· {member_id} å¤±è´¥: {str(e)}")
    
    print(f"ç°åº¦è¿ç§»å®Œæˆ: æˆåŠŸ {migration_results['success_count']}, å¤±è´¥ {migration_results['error_count']}")
    return migration_results

def migrate_single_user(member_id):
    """è¿ç§»å•ä¸ªç”¨æˆ·çš„æ•°æ®"""
    
    member = Member.objects.get(id=member_id)
    
    # 1. è®¡ç®—å¹¶è®¾ç½®ç§¯åˆ†
    point_data = calculate_historical_points(member_id)
    
    if point_data['total_points'] > 0:
        # åˆ›å»ºåˆå§‹ç§¯åˆ†è®°å½•
        UserPoints.objects.create(
            member=member,
            point_type='earn',
            category='migration',
            subcategory='historical_data',
            points=point_data['total_points'],
            balance_before=0,
            balance_after=point_data['total_points'],
            operation_reason='å†å²æ•°æ®è¿ç§»åˆå§‹ç§¯åˆ†',
            source_type='migration',
            is_manual=True
        )
        
        # æ›´æ–°ç”¨æˆ·ç§¯åˆ†
        member.total_points = point_data['total_points']
        member.available_points = point_data['total_points']
    
    # 2. è®¾ç½®ç”¨æˆ·ç­‰çº§
    if point_data['recommended_level']:
        member.current_level = point_data['recommended_level']
        member.level_updated_at = timezone.now()
    
    # 3. è¿ç§»ç”¨æˆ·ç±»å‹åˆ°æ ‡ç­¾
    if member.user_type_id in USER_TYPE_TO_TAG_MAPPING:
        tag_code = USER_TYPE_TO_TAG_MAPPING[member.user_type_id]
        tag = UserTypeTag.objects.get(tag_code=tag_code)
        
        MemberTypeTag.objects.create(
            member=member,
            tag=tag,
            grant_method='migration',
            grant_reason='ä»åŸç”¨æˆ·ç±»å‹è¿ç§»',
            is_active=True
        )
    
    member.save()
    
    # 4. æ¸…é™¤æƒé™ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°è®¡ç®—
    cache.delete(f'user_perms:{member_id}')
    
    logger.info(f"ç”¨æˆ· {member_id} è¿ç§»å®Œæˆ: ç§¯åˆ†={point_data['total_points']}, ç­‰çº§={point_data['recommended_level'].level_name if point_data['recommended_level'] else 'æ— '}")
```

##### Day 5: ç°åº¦æ•ˆæœç›‘æ§
```python
def monitor_gray_migration():
    """ç›‘æ§ç°åº¦è¿ç§»æ•ˆæœ"""
    
    gray_user_ids = cache.get('gray_users_v1', [])
    
    # 1. æƒé™è®¡ç®—æ€§èƒ½ç›‘æ§
    permission_times = []
    for user_id in gray_user_ids[:100]:  # é‡‡æ ·100ä¸ªç”¨æˆ·
        start_time = time.time()
        PermissionService().get_user_permissions(user_id)
        end_time = time.time()
        permission_times.append(end_time - start_time)
    
    avg_permission_time = sum(permission_times) / len(permission_times)
    max_permission_time = max(permission_times)
    
    # 2. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
    consistency_errors = []
    for user_id in gray_user_ids:
        try:
            member = Member.objects.get(id=user_id)
            
            # æ£€æŸ¥ç§¯åˆ†å’Œç­‰çº§ä¸€è‡´æ€§
            expected_level = UserLevel.get_level_by_points(member.total_points)
            if member.current_level != expected_level:
                consistency_errors.append({
                    'user_id': user_id,
                    'error': f'ç­‰çº§ä¸ä¸€è‡´: æœŸæœ›{expected_level}, å®é™…{member.current_level}'
                })
            
            # æ£€æŸ¥å¯ç”¨ç§¯åˆ†è®¡ç®—
            calculated_available = calculate_available_points(user_id)
            if abs(member.available_points - calculated_available) > 0:
                consistency_errors.append({
                    'user_id': user_id,
                    'error': f'å¯ç”¨ç§¯åˆ†ä¸ä¸€è‡´: æœŸæœ›{calculated_available}, å®é™…{member.available_points}'
                })
                
        except Exception as e:
            consistency_errors.append({
                'user_id': user_id,
                'error': f'æ£€æŸ¥å¤±è´¥: {str(e)}'
            })
    
    # 3. ç”¨æˆ·åé¦ˆæ”¶é›†
    feedback_stats = {
        'positive': 0,
        'negative': 0,
        'neutral': 0
    }
    
    # è¿™é‡Œå¯ä»¥é›†æˆç”¨æˆ·åé¦ˆç³»ç»Ÿçš„æ•°æ®
    
    print("ç°åº¦è¿ç§»ç›‘æ§æŠ¥å‘Šï¼š")
    print(f"  æƒé™è®¡ç®—å¹³å‡è€—æ—¶: {avg_permission_time:.3f}s")
    print(f"  æƒé™è®¡ç®—æœ€å¤§è€—æ—¶: {max_permission_time:.3f}s")
    print(f"  æ•°æ®ä¸€è‡´æ€§é”™è¯¯: {len(consistency_errors)} ä¸ª")
    print(f"  ç”¨æˆ·åé¦ˆ: æ­£é¢{feedback_stats['positive']} ä¸­æ€§{feedback_stats['neutral']} è´Ÿé¢{feedback_stats['negative']}")
    
    # åˆ¤æ–­æ˜¯å¦å¯ä»¥ç»§ç»­å…¨é‡è¿ç§»
    migration_ready = (
        avg_permission_time < 0.1 and  # æƒé™è®¡ç®—å¹³å‡è€—æ—¶<100ms
        max_permission_time < 0.5 and  # æœ€å¤§è€—æ—¶<500ms
        len(consistency_errors) < len(gray_user_ids) * 0.01 and  # é”™è¯¯ç‡<1%
        feedback_stats['negative'] < feedback_stats['positive']  # æ­£é¢åé¦ˆå¤šäºè´Ÿé¢
    )
    
    return {
        'migration_ready': migration_ready,
        'performance': {'avg': avg_permission_time, 'max': max_permission_time},
        'consistency_errors': consistency_errors,
        'feedback': feedback_stats
    }
```

#### Week 5: ç°åº¦èŒƒå›´æ‰©å¤§

##### Day 1-3: æ‰©å¤§åˆ°20%ç”¨æˆ·
```python
def expand_gray_migration(target_percentage=20):
    """æ‰©å¤§ç°åº¦èŒƒå›´åˆ°20%ç”¨æˆ·"""
    
    current_gray_users = cache.get('gray_users_v1', [])
    total_users = Member.objects.count()
    target_count = int(total_users * target_percentage / 100)
    additional_needed = target_count - len(current_gray_users)
    
    if additional_needed <= 0:
        print("å½“å‰ç°åº¦ç”¨æˆ·æ•°é‡å·²è¶³å¤Ÿ")
        return current_gray_users
    
    # é€‰æ‹©é¢å¤–çš„ç”¨æˆ·
    additional_users = Member.objects.exclude(
        id__in=current_gray_users
    ).order_by('?')[:additional_needed]
    
    # è¿ç§»æ–°å¢ç”¨æˆ·
    for member in additional_users:
        try:
            migrate_single_user(member.id)
            current_gray_users.append(member.id)
        except Exception as e:
            logger.error(f"è¿ç§»ç”¨æˆ· {member.id} å¤±è´¥: {str(e)}")
    
    # æ›´æ–°ç°åº¦ç”¨æˆ·åˆ—è¡¨
    cache.set('gray_users_v1', current_gray_users, timeout=30*24*60*60)
    
    print(f"ç°åº¦èŒƒå›´æ‰©å¤§å®Œæˆï¼Œå½“å‰ç°åº¦ç”¨æˆ·æ•°: {len(current_gray_users)}")
    return current_gray_users
```

##### Day 4-5: åŒç³»ç»Ÿå…¼å®¹æ€§éªŒè¯
```python
def validate_dual_system_compatibility():
    """éªŒè¯åŒç³»ç»Ÿå…¼å®¹æ€§"""
    
    gray_users = cache.get('gray_users_v1', [])
    validation_results = {
        'permission_consistency': [],
        'quota_consistency': [],
        'api_compatibility': [],
        'performance_comparison': []
    }
    
    for user_id in gray_users[:50]:  # é‡‡æ ·éªŒè¯
        try:
            # 1. æƒé™ä¸€è‡´æ€§éªŒè¯
            old_permissions = get_legacy_user_permissions(user_id)
            new_permissions = PermissionService().get_user_permissions(user_id)
            
            # æ¯”è¾ƒå…³é”®æƒé™
            key_permissions = ['license_request', 'api_access', 'batch_operations']
            for perm in key_permissions:
                old_value = old_permissions.get(perm, False)
                new_value = new_permissions['permissions'].get(perm, False)
                
                if old_value != new_value:
                    validation_results['permission_consistency'].append({
                        'user_id': user_id,
                        'permission': perm,
                        'old_value': old_value,
                        'new_value': new_value
                    })
            
            # 2. é…é¢ä¸€è‡´æ€§éªŒè¯
            old_quota = get_legacy_user_quota(user_id)
            new_quota = new_permissions['quota']
            
            if old_quota.get('max_licenses', 0) > new_quota.get('max_licenses', 0):
                validation_results['quota_consistency'].append({
                    'user_id': user_id,
                    'old_quota': old_quota['max_licenses'],
                    'new_quota': new_quota['max_licenses']
                })
            
            # 3. APIå…¼å®¹æ€§æµ‹è¯•
            api_test_result = test_user_api_compatibility(user_id)
            if not api_test_result['success']:
                validation_results['api_compatibility'].append({
                    'user_id': user_id,
                    'error': api_test_result['error']
                })
                
        except Exception as e:
            logger.error(f"éªŒè¯ç”¨æˆ· {user_id} å…¼å®¹æ€§å¤±è´¥: {str(e)}")
    
    # ç”Ÿæˆå…¼å®¹æ€§æŠ¥å‘Š
    compatibility_score = calculate_compatibility_score(validation_results)
    
    print(f"åŒç³»ç»Ÿå…¼å®¹æ€§éªŒè¯å®Œæˆï¼Œå…¼å®¹æ€§è¯„åˆ†: {compatibility_score:.2f}/100")
    
    return {
        'compatibility_score': compatibility_score,
        'validation_results': validation_results,
        'ready_for_full_migration': compatibility_score >= 95
    }
```

### ç¬¬å››é˜¶æ®µï¼šå…¨é‡è¿ç§» (ç¬¬6-7å‘¨)

#### Week 6: å…¨é‡æ•°æ®è¿ç§»

##### Day 1-2: å…¨é‡è¿ç§»å‡†å¤‡
```python
def prepare_full_migration():
    """å…¨é‡è¿ç§»å‡†å¤‡å·¥ä½œ"""
    
    # 1. æ•°æ®å¤‡ä»½
    backup_result = create_full_backup()
    if not backup_result['success']:
        raise Exception(f"æ•°æ®å¤‡ä»½å¤±è´¥: {backup_result['error']}")
    
    # 2. ç³»ç»Ÿèµ„æºæ£€æŸ¥
    system_check = check_system_resources()
    if not system_check['ready']:
        raise Exception(f"ç³»ç»Ÿèµ„æºä¸è¶³: {system_check['issues']}")
    
    # 3. è¿ç§»ä»»åŠ¡é˜Ÿåˆ—å‡†å¤‡
    setup_migration_queue()
    
    # 4. ç›‘æ§ç³»ç»Ÿå‡†å¤‡
    setup_migration_monitoring()
    
    # 5. å›æ»šæ–¹æ¡ˆå‡†å¤‡
    prepare_rollback_plan()
    
    print("å…¨é‡è¿ç§»å‡†å¤‡å·¥ä½œå®Œæˆ")
    return True

def create_full_backup():
    """åˆ›å»ºå®Œæ•´æ•°æ®å¤‡ä»½"""
    backup_tables = [
        'member', 'user_type', 'license_assignment', 
        'user_points', 'user_level', 'user_type_tag', 'member_type_tag'
    ]
    
    backup_timestamp = timezone.now().strftime('%Y%m%d_%H%M%S')
    backup_path = f"/backups/migration_backup_{backup_timestamp}"
    
    try:
        for table in backup_tables:
            subprocess.run([
                'pg_dump', 
                '--table', table,
                '--data-only',
                '--file', f"{backup_path}/{table}.sql",
                settings.DATABASES['default']['NAME']
            ], check=True)
        
        return {'success': True, 'backup_path': backup_path}
    except subprocess.CalledProcessError as e:
        return {'success': False, 'error': str(e)}
```

##### Day 3-4: æ‰¹é‡è¿ç§»æ‰§è¡Œ
```python
@shared_task(bind=True)
def batch_migrate_users(self, user_ids_batch):
    """æ‰¹é‡è¿ç§»ç”¨æˆ·æ•°æ®çš„å¼‚æ­¥ä»»åŠ¡"""
    
    batch_size = len(user_ids_batch)
    success_count = 0
    error_count = 0
    errors = []
    
    for i, user_id in enumerate(user_ids_batch):
        try:
            # æ›´æ–°ä»»åŠ¡è¿›åº¦
            self.update_state(
                state='PROGRESS',
                meta={
                    'current': i + 1,
                    'total': batch_size,
                    'status': f'è¿ç§»ç”¨æˆ· {user_id}'
                }
            )
            
            migrate_single_user(user_id)
            success_count += 1
            
        except Exception as e:
            error_count += 1
            errors.append({'user_id': user_id, 'error': str(e)})
            logger.error(f"è¿ç§»ç”¨æˆ· {user_id} å¤±è´¥: {str(e)}")
    
    return {
        'batch_size': batch_size,
        'success_count': success_count,
        'error_count': error_count,
        'errors': errors
    }

def execute_full_migration():
    """æ‰§è¡Œå…¨é‡è¿ç§»"""
    
    # è·å–æ‰€æœ‰å¾…è¿ç§»ç”¨æˆ·
    gray_users = cache.get('gray_users_v1', [])
    all_users = Member.objects.exclude(id__in=gray_users).values_list('id', flat=True)
    
    batch_size = 100  # æ¯æ‰¹å¤„ç†100ä¸ªç”¨æˆ·
    batches = [all_users[i:i+batch_size] for i in range(0, len(all_users), batch_size)]
    
    # å¯åŠ¨å¼‚æ­¥è¿ç§»ä»»åŠ¡
    migration_tasks = []
    for batch in batches:
        task = batch_migrate_users.delay(list(batch))
        migration_tasks.append(task)
    
    print(f"å¯åŠ¨äº† {len(migration_tasks)} ä¸ªè¿ç§»ä»»åŠ¡ï¼Œå…± {len(all_users)} ä¸ªç”¨æˆ·")
    
    # ç›‘æ§è¿ç§»è¿›åº¦
    monitor_migration_progress(migration_tasks)
    
    return migration_tasks

def monitor_migration_progress(migration_tasks):
    """ç›‘æ§è¿ç§»è¿›åº¦"""
    
    while True:
        completed_tasks = 0
        total_success = 0
        total_errors = 0
        
        for task in migration_tasks:
            if task.ready():
                completed_tasks += 1
                if task.successful():
                    result = task.result
                    total_success += result['success_count']
                    total_errors += result['error_count']
        
        progress = completed_tasks / len(migration_tasks) * 100
        
        print(f"è¿ç§»è¿›åº¦: {progress:.1f}% ({completed_tasks}/{len(migration_tasks)} æ‰¹æ¬¡å®Œæˆ)")
        print(f"æˆåŠŸ: {total_success}, å¤±è´¥: {total_errors}")
        
        if completed_tasks == len(migration_tasks):
            break
        
        time.sleep(30)  # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    
    print("å…¨é‡è¿ç§»å®Œæˆï¼")
```

##### Day 5: æ•°æ®éªŒè¯å’Œä¿®å¤
```python
def validate_and_fix_migration():
    """éªŒè¯è¿ç§»ç»“æœå¹¶ä¿®å¤é—®é¢˜"""
    
    validation_report = {
        'total_users': Member.objects.count(),
        'migrated_users': Member.objects.exclude(total_points=0).count(),
        'data_issues': [],
        'fixed_issues': 0
    }
    
    # 1. æ£€æŸ¥ç§¯åˆ†å’Œç­‰çº§ä¸€è‡´æ€§
    inconsistent_users = Member.objects.extra(
        where=["""
            current_level_id != (
                SELECT id FROM user_level 
                WHERE min_points <= total_points 
                AND (max_points IS NULL OR total_points <= max_points)
                AND is_active = true
                ORDER BY level_order DESC 
                LIMIT 1
            )
        """]
    )
    
    for member in inconsistent_users:
        correct_level = UserLevel.get_level_by_points(member.total_points)
        if correct_level:
            member.current_level = correct_level
            member.level_updated_at = timezone.now()
            member.save()
            validation_report['fixed_issues'] += 1
        else:
            validation_report['data_issues'].append({
                'user_id': member.id,
                'issue': f'æ— æ³•ä¸ºç§¯åˆ† {member.total_points} æ‰¾åˆ°å¯¹åº”ç­‰çº§'
            })
    
    # 2. æ£€æŸ¥å¯ç”¨ç§¯åˆ†è®¡ç®—
    for member in Member.objects.filter(available_points__gt=0):
        calculated_available = calculate_available_points(member.id)
        if abs(member.available_points - calculated_available) > 0:
            member.available_points = calculated_available
            member.save()
            validation_report['fixed_issues'] += 1
    
    # 3. æ£€æŸ¥æƒé™ç¼“å­˜ä¸€è‡´æ€§
    cache_issues = 0
    for member_id in Member.objects.values_list('id', flat=True):
        try:
            # æ¸…é™¤å¹¶é‡æ–°è®¡ç®—æƒé™ç¼“å­˜
            cache.delete(f'user_perms:{member_id}')
            PermissionService().get_user_permissions(member_id)
        except Exception as e:
            validation_report['data_issues'].append({
                'user_id': member_id,
                'issue': f'æƒé™è®¡ç®—å¤±è´¥: {str(e)}'
            })
            cache_issues += 1
    
    print(f"æ•°æ®éªŒè¯å®Œæˆ: ä¿®å¤äº† {validation_report['fixed_issues']} ä¸ªé—®é¢˜")
    print(f"å‰©ä½™é—®é¢˜: {len(validation_report['data_issues'])} ä¸ª")
    
    return validation_report
```

## ğŸ”’ é£é™©æ§åˆ¶ä¸å›æ»šæ–¹æ¡ˆ

### å…³é”®é£é™©ç‚¹è¯†åˆ«

#### 1. æ•°æ®é£é™©
```python
# æ•°æ®ä¸¢å¤±é£é™©æ§åˆ¶
class DataProtectionManager:
    
    def create_checkpoint(self, checkpoint_name):
        """åˆ›å»ºæ•°æ®æ£€æŸ¥ç‚¹"""
        checkpoint = {
            'name': checkpoint_name,
            'timestamp': timezone.now(),
            'data_checksums': {},
            'record_counts': {}
        }
        
        # è®°å½•å…³é”®è¡¨çš„æ•°æ®æ ¡éªŒå’Œ
        critical_tables = ['member', 'user_points', 'member_type_tag']
        for table in critical_tables:
            checkpoint['record_counts'][table] = self.get_table_count(table)
            checkpoint['data_checksums'][table] = self.calculate_table_checksum(table)
        
        # ä¿å­˜æ£€æŸ¥ç‚¹
        cache.set(f'checkpoint:{checkpoint_name}', checkpoint, timeout=7*24*60*60)
        return checkpoint
    
    def validate_checkpoint(self, checkpoint_name):
        """éªŒè¯æ•°æ®æ£€æŸ¥ç‚¹"""
        checkpoint = cache.get(f'checkpoint:{checkpoint_name}')
        if not checkpoint:
            raise ValueError(f"æ£€æŸ¥ç‚¹ {checkpoint_name} ä¸å­˜åœ¨")
        
        validation_result = {'valid': True, 'issues': []}
        
        for table in checkpoint['record_counts']:
            current_count = self.get_table_count(table)
            expected_count = checkpoint['record_counts'][table]
            
            if current_count < expected_count:
                validation_result['valid'] = False
                validation_result['issues'].append({
                    'table': table,
                    'issue': f'è®°å½•æ•°é‡å‡å°‘: {expected_count} -> {current_count}'
                })
        
        return validation_result
```

#### 2. æ€§èƒ½é£é™©
```python
# æ€§èƒ½ç›‘æ§å’Œä¿æŠ¤
class PerformanceMonitor:
    
    def __init__(self):
        self.metrics = {
            'permission_calc_times': [],
            'db_query_times': [],
            'cache_hit_rates': [],
            'api_response_times': []
        }
    
    def monitor_permission_performance(self):
        """ç›‘æ§æƒé™è®¡ç®—æ€§èƒ½"""
        sample_users = Member.objects.order_by('?')[:100]
        
        for user in sample_users:
            start_time = time.time()
            PermissionService().get_user_permissions(user.id)
            end_time = time.time()
            
            calc_time = end_time - start_time
            self.metrics['permission_calc_times'].append(calc_time)
            
            # å¦‚æœå•æ¬¡è®¡ç®—è¶…è¿‡1ç§’ï¼Œç«‹å³å‘Šè­¦
            if calc_time > 1.0:
                logger.critical(f"æƒé™è®¡ç®—æ€§èƒ½å‘Šè­¦: ç”¨æˆ· {user.id} è€—æ—¶ {calc_time:.3f}s")
        
        avg_time = sum(self.metrics['permission_calc_times']) / len(self.metrics['permission_calc_times'])
        
        if avg_time > 0.1:  # å¹³å‡è€—æ—¶è¶…è¿‡100ms
            return {'status': 'warning', 'avg_time': avg_time}
        else:
            return {'status': 'ok', 'avg_time': avg_time}
```

### å¿«é€Ÿå›æ»šæ–¹æ¡ˆ

#### 1. æ•°æ®å›æ»š
```python
def emergency_rollback():
    """ç´§æ€¥æ•°æ®å›æ»š"""
    
    print("å¼€å§‹ç´§æ€¥å›æ»š...")
    
    try:
        with transaction.atomic():
            # 1. æ¢å¤Memberè¡¨å­—æ®µ
            Member.objects.update(
                total_points=0,
                available_points=0,
                current_level_id=None,
                level_updated_at=None
            )
            
            # 2. æ¸…ç©ºæ–°å¢çš„è¡¨
            UserPoints.objects.all().delete()
            MemberTypeTag.objects.all().delete()
            
            # 3. æ¸…é™¤æ‰€æœ‰æƒé™ç¼“å­˜
            cache.clear()
            
            # 4. æ¢å¤åŸæœ‰çš„ç”¨æˆ·ç±»å‹æƒé™é€»è¾‘
            restore_legacy_permission_system()
            
        print("ç´§æ€¥å›æ»šå®Œæˆ")
        return {'success': True}
        
    except Exception as e:
        print(f"ç´§æ€¥å›æ»šå¤±è´¥: {str(e)}")
        return {'success': False, 'error': str(e)}

def restore_legacy_permission_system():
    """æ¢å¤åŸæœ‰æƒé™ç³»ç»Ÿ"""
    
    # é‡æ–°å¯ç”¨åŸæœ‰çš„æƒé™æ£€æŸ¥é€»è¾‘
    # è¿™é‡Œéœ€è¦æ ¹æ®å…·ä½“çš„åŸç³»ç»Ÿå®ç°æ¥ç¼–å†™
    
    # ç¤ºä¾‹ï¼šæ¢å¤åŸæœ‰çš„é…ç½®æ–‡ä»¶
    legacy_config = {
        'permission_system': 'legacy',
        'use_new_level_system': False,
        'use_points_system': False
    }
    
    cache.set('system_config', legacy_config, timeout=None)
```

#### 2. åˆ†æ­¥å›æ»š
```python
def gradual_rollback(rollback_percentage=10):
    """åˆ†æ­¥å›æ»šï¼ˆå…ˆå›æ»šéƒ¨åˆ†ç”¨æˆ·ï¼‰"""
    
    # é€‰æ‹©å›æ»šç”¨æˆ·ï¼ˆä»ç°åº¦ç”¨æˆ·å¼€å§‹ï¼‰
    gray_users = cache.get('gray_users_v1', [])
    rollback_count = min(len(gray_users), int(len(gray_users) * rollback_percentage / 100))
    rollback_users = gray_users[:rollback_count]
    
    rollback_results = {'success_count': 0, 'error_count': 0, 'errors': []}
    
    for user_id in rollback_users:
        try:
            # å›æ»šå•ä¸ªç”¨æˆ·
            member = Member.objects.get(id=user_id)
            
            # ä¿å­˜åŸæœ‰ç§¯åˆ†æ•°æ®ï¼ˆç”¨äºæ¢å¤ï¼‰
            original_points = member.total_points
            
            # é‡ç½®ç”¨æˆ·æ•°æ®
            member.total_points = 0
            member.available_points = 0
            member.current_level_id = None
            member.save()
            
            # åˆ é™¤ç§¯åˆ†è®°å½•
            member.point_records.all().delete()
            
            # åˆ é™¤æ ‡ç­¾å…³è”
            member.tag_relations.all().delete()
            
            # æ¸…é™¤æƒé™ç¼“å­˜
            cache.delete(f'user_perms:{user_id}')
            
            rollback_results['success_count'] += 1
            logger.info(f"ç”¨æˆ· {user_id} å›æ»šæˆåŠŸ (åŸç§¯åˆ†: {original_points})")
            
        except Exception as e:
            rollback_results['error_count'] += 1
            rollback_results['errors'].append({'user_id': user_id, 'error': str(e)})
            logger.error(f"ç”¨æˆ· {user_id} å›æ»šå¤±è´¥: {str(e)}")
    
    # æ›´æ–°ç°åº¦ç”¨æˆ·åˆ—è¡¨
    remaining_gray_users = gray_users[rollback_count:]
    cache.set('gray_users_v1', remaining_gray_users, timeout=30*24*60*60)
    
    print(f"åˆ†æ­¥å›æ»šå®Œæˆ: æˆåŠŸ {rollback_results['success_count']}, å¤±è´¥ {rollback_results['error_count']}")
    return rollback_results
```

## ğŸ“Š æˆåŠŸæ ‡å‡†ä¸éªŒæ”¶

### æŠ€æœ¯æŒ‡æ ‡
- [ ] **æ•°æ®å®Œæ•´æ€§**: è¿ç§»åæ•°æ®ä¸¢å¤±ç‡ < 0.01%
- [ ] **æ€§èƒ½æ ‡å‡†**: æƒé™è®¡ç®—å¹³å‡è€—æ—¶ < 100msï¼Œ95%è¯·æ±‚ < 500ms
- [ ] **ç³»ç»Ÿç¨³å®šæ€§**: è¿ç§»æœŸé—´ç³»ç»Ÿå¯ç”¨æ€§ > 99.9%
- [ ] **ç¼“å­˜æ•ˆç‡**: æƒé™ç¼“å­˜å‘½ä¸­ç‡ > 90%

### ä¸šåŠ¡æŒ‡æ ‡
- [ ] **ç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·æ“ä½œæˆåŠŸç‡ä¿æŒ > 99.5%
- [ ] **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] **æƒé™å‡†ç¡®æ€§**: ç”¨æˆ·æƒé™è®¡ç®—é”™è¯¯ç‡ < 0.1%
- [ ] **é…é¢ä¸€è‡´æ€§**: è®¸å¯è¯é…é¢åˆ†é…å‡†ç¡®ç‡ 100%

### éªŒæ”¶æ¸…å•
- [ ] æ‰€æœ‰ç”¨æˆ·æˆåŠŸè¿ç§»åˆ°æ–°ç³»ç»Ÿ
- [ ] åŸæœ‰ç”¨æˆ·ç±»å‹æ­£ç¡®æ˜ å°„ä¸ºæ ‡ç­¾
- [ ] ç§¯åˆ†è®¡ç®—å’Œç­‰çº§åˆ†é…å‡†ç¡®
- [ ] æƒé™ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] APIæ¥å£å®Œå…¨å…¼å®¹
- [ ] ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿæ­£å¸¸
- [ ] æ•°æ®å¤‡ä»½å’Œå›æ»šæ–¹æ¡ˆéªŒè¯é€šè¿‡
- [ ] ç”¨æˆ·åé¦ˆæ•´ä½“ç§¯æ

---

**æ€»ç»“**: è¿™ä¸ªè¿ç§»æ–¹æ¡ˆé€šè¿‡åˆ†é˜¶æ®µã€ç°åº¦å‘å¸ƒçš„æ–¹å¼ï¼Œç¡®ä¿äº†ä»åŒé‡ç­‰çº§ç³»ç»Ÿåˆ°ç»Ÿä¸€ç§¯åˆ†ç­‰çº§ç³»ç»Ÿçš„å¹³æ»‘è¿‡æ¸¡ã€‚å®Œæ•´çš„é£é™©æ§åˆ¶å’Œå›æ»šæœºåˆ¶ä¿éšœäº†è¿ç§»è¿‡ç¨‹çš„å®‰å…¨æ€§ï¼Œè¯¦ç»†çš„ç›‘æ§å’ŒéªŒè¯ç¡®ä¿äº†è¿ç§»è´¨é‡ã€‚
