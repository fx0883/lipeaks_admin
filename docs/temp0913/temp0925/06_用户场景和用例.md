# 用户场景和用例 - 详细文档

## 📋 目录

- [业务场景概述](#业务场景概述)
- [企业用户场景](#企业用户场景)
- [个人用户场景](#个人用户场景)
- [管理员场景](#管理员场景)
- [系统集成场景](#系统集成场景)
- [完整业务流程](#完整业务流程)

---

## 🏢 业务场景概述

### 租户内角色定义

```
┌─────────────────────────────────────────────────────────────┐
│                    多租户积分系统角色架构                   │
│                    (每个租户独立的权限体系)                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                   ┌─────────────┐                           │
│                   │ 租户管理员  │                           │
│                   │TenantAdmin  │                           │
│                   └─────────────┘                           │
│                           │                                 │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                租户内服务                           │    │
│  │   积分管理 │ VIP服务 │ 许可证分配 │ 数据统计       │    │
│  └─────────────────────────────────────────────────────┘    │
│                           │                                 │
│                           ▼                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │   企业用户  │    │   个人用户  │    │  开发者API │      │
│  │ Enterprise  │    │  Individual │    │  Developer  │      │
│  │   Member    │    │   Member    │    │Integration  │      │
│  └─────────────┘    └─────────────┘    └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

### 典型应用场景

| 场景类型 | 业务描述 | 主要用户 |
|----------|----------|----------|
| **软件许可管理** | 企业软件授权和管理 | 企业IT管理员、员工 |
| **会员积分系统** | 用户忠诚度计划 | 个人用户、会员 |
| **SaaS订阅服务** | 云服务订阅管理 | 企业客户、个人用户 |
| **教育培训平台** | 学习积分和认证 | 学员、培训机构 |
| **电商平台** | 购物积分和VIP | 买家、卖家、平台方 |

---

## 🏢 企业用户场景

### 场景1：软件开发公司的许可证管理

#### 背景描述
ACME软件开发公司，拥有200名员工，使用多种开发工具和软件许可证。需要统一管理和分配软件许可证，同时建立员工激励的积分体系。

#### 参与角色
- **IT管理员**（张经理）：负责许可证采购和分配
- **项目经理**（李主管）：负责团队成员权限申请
- **开发工程师**（王工程师）：实际使用软件工具
- **财务人员**（赵会计）：负责成本控制和报告

#### 业务流程图

```
采购需求 → 许可证购买 → 系统录入 → 权限分配 → 员工使用 → 使用监控 → 续期/回收
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
  需求评估   供应商谈判   批量导入   个人分配   激活使用   统计分析   成本优化
  预算审批   合同签署   权限设置   邮件通知   记录使用   生成报告   资源调整
```

#### 详细用例流程

**1. 新员工入职许可证分配**

```bash
# Step 1: IT管理员查看可用许可证
curl -X GET \
  "http://localhost:8000/api/v1/licenses/admin/licenses/?status=active&available_slots__gt=0" \
  -H "Authorization: Bearer IT_ADMIN_TOKEN"

# Step 2: 为新员工批量分配标准开发工具许可证
curl -X POST \
  "http://localhost:8000/api/v1/licenses/admin/assignments/batch_assign/" \
  -H "Authorization: Bearer IT_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "member_ids": [1001, 1002, 1003],
    "license_id": 500,
    "assignment_type": "direct",
    "assignment_reason": "新员工标准配置：开发工具套件",
    "priority": "normal",
    "expires_at": "2026-09-25T10:00:00Z",
    "assignment_metadata": {
      "department": "研发部",
      "onboarding_batch": "2025-Q4-01",
      "cost_center": "DEV-001"
    }
  }'

# Step 3: 新员工获得入职积分奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/1001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 500,
    "category": "onboarding",
    "subcategory": "welcome_bonus",
    "reason": "新员工入职欢迎积分",
    "source_type": "system"
  }'
```

**2. 项目团队VIP权限申请**

```bash
# Step 1: 项目经理查看团队成员当前权限
curl -X GET \
  "http://localhost:8000/api/v1/points/profiles/?search=project_alpha" \
  -H "Authorization: Bearer PROJECT_MANAGER_TOKEN"

# Step 2: 为核心团队成员授予项目VIP权限
curl -X POST \
  "http://localhost:8000/api/v1/points/vip-tags/grant_vip_tag/" \
  -H "Authorization: Bearer PROJECT_MANAGER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "member_id": 1001,
    "tag_id": 5,
    "duration_days": 90,
    "grant_method": "manual",
    "reason": "Alpha项目核心开发成员，需要高级功能访问权限",
    "payment_info": null
  }'

# Step 3: 记录项目积分奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/1001/earn_points/" \
  -H "Authorization: Bearer PROJECT_MANAGER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 200,
    "category": "project",
    "subcategory": "milestone_achievement",
    "reason": "Alpha项目第一阶段完成奖励",
    "source_type": "project",
    "source_id": 1001
  }'
```

**3. 月度成本分析和优化**

```bash
# Step 1: 获取许可证使用统计
curl -X GET \
  "http://localhost:8000/api/v1/licenses/admin/assignments/statistics/" \
  -H "Authorization: Bearer IT_ADMIN_TOKEN"

# Step 2: 分析即将过期的许可证
curl -X GET \
  "http://localhost:8000/api/v1/licenses/admin/assignments/expiring_soon/?days=30" \
  -H "Authorization: Bearer IT_ADMIN_TOKEN"

# Step 3: 回收未使用的许可证
curl -X POST \
  "http://localhost:8000/api/v1/licenses/admin/assignments/batch_revoke/" \
  -H "Authorization: Bearer IT_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "assignment_ids": [45, 46, 47],
    "reason": "连续30天未使用，暂时回收以优化成本"
  }'
```

---

### 场景2：培训机构的学员积分系统

#### 背景描述
智慧教育培训机构，提供在线编程课程。学员通过学习、考试、项目完成等获得积分，积分可以兑换课程、认证或VIP服务。

#### 业务模型

```
学员注册 → 课程学习 → 获得积分 → 积分消费 → 等级提升 → VIP升级 → 更多权益
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
  免费体验   视频观看   完成作业   兑换课程   解锁功能   优先支持   独家内容
  基础权限   练习编程   通过考试   购买VIP   获得认证   一对一辅导  高级项目
```

#### 详细用例流程

**1. 学员学习进度积分奖励**

```bash
# 学员完成视频学习
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/2001/earn_points/" \
  -H "Authorization: Bearer LEARNING_SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 50,
    "category": "learning",
    "subcategory": "video_completion",
    "reason": "完成《Python基础》第3章视频学习",
    "source_type": "course",
    "source_id": 301
  }'

# 学员通过编程练习
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/2001/earn_points/" \
  -H "Authorization: Bearer LEARNING_SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 100,
    "category": "learning",
    "subcategory": "exercise_completion",
    "reason": "完成《数据结构》编程练习：二叉树遍历",
    "source_type": "exercise",
    "source_id": 501
  }'

# 学员项目获得高分
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/2001/earn_points/" \
  -H "Authorization: Bearer LEARNING_SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 300,
    "category": "achievement",
    "subcategory": "project_excellence",
    "reason": "项目《个人博客系统》获得95分，优秀作品奖励",
    "source_type": "project",
    "source_id": 701
  }'
```

**2. 积分兑换高级课程**

```bash
# 学员查看积分余额和可兑换课程
curl -X GET \
  "http://localhost:8000/api/v1/points/profiles/2001/summary/" \
  -H "Authorization: Bearer STUDENT_TOKEN"

# 学员使用积分兑换高级课程
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/2001/spend_points/" \
  -H "Authorization: Bearer STUDENT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 800,
    "category": "course_exchange",
    "subcategory": "premium_course",
    "reason": "兑换《高级算法设计》课程",
    "source_type": "course",
    "source_id": 401
  }'
```

**3. 优秀学员VIP升级**

```bash
# 系统检测学员达到升级条件，自动授予VIP
curl -X POST \
  "http://localhost:8000/api/v1/points/vip-tags/grant_vip_tag/" \
  -H "Authorization: Bearer LEARNING_SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "member_id": 2001,
    "tag_id": 10,
    "duration_days": 30,
    "grant_method": "system",
    "reason": "连续学习30天且项目评分均分超过90分，自动获得学霸VIP"
  }'
```

---

## 👤 个人用户场景

### 场景3：自由职业者的软件订阅管理

#### 背景描述
张设计师是一名自由职业的UI/UX设计师，使用多种设计软件。通过积分系统获得折扣，管理个人软件订阅。

#### 用户画像
- **职业**：自由职业UI/UX设计师
- **需求**：成本控制、软件正版化、功能按需使用
- **预算**：月度软件成本控制在500元以内
- **使用习惯**：高频使用设计软件，偶尔需要高级功能

#### 业务流程

```
软件试用 → 积分累积 → 获得折扣 → 购买订阅 → 项目使用 → 继续积分 → 续费优惠
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
  免费体验   日常使用   等级提升   选择套餐   接收项目   分享推荐   长期用户
  基础功能   签到奖励   折扣权益   付费订阅   赚取收入   邀请奖励   忠诚回馈
```

#### 详细用例流程

**1. 每日使用积分奖励**

```bash
# 每日自动登录积分奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/3001/earn_points/" \
  -H "Authorization: Bearer USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 10,
    "category": "login",
    "subcategory": "daily_login",
    "reason": "每日登录奖励",
    "source_type": "system"
  }'

# 软件使用时长奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/3001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 25,
    "category": "usage",
    "subcategory": "daily_usage",
    "reason": "今日使用设计软件4小时，获得活跃用户奖励",
    "source_type": "usage_tracking"
  }'
```

**2. 推荐新用户获得奖励**

```bash
# 推荐新用户注册成功
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/3001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 200,
    "category": "referral",
    "subcategory": "new_user_referral",
    "reason": "推荐新用户李小美注册成功",
    "source_type": "referral",
    "source_id": 3002
  }'

# 被推荐用户首次付费，推荐人获得额外奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/3001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 500,
    "category": "referral",
    "subcategory": "referral_conversion",
    "reason": "推荐用户李小美首次购买专业版，推荐转化奖励",
    "source_type": "referral",
    "source_id": 3002
  }'
```

**3. 积分兑换软件订阅折扣**

```bash
# 查看当前积分和可用优惠
curl -X GET \
  "http://localhost:8000/api/v1/points/profiles/3001/" \
  -H "Authorization: Bearer USER_TOKEN"

# 使用积分兑换软件订阅折扣
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/3001/spend_points/" \
  -H "Authorization: Bearer USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 1000,
    "category": "discount",
    "subcategory": "software_subscription",
    "reason": "兑换设计软件专业版9折优惠券",
    "source_type": "promotion",
    "source_id": 501
  }'
```

---

### 场景4：学生用户的学习激励系统

#### 背景描述
李同学是计算机专业大三学生，通过在线编程平台学习。平台通过积分和等级系统激励学生持续学习。

#### 学习旅程

```
注册账号 → 新手指导 → 基础学习 → 进阶挑战 → 项目实战 → 求职准备 → 就业成功
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
  免费试用   完成任务   刷题练习   算法竞赛   开源贡献   简历优化   入职奖励
  新手礼包   积分奖励   排行榜     获得认证   技能提升   面试指导   毕业礼品
```

#### 详细用例流程

**1. 新手学习路径**

```bash
# 完成新手教程
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/4001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 100,
    "category": "tutorial",
    "subcategory": "beginner_tutorial",
    "reason": "完成新手编程教程：Hello World",
    "source_type": "tutorial"
  }'

# 连续学习奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/4001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 50,
    "category": "consistency",
    "subcategory": "streak_bonus",
    "reason": "连续学习7天奖励",
    "source_type": "streak_tracking"
  }'
```

**2. 竞赛和挑战**

```bash
# 参加算法竞赛获得排名奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/4001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 800,
    "category": "competition",
    "subcategory": "algorithm_contest",
    "reason": "月度算法竞赛获得第15名",
    "source_type": "contest",
    "source_id": 2025090001
  }'

# 解决困难题目奖励
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/4001/earn_points/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 300,
    "category": "achievement",
    "subcategory": "hard_problem_solved",
    "reason": "解决困难题目：动态规划优化背包问题",
    "source_type": "problem",
    "source_id": 1547
  }'
```

**3. 学生VIP特权兑换**

```bash
# 学生使用积分兑换学习VIP
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/4001/spend_points/" \
  -H "Authorization: Bearer USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 2000,
    "category": "vip_upgrade",
    "subcategory": "student_vip",
    "reason": "兑换学生VIP会员(30天)，解锁高级题库和视频课程",
    "source_type": "vip_exchange"
  }'

# 系统自动授予学生VIP标签
curl -X POST \
  "http://localhost:8000/api/v1/points/vip-tags/grant_vip_tag/" \
  -H "Authorization: Bearer SYSTEM_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "member_id": 4001,
    "tag_id": 15,
    "duration_days": 30,
    "grant_method": "points_exchange",
    "reason": "积分兑换学生VIP会员权限"
  }'
```

---

## 👨‍💼 管理员场景

### 场景5：租户管理员的运营分析

#### 背景描述
王管理员是ACME企业的租户管理员，负责本企业内积分系统的运营管理，需要监控本企业的系统健康度、用户活跃度、收入指标等关键业务数据。

#### 管理职责（租户内部）

```
数据监控 → 趋势分析 → 问题识别 → 策略调整 → 效果评估 → 持续优化
    ↓           ↓           ↓           ↓           ↓           ↓
租户仪表板  企业报告   内部告警   活动策划   业务测试   权限调整
企业KPI    月度分析   用户反馈   积分活动   转化优化   规则改进
```

#### 详细用例流程

**1. 每日运营数据监控（租户内部）**

```bash
# 获取本租户今日关键指标
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/kpi_dashboard/" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"

# 检查本租户积分系统健康状况
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/?period=day" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"

# 分析本租户用户活跃度趋势
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/points_trend/?days=7&granularity=day" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"
```

**2. 异常用户行为检测（租户内部）**

```bash
# 检查本租户内大额积分操作
curl -X GET \
  "http://localhost:8000/api/v1/points/points-records/?points__gte=5000&ordering=-created_at" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"

# 分析本租户VIP用户流失情况
curl -X GET \
  "http://localhost:8000/api/v1/points/vip-tags/?status=expired&ordering=-expires_at" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"

# 检查本租户许可证使用异常
curl -X GET \
  "http://localhost:8000/api/v1/licenses/admin/assignments/statistics/" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"
```

**3. 运营活动效果分析（租户内部）**

```bash
# 分析本租户推荐活动效果
curl -X GET \
  "http://localhost:8000/api/v1/points/points-records/?category=referral&created_at__gte=2025-09-01" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"

# 评估本租户VIP转化效果
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/vip_conversion/" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN"

# 生成本租户月度运营报告
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/export/?format=excel&period=month" \
  -H "Authorization: Bearer TENANT_ADMIN_TOKEN" \
  -o "tenant_monthly_report_2025_09.xlsx"
```

---

### 场景6：客服处理用户投诉

#### 背景描述
赵客服收到用户投诉：积分未正确发放、VIP权益缺失等问题，需要快速定位和解决。

#### 处理流程

```
接收投诉 → 问题定位 → 数据核查 → 补偿方案 → 执行补偿 → 用户确认 → 记录归档
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
  工单创建   查询记录   核实情况   确定补偿   API操作   客户回访   经验总结
  分配客服   技术协助   证据收集   审批流程   系统修复   满意度调查 知识库更新
```

#### 详细用例流程

**1. 用户投诉积分未到账**

```bash
# 客服查询用户积分记录
curl -X GET \
  "http://localhost:8000/api/v1/points/points-records/?member=5001&created_at__gte=2025-09-20" \
  -H "Authorization: Bearer SUPPORT_TOKEN"

# 查询用户当前状态
curl -X GET \
  "http://localhost:8000/api/v1/points/profiles/?member=5001" \
  -H "Authorization: Bearer SUPPORT_TOKEN"

# 核实原因后进行积分补偿
curl -X POST \
  "http://localhost:8000/api/v1/points/profiles/15/earn_points/" \
  -H "Authorization: Bearer SUPPORT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "points_amount": 500,
    "category": "manual",
    "subcategory": "customer_service_compensation",
    "reason": "客服补偿：用户反馈9月22日完成项目任务但积分未正确发放",
    "source_type": "manual"
  }'
```

**2. VIP权益缺失处理**

```bash
# 查询用户VIP状态
curl -X GET \
  "http://localhost:8000/api/v1/points/vip-tags/?member=5001&is_active=true" \
  -H "Authorization: Bearer SUPPORT_TOKEN"

# 重新授予VIP权限作为补偿
curl -X POST \
  "http://localhost:8000/api/v1/points/vip-tags/grant_vip_tag/" \
  -H "Authorization: Bearer SUPPORT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "member_id": 5001,
    "tag_id": 8,
    "duration_days": 15,
    "grant_method": "manual",
    "reason": "客服补偿：因系统故障导致VIP权益未正确激活，补偿15天VIP时长"
  }'
```

---

## 🔗 系统集成场景

### 场景7：第三方支付系统集成

#### 背景描述
电商平台集成积分系统，用户购物获得积分，积分可抵扣现金或购买VIP服务。

#### 集成架构

```
电商订单 → 支付完成 → 积分计算 → 积分发放 → 用户通知 → 积分使用 → 订单优惠
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
  下单支付   Webhook    返点比例   API调用    推送消息   下次购物   折扣抵扣
  第三方平台  回调通知   规则引擎   积分入账   短信/邮件  积分商城   自动计算
```

#### 集成示例代码

**1. 订单完成积分奖励**

```python
# 电商平台订单完成 Webhook 处理
import requests

def handle_order_completed(order_data):
    """处理订单完成事件"""
    
    # 计算积分奖励（订单金额的1%）
    order_amount = order_data['total_amount']
    points_reward = int(order_amount * 0.01)
    
    # 调用积分系统API
    response = requests.post(
        'http://localhost:8000/api/v1/points/profiles/{}/earn_points/'.format(
            order_data['user_id']
        ),
        headers={
            'Authorization': 'Bearer ECOMMERCE_SYSTEM_TOKEN',
            'Content-Type': 'application/json'
        },
        json={
            'points_amount': points_reward,
            'category': 'purchase',
            'subcategory': 'order_completion',
            'reason': f'订单{order_data["order_id"]}完成，获得购物积分奖励',
            'source_type': 'ecommerce',
            'source_id': order_data['order_id']
        }
    )
    
    return response.json()

# 用户积分支付处理
def process_points_payment(user_id, points_amount, order_id):
    """处理积分支付"""
    
    response = requests.post(
        f'http://localhost:8000/api/v1/points/profiles/{user_id}/spend_points/',
        headers={
            'Authorization': 'Bearer ECOMMERCE_SYSTEM_TOKEN',
            'Content-Type': 'application/json'
        },
        json={
            'points_amount': points_amount,
            'category': 'payment',
            'subcategory': 'order_discount',
            'reason': f'订单{order_id}使用{points_amount}积分抵扣',
            'source_type': 'ecommerce',
            'source_id': order_id
        }
    )
    
    return response.json()
```

**2. 会员等级同步**

```python
def sync_membership_level(user_id):
    """同步会员等级到电商平台"""
    
    # 获取用户积分档案
    response = requests.get(
        f'http://localhost:8000/api/v1/points/profiles/{user_id}/',
        headers={'Authorization': 'Bearer ECOMMERCE_SYSTEM_TOKEN'}
    )
    
    profile_data = response.json()
    current_level = profile_data['current_level_info']
    
    # 根据积分等级设置电商会员等级
    level_mapping = {
        '青铜会员': 'bronze',
        '白银会员': 'silver', 
        '黄金会员': 'gold',
        '钻石会员': 'diamond'
    }
    
    ecommerce_level = level_mapping.get(current_level['level_name'], 'bronze')
    
    # 同步到电商平台
    update_user_membership(user_id, ecommerce_level)
```

---

### 场景8：移动应用SDK集成

#### 背景描述
移动应用开发者集成积分SDK，实现应用内积分功能。

#### SDK集成示例

**1. iOS Swift集成**

```swift
import PointsSDK

class ViewController: UIViewController {
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        // 初始化SDK
        PointsSDK.initialize(
            apiEndpoint: "https://api.example.com/api/v1",
            apiKey: "your_api_key",
            tenantId: "your_tenant_id"
        )
    }
    
    // 用户完成任务获得积分
    func completeTask(taskId: String) {
        PointsSDK.earnPoints(
            amount: 100,
            category: "task_completion",
            reason: "完成每日任务：签到打卡",
            sourceId: taskId
        ) { result in
            switch result {
            case .success(let pointsData):
                print("获得积分: \(pointsData.pointsEarned)")
                self.showSuccessMessage("恭喜获得 \(pointsData.pointsEarned) 积分！")
            case .failure(let error):
                print("积分发放失败: \(error)")
            }
        }
    }
    
    // 查询用户积分余额
    func checkPointsBalance() {
        PointsSDK.getUserProfile { result in
            switch result {
            case .success(let profile):
                self.updateUI(totalPoints: profile.totalPoints, 
                            currentLevel: profile.currentLevel.levelName)
            case .failure(let error):
                print("查询积分失败: \(error)")
            }
        }
    }
}
```

**2. Android Kotlin集成**

```kotlin
class MainActivity : AppCompatActivity() {
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        // 初始化SDK
        PointsSDK.initialize(
            context = this,
            apiEndpoint = "https://api.example.com/api/v1",
            apiKey = "your_api_key",
            tenantId = "your_tenant_id"
        )
    }
    
    // 用户分享获得积分
    fun shareContent(contentId: String) {
        PointsSDK.earnPoints(
            amount = 50,
            category = "social_sharing",
            reason = "分享文章到社交媒体",
            sourceId = contentId
        ) { result ->
            when (result) {
                is PointsResult.Success -> {
                    showToast("分享成功，获得 ${result.data.pointsEarned} 积分！")
                    refreshPointsDisplay()
                }
                is PointsResult.Error -> {
                    Log.e("Points", "积分发放失败: ${result.error}")
                }
            }
        }
    }
    
    // 积分商城购买
    fun purchaseWithPoints(itemId: String, pointsCost: Int) {
        PointsSDK.spendPoints(
            amount = pointsCost,
            category = "store_purchase",
            reason = "积分商城购买道具",
            sourceId = itemId
        ) { result ->
            when (result) {
                is PointsResult.Success -> {
                    deliverPurchasedItem(itemId)
                    showToast("购买成功！")
                }
                is PointsResult.Error -> {
                    showToast("积分不足或购买失败")
                }
            }
        }
    }
}
```

---

## 🔄 完整业务流程

### 端到端用户生命周期

```
新用户注册 → 完成引导 → 日常使用 → 积分累积 → 等级提升 → VIP升级 → 深度使用 → 续费/推荐
     ↓          ↓          ↓          ↓          ↓          ↓          ↓          ↓
   注册奖励   新手任务   功能体验   等级权益   高级功能   专属服务   忠诚用户   价值传播
   基础权限   学习成本   使用习惯   权益感知   付费转化   满意度高   长期价值   口碑传播
```

### 关键节点和转化漏斗

1. **注册转化**：访客 → 注册用户（转化率：15%）
2. **激活转化**：注册用户 → 活跃用户（转化率：60%）
3. **付费转化**：活跃用户 → 付费用户（转化率：8%）
4. **忠诚转化**：付费用户 → 忠诚用户（转化率：45%）
5. **推荐转化**：忠诚用户 → 推荐用户（转化率：25%）

### 数据驱动的优化策略

1. **新手引导优化**：降低学习成本，提高激活率
2. **等级设计优化**：合理的升级门槛，保持用户动力
3. **积分经济平衡**：控制通胀，维护积分价值
4. **VIP权益优化**：差异化服务，提升付费意愿
5. **用户生命周期管理**：个性化运营，延长用户价值

---

下一步查看: [07_错误处理和最佳实践.md](./07_错误处理和最佳实践.md) 了解错误处理指南和系统最佳实践。
