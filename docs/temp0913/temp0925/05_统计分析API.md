# ç»Ÿè®¡åˆ†æAPI - è¯¦ç»†æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [ç»Ÿè®¡åˆ†ææ¦‚è¿°](#ç»Ÿè®¡åˆ†ææ¦‚è¿°)
- [ç§¯åˆ†ç»Ÿè®¡API](#ç§¯åˆ†ç»Ÿè®¡api)
- [è¶‹åŠ¿åˆ†æAPI](#è¶‹åŠ¿åˆ†æapi)
- [ç”¨æˆ·è¡Œä¸ºåˆ†æ](#ç”¨æˆ·è¡Œä¸ºåˆ†æ)
- [ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§](#ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§)
- [æ•°æ®å¯è§†åŒ–](#æ•°æ®å¯è§†åŒ–)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)

---

## ğŸ“Š ç»Ÿè®¡åˆ†ææ¦‚è¿°

### ç»Ÿè®¡åˆ†æç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åˆ†æå¤„ç†æµç¨‹                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®æ”¶é›† â†’ æ•°æ®æ¸…æ´— â†’ æ•°æ®åˆ†æ â†’ æŒ‡æ ‡è®¡ç®— â†’ å¯è§†åŒ– â†’ æŠ¥å‘Šç”Ÿæˆ â”‚
â”‚     â†“         â†“         â†“         â†“         â†“         â†“     â”‚
â”‚  å®æ—¶æ•°æ®   å»é‡è¿‡æ»¤   ç®—æ³•å¤„ç†   KPIè®¡ç®—   å›¾è¡¨ç”Ÿæˆ  å®šæœŸæŠ¥å‘Š â”‚
â”‚  æ‰¹é‡å¯¼å…¥   æ ¼å¼åŒ–     ç»Ÿè®¡åˆ†æ   è¶‹åŠ¿è®¡ç®—   ä»ªè¡¨æ¿    ä¸šåŠ¡æ´å¯Ÿâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†æç»´åº¦

| ç»´åº¦ | æè¿° | æŒ‡æ ‡ç¤ºä¾‹ |
|------|------|----------|
| **æ—¶é—´ç»´åº¦** | æŒ‰æ—¶é—´å‘¨æœŸåˆ†æ | æ—¥æ´»ã€æœˆæ´»ã€å¢é•¿ç‡ |
| **ç”¨æˆ·ç»´åº¦** | æŒ‰ç”¨æˆ·ç¾¤ä½“åˆ†æ | ç”¨æˆ·ç­‰çº§åˆ†å¸ƒã€æ´»è·ƒåº¦ |
| **ä¸šåŠ¡ç»´åº¦** | æŒ‰ä¸šåŠ¡ç±»å‹åˆ†æ | ç§¯åˆ†æµè½¬ã€VIPè½¬åŒ– |
| **åœ°åŸŸç»´åº¦** | æŒ‰åœ°ç†ä½ç½®åˆ†æ | åŒºåŸŸåˆ†å¸ƒã€æ—¶åŒºåˆ†æ |
| **è®¾å¤‡ç»´åº¦** | æŒ‰è®¾å¤‡ç±»å‹åˆ†æ | ç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯ä½¿ç”¨ |

### æ•°æ®åˆ·æ–°ç­–ç•¥

| æ•°æ®ç±»å‹ | åˆ·æ–°é¢‘ç‡ | è¯´æ˜ |
|----------|----------|------|
| **å®æ—¶æ•°æ®** | æ¯åˆ†é’Ÿ | å½“å‰åœ¨çº¿ç”¨æˆ·ã€å®æ—¶ç§¯åˆ† |
| **å°æ—¶æ•°æ®** | æ¯å°æ—¶ | ä½¿ç”¨é‡ç»Ÿè®¡ã€æ´»è·ƒåº¦ |
| **æ—¥æ•°æ®** | æ¯æ—¥å‡Œæ™¨ | æ—¥æ´»ã€ç§¯åˆ†æµæ°´ |
| **å‘¨/æœˆæ•°æ®** | å®šæœŸè®¡ç®— | è¶‹åŠ¿åˆ†æã€åŒæ¯”ç¯æ¯” |

---

## ğŸ“ˆ ç§¯åˆ†ç»Ÿè®¡API

### è·å–ç§¯åˆ†ç»Ÿè®¡æ¦‚è§ˆ

**ç«¯ç‚¹**: `GET /api/v1/points/statistics/`

**æè¿°**: è·å–å½“å‰ç§Ÿæˆ·çš„ç§¯åˆ†ç³»ç»Ÿç»Ÿè®¡æ¦‚è§ˆ

#### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `period` | string | å¦ | `month` | ç»Ÿè®¡å‘¨æœŸï¼ˆday/week/month/yearï¼‰ |
| `start_date` | date | å¦ | - | å¼€å§‹æ—¥æœŸ |
| `end_date` | date | å¦ | - | ç»“æŸæ—¥æœŸ |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/?period=month" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json"
```

#### å“åº”ç¤ºä¾‹

```json
{
  "period": "month",
  "period_start": "2025-09-01",
  "period_end": "2025-09-30",
  "last_updated": "2025-09-25T16:00:00Z",
  
  "user_statistics": {
    "total_users": 1250,
    "active_users": 980,
    "new_users_this_period": 85,
    "points_enabled_users": 950,
    "activation_rate": 0.76
  },
  
  "points_overview": {
    "total_points_distributed": 1500000,
    "total_points_spent": 450000,
    "net_points_in_circulation": 1050000,
    "average_points_per_user": 1200,
    "median_points_per_user": 800
  },
  
  "level_distribution": {
    "é’é“œä¼šå‘˜": {
      "count": 500,
      "percentage": 40.0,
      "avg_points": 350
    },
    "ç™½é“¶ä¼šå‘˜": {
      "count": 400,
      "percentage": 32.0,
      "avg_points": 2500
    },
    "é»„é‡‘ä¼šå‘˜": {
      "count": 250,
      "percentage": 20.0,
      "avg_points": 6500
    },
    "é’»çŸ³ä¼šå‘˜": {
      "count": 80,
      "percentage": 6.4,
      "avg_points": 15000
    },
    "è‡³å°Šä¼šå‘˜": {
      "count": 20,
      "percentage": 1.6,
      "avg_points": 35000
    }
  },
  
  "vip_distribution": {
    "vip": {
      "total_active": 180,
      "percentage": 14.4,
      "revenue_contribution": 0.65
    },
    "privilege": {
      "total_active": 50,
      "percentage": 4.0,
      "revenue_contribution": 0.15
    },
    "temporary": {
      "total_active": 120,
      "percentage": 9.6,
      "revenue_contribution": 0.05
    }
  },
  
  "activity_metrics": {
    "daily_active_users": 650,
    "weekly_active_users": 850,
    "monthly_active_users": 980,
    "user_retention": {
      "day_1": 0.85,
      "day_7": 0.65,
      "day_30": 0.45
    },
    "session_statistics": {
      "avg_session_duration": "00:25:30",
      "avg_sessions_per_user": 8.5,
      "peak_hours": ["14:00", "20:00", "21:00"]
    }
  },
  
  "business_metrics": {
    "points_conversion_rate": 0.25,
    "vip_conversion_rate": 0.12,
    "average_revenue_per_user": 45.50,
    "customer_lifetime_value": 285.60
  },
  
  "growth_indicators": {
    "user_growth_rate": 0.07,
    "points_growth_rate": 0.15,
    "revenue_growth_rate": 0.22,
    "engagement_score": 8.5
  }
}
```

---

## ğŸ“Š è¶‹åŠ¿åˆ†æAPI

### è·å–ç§¯åˆ†è¶‹åŠ¿æ•°æ®

**ç«¯ç‚¹**: `GET /api/v1/points/statistics/points_trend/`

**æè¿°**: è·å–ç§¯åˆ†æµè½¬çš„è¶‹åŠ¿åˆ†ææ•°æ®

#### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `days` | integer | å¦ | 30 | åˆ†æå¤©æ•°ï¼ˆ7-365ï¼‰ |
| `granularity` | string | å¦ | `day` | æ—¶é—´ç²’åº¦ï¼ˆhour/day/weekï¼‰ |
| `metrics` | array | å¦ | all | æŒ‡å®šæŒ‡æ ‡ç±»å‹ |

#### æŒ‡æ ‡ç±»å‹

| æŒ‡æ ‡ | ä»£ç  | è¯´æ˜ |
|------|------|------|
| ç§¯åˆ†è·å¾— | `earned` | ç”¨æˆ·è·å¾—çš„ç§¯åˆ† |
| ç§¯åˆ†æ¶ˆè´¹ | `spent` | ç”¨æˆ·æ¶ˆè´¹çš„ç§¯åˆ† |
| ç§¯åˆ†è¿‡æœŸ | `expired` | è¿‡æœŸå¤±æ•ˆçš„ç§¯åˆ† |
| å‡€å˜åŒ– | `net_change` | ç§¯åˆ†å‡€å¢å‡ |
| æ´»è·ƒç”¨æˆ· | `active_users` | ç§¯åˆ†æ´»è·ƒç”¨æˆ·æ•° |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/points_trend/?days=30&granularity=day" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### å“åº”ç¤ºä¾‹

```json
{
  "period_days": 30,
  "granularity": "day",
  "start_date": "2025-08-26",
  "end_date": "2025-09-25",
  "last_updated": "2025-09-25T16:00:00Z",
  
  "summary_metrics": {
    "total_earned": 450000,
    "total_spent": 135000,
    "total_expired": 5000,
    "net_change": 310000,
    "avg_daily_earned": 15000,
    "avg_daily_spent": 4500,
    "peak_day": "2025-09-15",
    "peak_value": 25000
  },
  
  "daily_stats": [
    {
      "date": "2025-09-25",
      "earned": 18500,
      "spent": 5200,
      "expired": 150,
      "net": 13150,
      "active_users": 650,
      "transactions": 1250,
      "categories": {
        "login": 3500,
        "license": 8500,
        "referral": 2500,
        "vip_upgrade": -5200,
        "manual": 4000
      }
    },
    {
      "date": "2025-09-24",
      "earned": 16200,
      "spent": 4800,
      "expired": 200,
      "net": 11200,
      "active_users": 620,
      "transactions": 1180,
      "categories": {
        "login": 3200,
        "license": 7500,
        "referral": 2000,
        "vip_upgrade": -4800,
        "manual": 3500
      }
    }
  ],
  
  "trend_analysis": {
    "growth_rate": 0.08,
    "volatility": 0.15,
    "seasonality": {
      "weekdays_avg": 14500,
      "weekends_avg": 12000,
      "peak_hours": ["10:00", "14:00", "20:00"]
    },
    "predictions": {
      "next_7_days_forecast": 105000,
      "confidence_interval": [95000, 115000],
      "trend_direction": "increasing"
    }
  },
  
  "category_breakdown": {
    "login": {
      "total": 98000,
      "percentage": 21.8,
      "trend": "stable",
      "daily_avg": 3267
    },
    "license": {
      "total": 225000,
      "percentage": 50.0,
      "trend": "increasing",
      "daily_avg": 7500
    },
    "referral": {
      "total": 67500,
      "percentage": 15.0,
      "trend": "fluctuating",
      "daily_avg": 2250
    },
    "manual": {
      "total": 59500,
      "percentage": 13.2,
      "trend": "decreasing",
      "daily_avg": 1983
    }
  }
}
```

---

## ğŸ‘¥ ç”¨æˆ·è¡Œä¸ºåˆ†æ

### ç”¨æˆ·ç­‰çº§æµè½¬åˆ†æ

**ç«¯ç‚¹**: `GET /api/v1/points/statistics/level_transitions/`

**æè¿°**: åˆ†æç”¨æˆ·ç­‰çº§å˜åŒ–å’Œæµè½¬æƒ…å†µ

#### å“åº”ç¤ºä¾‹

```json
{
  "analysis_period": {
    "start_date": "2025-08-01",
    "end_date": "2025-09-25",
    "total_days": 55
  },
  
  "level_transition_matrix": {
    "é’é“œä¼šå‘˜": {
      "retained": 450,
      "upgraded_to": {
        "ç™½é“¶ä¼šå‘˜": 45,
        "é»„é‡‘ä¼šå‘˜": 3
      },
      "downgraded_to": {},
      "retention_rate": 0.90
    },
    "ç™½é“¶ä¼šå‘˜": {
      "retained": 350,
      "upgraded_to": {
        "é»„é‡‘ä¼šå‘˜": 35,
        "é’»çŸ³ä¼šå‘˜": 2
      },
      "downgraded_to": {
        "é’é“œä¼šå‘˜": 13
      },
      "retention_rate": 0.875
    },
    "é»„é‡‘ä¼šå‘˜": {
      "retained": 220,
      "upgraded_to": {
        "é’»çŸ³ä¼šå‘˜": 18,
        "è‡³å°Šä¼šå‘˜": 1
      },
      "downgraded_to": {
        "ç™½é“¶ä¼šå‘˜": 11
      },
      "retention_rate": 0.88
    }
  },
  
  "upgrade_paths": [
    {
      "path": "é’é“œä¼šå‘˜ â†’ ç™½é“¶ä¼šå‘˜",
      "count": 45,
      "avg_time_days": 28,
      "avg_points_needed": 1000,
      "success_rate": 0.09
    },
    {
      "path": "ç™½é“¶ä¼šå‘˜ â†’ é»„é‡‘ä¼šå‘˜",
      "count": 35,
      "avg_time_days": 45,
      "avg_points_needed": 3000,
      "success_rate": 0.088
    }
  ],
  
  "user_journey_analysis": {
    "new_user_progression": {
      "stay_at_bronze_30_days": 0.75,
      "reach_silver_30_days": 0.20,
      "reach_gold_30_days": 0.04,
      "reach_diamond_30_days": 0.01
    },
    "churn_analysis": {
      "bronze_churn_rate": 0.25,
      "silver_churn_rate": 0.15,
      "gold_churn_rate": 0.08,
      "diamond_churn_rate": 0.05
    },
    "engagement_by_level": {
      "é’é“œä¼šå‘˜": {
        "daily_login_rate": 0.35,
        "feature_usage_rate": 0.45,
        "support_ticket_rate": 0.08
      },
      "é»„é‡‘ä¼šå‘˜": {
        "daily_login_rate": 0.75,
        "feature_usage_rate": 0.85,
        "support_ticket_rate": 0.15
      }
    }
  }
}
```

### VIPè½¬åŒ–åˆ†æ

**ç«¯ç‚¹**: `GET /api/v1/points/statistics/vip_conversion/`

**æè¿°**: åˆ†æVIPè½¬åŒ–æ¼æ–—å’Œç”¨æˆ·è¡Œä¸º

#### å“åº”ç¤ºä¾‹

```json
{
  "conversion_funnel": {
    "total_users": 1250,
    "viewed_vip_page": {
      "count": 625,
      "rate": 0.50
    },
    "started_purchase": {
      "count": 250,
      "rate": 0.40
    },
    "completed_payment": {
      "count": 180,
      "rate": 0.72
    },
    "activated_vip": {
      "count": 175,
      "rate": 0.97
    }
  },
  
  "vip_tier_preference": {
    "VIP_BRONZE": {
      "purchases": 50,
      "percentage": 28.6,
      "avg_duration_days": 30,
      "renewal_rate": 0.65
    },
    "VIP_SILVER": {
      "purchases": 80,
      "percentage": 45.7,
      "avg_duration_days": 60,
      "renewal_rate": 0.75
    },
    "VIP_GOLD": {
      "purchases": 45,
      "percentage": 25.7,
      "avg_duration_days": 90,
      "renewal_rate": 0.85
    }
  },
  
  "conversion_drivers": {
    "top_motivations": [
      {
        "reason": "ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ",
        "impact_score": 8.5,
        "user_mentions": 125
      },
      {
        "reason": "ç‹¬å®¶åŠŸèƒ½è®¿é—®",
        "impact_score": 8.2,
        "user_mentions": 98
      },
      {
        "reason": "æŠ˜æ‰£ä¼˜æƒ ",
        "impact_score": 7.8,
        "user_mentions": 156
      }
    ],
    "conversion_triggers": [
      {
        "trigger": "ç§¯åˆ†è¾¾åˆ°é˜ˆå€¼",
        "conversion_rate": 0.35,
        "optimal_timing": "ç§¯åˆ†è¾¾åˆ°2000+"
      },
      {
        "trigger": "è®¸å¯è¯å³å°†åˆ°æœŸ",
        "conversion_rate": 0.28,
        "optimal_timing": "åˆ°æœŸå‰7å¤©"
      }
    ]
  },
  
  "churn_analysis": {
    "vip_churn_rate": 0.15,
    "churn_reasons": [
      {
        "reason": "ä»·æ ¼å› ç´ ",
        "percentage": 35.0
      },
      {
        "reason": "åŠŸèƒ½ä½¿ç”¨é¢‘ç‡ä½",
        "percentage": 28.0
      },
      {
        "reason": "æ›¿ä»£æ–¹æ¡ˆ",
        "percentage": 20.0
      },
      {
        "reason": "å…¶ä»–",
        "percentage": 17.0
      }
    ],
    "retention_strategies": [
      {
        "strategy": "ä¸ªæ€§åŒ–æŠ˜æ‰£",
        "effectiveness": 0.45
      },
      {
        "strategy": "åŠŸèƒ½ä½¿ç”¨æŒ‡å¯¼",
        "effectiveness": 0.38
      }
    ]
  }
}
```

---

## ğŸ¯ ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

### å…³é”®ä¸šåŠ¡æŒ‡æ ‡

**ç«¯ç‚¹**: `GET /api/v1/points/statistics/kpi_dashboard/`

**æè¿°**: è·å–å…³é”®ä¸šåŠ¡æŒ‡æ ‡ä»ªè¡¨æ¿æ•°æ®

#### å“åº”ç¤ºä¾‹

```json
{
  "dashboard_metrics": {
    "revenue_metrics": {
      "total_revenue": 125000.00,
      "monthly_recurring_revenue": 45000.00,
      "average_revenue_per_user": 100.00,
      "revenue_growth_rate": 0.18,
      "revenue_per_vip_user": 250.00
    },
    
    "user_metrics": {
      "total_active_users": 980,
      "new_user_acquisition": 85,
      "user_acquisition_cost": 25.50,
      "customer_lifetime_value": 285.60,
      "net_promoter_score": 7.8
    },
    
    "engagement_metrics": {
      "daily_active_users": 650,
      "session_duration_avg": "00:25:30",
      "feature_adoption_rate": 0.68,
      "user_engagement_score": 8.2,
      "content_interaction_rate": 0.45
    },
    
    "operational_metrics": {
      "system_uptime": 0.998,
      "api_response_time_avg": 185,
      "error_rate": 0.002,
      "support_ticket_resolution_time": "4.5 hours",
      "customer_satisfaction_score": 8.7
    }
  },
  
  "performance_alerts": [
    {
      "metric": "api_response_time",
      "current_value": 250,
      "threshold": 200,
      "severity": "warning",
      "trend": "increasing"
    }
  ],
  
  "goal_tracking": {
    "monthly_revenue_goal": {
      "target": 50000.00,
      "current": 45000.00,
      "progress": 0.90,
      "days_remaining": 6
    },
    "user_acquisition_goal": {
      "target": 100,
      "current": 85,
      "progress": 0.85,
      "days_remaining": 6
    }
  }
}
```

### è®¸å¯è¯ä½¿ç”¨åˆ†æ

**ç«¯ç‚¹**: `GET /api/v1/licenses/admin/assignments/analytics/`

**æè¿°**: åˆ†æè®¸å¯è¯ä½¿ç”¨æƒ…å†µå’Œæ•ˆç‡

#### å“åº”ç¤ºä¾‹

```json
{
  "license_efficiency": {
    "total_licenses": 200,
    "assigned_licenses": 150,
    "active_licenses": 120,
    "utilization_rate": 0.60,
    "efficiency_score": 8.0
  },
  
  "usage_patterns": {
    "peak_usage_hours": {
      "weekday": ["09:00", "14:00", "16:00"],
      "weekend": ["10:00", "20:00"]
    },
    "seasonal_trends": {
      "q1_usage": 0.85,
      "q2_usage": 0.92,
      "q3_usage": 0.88,
      "q4_usage": 0.95
    },
    "geographic_distribution": {
      "asia_pacific": 0.45,
      "north_america": 0.35,
      "europe": 0.15,
      "others": 0.05
    }
  },
  
  "cost_optimization": {
    "license_cost_per_user": 150.00,
    "roi_analysis": {
      "productivity_gain": 0.25,
      "cost_savings": 25000.00,
      "payback_period_months": 8.5
    },
    "optimization_recommendations": [
      {
        "action": "å›æ”¶æœªä½¿ç”¨è®¸å¯è¯",
        "potential_savings": 4500.00,
        "impact": "ä½é£é™©"
      },
      {
        "action": "å‡çº§é«˜é¢‘ç”¨æˆ·è®¸å¯è¯",
        "potential_revenue": 8000.00,
        "impact": "ä¸­ç­‰æ”¶ç›Š"
      }
    ]
  }
}
```

---

## ğŸ“ˆ æ•°æ®å¯è§†åŒ–

### å›¾è¡¨æ•°æ®æ¥å£

**ç«¯ç‚¹**: `GET /api/v1/points/statistics/chart_data/`

**æè¿°**: è·å–ç”¨äºå‰ç«¯å›¾è¡¨å±•ç¤ºçš„æ ¼å¼åŒ–æ•°æ®

#### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `chart_type` | string | æ˜¯ | å›¾è¡¨ç±»å‹ |
| `period` | string | å¦ | æ—¶é—´å‘¨æœŸ |
| `dimensions` | array | å¦ | æ•°æ®ç»´åº¦ |

#### å›¾è¡¨ç±»å‹

| ç±»å‹ | ä»£ç  | è¯´æ˜ |
|------|------|------|
| çº¿å›¾ | `line` | è¶‹åŠ¿åˆ†æ |
| æŸ±çŠ¶å›¾ | `bar` | å¯¹æ¯”åˆ†æ |
| é¥¼å›¾ | `pie` | å æ¯”åˆ†æ |
| æ•£ç‚¹å›¾ | `scatter` | ç›¸å…³æ€§åˆ†æ |
| çƒ­åŠ›å›¾ | `heatmap` | å¯†åº¦åˆ†æ |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/chart_data/?chart_type=line&period=month" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### å“åº”ç¤ºä¾‹ï¼ˆçº¿å›¾æ•°æ®ï¼‰

```json
{
  "chart_type": "line",
  "title": "ç§¯åˆ†è¶‹åŠ¿åˆ†æ",
  "subtitle": "æœ€è¿‘30å¤©ç§¯åˆ†è·å¾—å’Œæ¶ˆè´¹è¶‹åŠ¿",
  "xAxis": {
    "type": "datetime",
    "categories": [
      "2025-08-26", "2025-08-27", "2025-08-28"
    ]
  },
  "yAxis": {
    "title": "ç§¯åˆ†æ•°é‡",
    "unit": "åˆ†"
  },
  "series": [
    {
      "name": "ç§¯åˆ†è·å¾—",
      "type": "line",
      "color": "#4CAF50",
      "data": [
        {"x": "2025-08-26", "y": 15000},
        {"x": "2025-08-27", "y": 16500},
        {"x": "2025-08-28", "y": 14800}
      ]
    },
    {
      "name": "ç§¯åˆ†æ¶ˆè´¹",
      "type": "line",
      "color": "#F44336",
      "data": [
        {"x": "2025-08-26", "y": 4500},
        {"x": "2025-08-27", "y": 5200},
        {"x": "2025-08-28", "y": 4800}
      ]
    }
  ],
  "annotations": [
    {
      "x": "2025-09-15",
      "y": 25000,
      "text": "æ´»åŠ¨æ¨å¹¿é«˜å³°",
      "type": "point"
    }
  ]
}
```

#### å“åº”ç¤ºä¾‹ï¼ˆé¥¼å›¾æ•°æ®ï¼‰

```json
{
  "chart_type": "pie",
  "title": "ç”¨æˆ·ç­‰çº§åˆ†å¸ƒ",
  "subtitle": "å½“å‰ç”¨æˆ·ç­‰çº§æ„æˆæ¯”ä¾‹",
  "series": [
    {
      "name": "ç”¨æˆ·ç­‰çº§",
      "data": [
        {
          "name": "é’é“œä¼šå‘˜",
          "y": 40.0,
          "color": "#CD7F32",
          "count": 500
        },
        {
          "name": "ç™½é“¶ä¼šå‘˜", 
          "y": 32.0,
          "color": "#C0C0C0",
          "count": 400
        },
        {
          "name": "é»„é‡‘ä¼šå‘˜",
          "y": 20.0,
          "color": "#FFD700", 
          "count": 250
        },
        {
          "name": "é’»çŸ³ä¼šå‘˜",
          "y": 6.4,
          "color": "#B9F2FF",
          "count": 80
        },
        {
          "name": "è‡³å°Šä¼šå‘˜",
          "y": 1.6,
          "color": "#E6E6FA",
          "count": 20
        }
      ]
    }
  ],
  "legend": {
    "enabled": true,
    "position": "right"
  }
}
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´çš„æ•°æ®åˆ†ææµç¨‹

#### 1. è·å–æ¦‚è§ˆæ•°æ®

```bash
# è·å–å½“æœˆç§¯åˆ†ç³»ç»Ÿæ¦‚è§ˆ
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/?period=month" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 2. åˆ†æç§¯åˆ†è¶‹åŠ¿

```bash
# è·å–æœ€è¿‘30å¤©çš„ç§¯åˆ†è¶‹åŠ¿
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/points_trend/?days=30&granularity=day" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 3. ç”¨æˆ·è¡Œä¸ºåˆ†æ

```bash
# åˆ†æç”¨æˆ·ç­‰çº§æµè½¬æƒ…å†µ
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/level_transitions/" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# åˆ†æVIPè½¬åŒ–æƒ…å†µ
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/vip_conversion/" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 4. ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

```bash
# è·å–KPIä»ªè¡¨æ¿æ•°æ®
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/kpi_dashboard/" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# åˆ†æè®¸å¯è¯ä½¿ç”¨æ•ˆç‡
curl -X GET \
  "http://localhost:8000/api/v1/licenses/admin/assignments/analytics/" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 5. æ•°æ®å¯è§†åŒ–

```bash
# è·å–çº¿å›¾æ•°æ®
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/chart_data/?chart_type=line&period=month" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# è·å–é¥¼å›¾æ•°æ®
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/chart_data/?chart_type=pie&dimensions=user_level" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### å‰ç«¯é›†æˆç¤ºä¾‹

#### Reactç»„ä»¶ç¤ºä¾‹

```javascript
// ç§¯åˆ†è¶‹åŠ¿å›¾è¡¨ç»„ä»¶
import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend } from 'recharts';

const PointsTrendChart = () => {
  const [chartData, setChartData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchTrendData();
  }, []);

  const fetchTrendData = async () => {
    try {
      const response = await fetch('/api/v1/points/statistics/points_trend/?days=30', {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`,
          'Content-Type': 'application/json'
        }
      });
      const data = await response.json();
      setChartData(data.daily_stats);
    } catch (error) {
      console.error('è·å–è¶‹åŠ¿æ•°æ®å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div>åŠ è½½ä¸­...</div>;

  return (
    <div className="chart-container">
      <h3>ç§¯åˆ†è¶‹åŠ¿åˆ†æ</h3>
      <LineChart width={800} height={400} data={chartData}>
        <CartesianGrid strokeDasharray="3 3" />
        <XAxis dataKey="date" />
        <YAxis />
        <Tooltip />
        <Legend />
        <Line type="monotone" dataKey="earned" stroke="#4CAF50" name="è·å¾—ç§¯åˆ†" />
        <Line type="monotone" dataKey="spent" stroke="#F44336" name="æ¶ˆè´¹ç§¯åˆ†" />
        <Line type="monotone" dataKey="net" stroke="#2196F3" name="å‡€å˜åŒ–" />
      </LineChart>
    </div>
  );
};

export default PointsTrendChart;
```

#### Vueç»„ä»¶ç¤ºä¾‹

```vue
<template>
  <div class="statistics-dashboard">
    <div class="kpi-cards">
      <div class="kpi-card" v-for="kpi in kpiData" :key="kpi.name">
        <h4>{{ kpi.name }}</h4>
        <div class="kpi-value">{{ kpi.value }}</div>
        <div class="kpi-change" :class="kpi.trend">
          {{ kpi.change }}
        </div>
      </div>
    </div>
    
    <div class="charts-grid">
      <div class="chart-item">
        <pie-chart :data="levelDistribution" title="ç”¨æˆ·ç­‰çº§åˆ†å¸ƒ" />
      </div>
      <div class="chart-item">
        <line-chart :data="pointsTrend" title="ç§¯åˆ†è¶‹åŠ¿" />
      </div>
    </div>
  </div>
</template>

<script>
import { ref, onMounted } from 'vue';
import PieChart from './components/PieChart.vue';
import LineChart from './components/LineChart.vue';

export default {
  name: 'StatisticsDashboard',
  components: {
    PieChart,
    LineChart
  },
  setup() {
    const kpiData = ref([]);
    const levelDistribution = ref([]);
    const pointsTrend = ref([]);

    const fetchDashboardData = async () => {
      try {
        // è·å–KPIæ•°æ®
        const kpiResponse = await fetch('/api/v1/points/statistics/kpi_dashboard/');
        const kpi = await kpiResponse.json();
        
        kpiData.value = [
          {
            name: 'æ€»æ”¶å…¥',
            value: `Â¥${kpi.dashboard_metrics.revenue_metrics.total_revenue}`,
            change: '+18%',
            trend: 'positive'
          },
          {
            name: 'æ´»è·ƒç”¨æˆ·',
            value: kpi.dashboard_metrics.user_metrics.total_active_users,
            change: '+7%',
            trend: 'positive'
          },
          {
            name: 'å‚ä¸åº¦è¯„åˆ†',
            value: kpi.dashboard_metrics.engagement_metrics.user_engagement_score,
            change: '+0.3',
            trend: 'positive'
          }
        ];

        // è·å–å›¾è¡¨æ•°æ®
        const chartResponse = await fetch('/api/v1/points/statistics/chart_data/?chart_type=pie');
        const chartData = await chartResponse.json();
        levelDistribution.value = chartData.series[0].data;

        const trendResponse = await fetch('/api/v1/points/statistics/points_trend/?days=7');
        const trendData = await trendResponse.json();
        pointsTrend.value = trendData.daily_stats;

      } catch (error) {
        console.error('è·å–ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:', error);
      }
    };

    onMounted(fetchDashboardData);

    return {
      kpiData,
      levelDistribution,
      pointsTrend
    };
  }
};
</script>
```

---

## ğŸ“Š æ•°æ®å¯¼å‡º

### å¯¼å‡ºç»Ÿè®¡æŠ¥å‘Š

**ç«¯ç‚¹**: `GET /api/v1/points/statistics/export/`

**æè¿°**: å¯¼å‡ºè¯¦ç»†çš„ç»Ÿè®¡åˆ†ææŠ¥å‘Š

#### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `format` | string | å¦ | å¯¼å‡ºæ ¼å¼ï¼ˆexcel/csv/pdfï¼‰ |
| `period` | string | å¦ | ç»Ÿè®¡å‘¨æœŸ |
| `sections` | array | å¦ | æŠ¥å‘Šç« èŠ‚ |

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET \
  "http://localhost:8000/api/v1/points/statistics/export/?format=excel&period=month" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -o "points_statistics_report.xlsx"
```

---

## âš ï¸ æ€§èƒ½ä¼˜åŒ–

### å¤§æ•°æ®é‡å¤„ç†

1. **æ•°æ®åˆ†é¡µ**: å¤§æ•°æ®é›†ä½¿ç”¨åˆ†é¡µé¿å…è¶…æ—¶
2. **ç¼“å­˜ç­–ç•¥**: çƒ­ç‚¹æ•°æ®ä½¿ç”¨Redisç¼“å­˜
3. **å¼‚æ­¥å¤„ç†**: å¤æ‚ç»Ÿè®¡ä½¿ç”¨åå°ä»»åŠ¡
4. **ç´¢å¼•ä¼˜åŒ–**: æŸ¥è¯¢å­—æ®µå»ºç«‹åˆé€‚ç´¢å¼•

### å®æ—¶æ•°æ®å¤„ç†

1. **å¢é‡æ›´æ–°**: åªå¤„ç†å˜åŒ–çš„æ•°æ®
2. **é¢„èšåˆ**: é¢„å…ˆè®¡ç®—å¸¸ç”¨æŒ‡æ ‡
3. **æ•°æ®å‹ç¼©**: å†å²æ•°æ®é€‚å½“å‹ç¼©å­˜å‚¨
4. **æ‰¹é‡å¤„ç†**: æ‰¹é‡å¤„ç†å‡å°‘æ•°æ®åº“è¿æ¥

---

ä¸‹ä¸€æ­¥æŸ¥çœ‹: [06_ç”¨æˆ·åœºæ™¯å’Œç”¨ä¾‹.md](./06_ç”¨æˆ·åœºæ™¯å’Œç”¨ä¾‹.md) äº†è§£è¯¦ç»†çš„ä¸šåŠ¡åœºæ™¯å’Œå®é™…ä½¿ç”¨æ¡ˆä¾‹ã€‚
