# 许可证管理系统 API 文档

## 概述

本文档描述了许可证管理系统的所有 API 接口，包括租户管理员 API、客户端激活 API 和会员 API。

### 服务器地址

```
http://localhost:8000
```

### API 基础路径

```
/api/v1/licenses/
```

## 认证方式

### JWT Token 认证

所有管理类 API 需要在请求头中包含 JWT Token：

```
Authorization: Bearer <token>
```

### Token 类型

| Token 类型 | 说明 | 适用 API |
|-----------|------|---------|
| 租户管理员 Token | 管理许可证、产品、方案等 | `/admin/*` |
| 会员 Token | 申请试用、查看自己的许可证 | `/member/*` |
| 无需认证 | 许可证激活、验证等客户端操作 | `/activate/`, `/verify/`, `/heartbeat/`, `/unbind/`, `/info/`, `/status/` |

### 示例 Token

**租户管理员 Token:**
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjozLCJ1c2VybmFtZSI6ImFkbWluX2NtcyIsImV4cCI6MTc2NDY2MTU1NCwibW9kZWxfdHlwZSI6InVzZXIiLCJpc19hZG1pbiI6dHJ1ZSwiaXNfc3VwZXJfYWRtaW4iOmZhbHNlLCJpc19zdGFmZiI6dHJ1ZX0.ZjP5hrGG9H4MJV-1oOhO3m_HaMO0NvwHN7cUKlLi5nY
```

**会员 Token:**
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMCwidXNlcm5hbWUiOiJ0ZXN0MDJAcXEuY29tIiwiZXhwIjoxNzY0NjYwOTUwLCJtb2RlbF90eXBlIjoibWVtYmVyIiwiaXNfYWRtaW4iOmZhbHNlLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsImlzX3N0YWZmIjpmYWxzZX0.VQmBQI5C-zWSgzyBrY5XaG0IXflUlve2xpH7uT4I2hk
```

## 通用响应格式

### 成功响应

```json
{
    "success": true,
    "code": 2000,
    "message": "操作成功",
    "data": {
        // 响应数据
    }
}
```

### 分页响应

```json
{
    "success": true,
    "code": 2000,
    "message": "操作成功",
    "data": {
        "pagination": {
            "count": 10,
            "next": "http://localhost:8000/api/v1/licenses/admin/products/?page=2",
            "previous": null,
            "page_size": 10,
            "current_page": 1,
            "total_pages": 1
        },
        "results": [
            // 数据列表
        ]
    }
}
```

### 错误响应

```json
{
    "success": false,
    "code": 4000,
    "message": "数据验证失败",
    "data": {
        "field_name": ["错误信息"]
    },
    "error_code": "VALIDATION_ERROR"
}
```

### 常见错误码

| 错误码 | 说明 |
|-------|------|
| 2000 | 操作成功 |
| 4000 | 请求参数错误/数据验证失败 |
| 4001 | 未授权（未登录） |
| 4003 | 禁止访问（无权限） |
| 4004 | 资源不存在 |
| 5000 | 服务器内部错误 |

## 通用查询参数

### 分页参数

| 参数 | 类型 | 说明 | 默认值 |
|-----|------|------|--------|
| page | integer | 页码 | 1 |
| page_size | integer | 每页数量 | 10 |

### 排序参数

| 参数 | 类型 | 说明 | 示例 |
|-----|------|------|------|
| ordering | string | 排序字段，前缀 `-` 表示降序 | `-created_at` |

### 搜索参数

| 参数 | 类型 | 说明 |
|-----|------|------|
| search | string | 全文搜索关键词 |

## 租户隔离

租户管理员用户的 `tenant_id` 会自动从 JWT Token 中获取，无需在请求中显式提供。系统会自动：

1. 过滤只显示当前租户的数据
2. 创建资源时自动设置 `tenant_id`
3. 验证资源所有权

## API 目录

### 许可证模块文档

| 文档 | 说明 |
|-----|------|
| [03-许可方案管理API](./03-许可方案管理API.md) | 许可证方案的 CRUD 操作 |
| [04-许可证管理API](./04-许可证管理API.md) | 许可证的 CRUD 和相关操作 |
| [05-分配管理API](./05-分配管理API.md) | 许可证分配管理 |
| [06-激活与机器绑定API](./06-激活与机器绑定API.md) | 激活记录和机器绑定管理 |
| [07-配额与审计API](./07-配额与审计API.md) | 配额管理和审计日志 |
| [08-报告与统计API](./08-报告与统计API.md) | 报告生成和统计数据 |
| [09-客户端激活API](./09-客户端激活API.md) | 客户端许可证激活操作 |
| [10-会员许可证API](./10-会员许可证API.md) | 会员用户许可证管理 |

### 关联模块文档

| 文档 | 说明 |
|-----|------|
| [应用管理API](../temp1123_6_application/02_应用管理API完整文档.md) | 应用（产品）的 CRUD 操作，许可证关联的应用实体 |

> **说明**: 应用（Application）即产品（Product），是许可证系统的基础实体。应用管理的完整 API 文档请参考 `temp1123_6_application` 目录。
