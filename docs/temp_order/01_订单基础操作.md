# 订单基础操作API

本文档介绍了订单的基础操作API，包括创建、获取列表、获取详情、更新和删除订单。

## 1. 获取订单列表

获取系统中的所有订单，支持分页、排序和筛选。

### 请求

```
GET /api/v1/orders/
```

### 查询参数

| 参数名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| payment_status | string | 否 | 按支付状态筛选订单 |
| service_type | string | 否 | 按服务类型筛选订单 |
| language | string | 否 | 按语种筛选订单 |
| customer_id | integer | 否 | 按客户ID筛选订单 |
| customer_type | string | 否 | 按客户类型筛选订单 |
| service_time | string | 否 | 按服务时间筛选订单 |
| search | string | 否 | 搜索订单编号、客户名称等信息 |
| page | integer | 否 | 页码，默认为1 |
| page_size | integer | 否 | 每页数量，默认为10 |
| ordering | string | 否 | 排序字段，前缀-表示降序，可用字段：created_at, order_date, customer_total_amount, payment_status |

### 响应

```json
{
  "count": 25,
  "next": "http://example.com/api/v1/orders/?page=2",
  "previous": null,
  "results": [
    {
      "id": 1,
      "order_number": "PQ-202507-1234",
      "customer_name": "北京科技有限公司",
      "created_by_info": {
        "id": 1,
        "username": "admin",
        "display_name": "管理员"
      },
      "customer_contact_info": {
        "id": 12,
        "username": "lisi",
        "display_name": "李四",
        "phone": "13900139000",
        "email": "lisi@example.com"
      },
      "profit": 600.00,
      "profit_rate": 0.30,
      "formatted_profit": "¥600.00",
      "formatted_profit_rate": "30.00%",
      "created_at": "2025-07-10T11:22:33Z",
      "updated_at": "2025-07-10T11:22:33Z",
      "is_deleted": false,
      "service_type": "文档翻译",
      "language": "中英",
      "customer_count": "5000字",
      "customer_total_amount": "2000.00",
      "payment_status": "paid",
      "payment_status_display": "已支付",
      "order_date": "2025-07-10",
      "service_time": "2025-07-15",
      "customer": 3
    },
    // ... 更多订单数据
  ]
}
```

### 示例

```bash
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/?service_type=文档翻译&payment_status=paid&page=1' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
```

## 2. 获取订单详情

获取指定ID的订单详细信息。

### 请求

```
GET /api/v1/orders/{id}/
```

### 路径参数

| 参数名 | 类型 | 描述 |
| --- | --- | --- |
| id | integer | 订单ID |

### 响应

```json
{
  "id": 1,
  "customer": {
    "id": 3,
    "name": "北京科技有限公司",
    "code": "BJ001",
    "contact_name": "李四",
    "contact_phone": "13900139000",
    "contact_email": "lisi@example.com"
  },
  "customer_contact": {
    "id": 12,
    "username": "lisi",
    "display_name": "李四",
    "phone": "13900139000",
    "email": "lisi@example.com"
  },
  "history_count": 1,
  "profit": 600.00,
  "profit_rate": 0.30,
  "formatted_profit": "¥600.00",
  "formatted_profit_rate": "30.00%",
  "created_at": "2025-07-10T11:22:33Z",
  "updated_at": "2025-07-10T11:22:33Z",
  "is_deleted": false,
  "order_number": "PQ-202507-1234",
  "source_platform": "邮件咨询",
  "project_manager": "八组",
  "customer_type": "新客户",
  "order_date": "2025-07-10",
  "service_type": "校对服务",
  "service_type_display": "校对服务",
  "language": "中英",
  "customer_count": "3000字",
  "translation_count": "3000字",
  "service_time": "2025-07-12",
  "project_location": "线上",
  "translator": "王五",
  "customer_price": "0.67元/字",
  "customer_total_amount": "2000.00",
  "translator_fee": "1200.00",
  "translator_price": "0.4元/字",
  "translator_payment_status": "已付款",
  "translator_payment_method": "微信",
  "project_fee": "200.00",
  "project_details": "英文论文校对",
  "cost_details": "术语表制作费用200元",
  "refund_amount": "0.00",
  "refund_reason": null,
  "payment_status": "paid",
  "payment_status_display": "已支付",
  "payment_date": "2025-07-10",
  "payment_method": "支付宝",
  "payment_remarks": "已确认收款",
  "invoice_status": "issued",
  "invoice_status_display": "已开具",
  "invoice_info": "已开具电子发票",
  "contract_number": null,
  "contract_info": null,
  "contract_remarks": null,
  "delivery_address": null,
  "order_address": "北京市海淀区xx路xx号",
  "remarks": "客户要求重点检查专业术语",
  "follow_up_record": "2025-07-11已电话回访，客户表示满意",
  "tenant": 1
}
```

### 示例

```bash
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/1/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
```

## 3. 创建订单

创建一个新的订单。

### 请求

```
POST /api/v1/orders/
```

### 请求体

| 字段名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| customer | integer | 是 | 客户ID |
| source_platform | string | 否 | 来源平台 |
| project_manager | string | 否 | 项目负责人 |
| customer_type | string | 否 | 客户类型 |
| order_date | string | 否 | 下单日期 (YYYY-MM-DD) |
| service_type | string | 是 | 服务类型 |
| language | string | 是 | 语种 |
| customer_count | string | 是 | 客户数量 |
| translation_count | string | 否 | 翻译数量 |
| service_time | string | 否 | 服务时间 |
| project_location | string | 否 | 项目地点 |
| customer_contact | integer | 否 | 客户联系人ID |
| translator | string | 否 | 译员 |
| customer_price | string | 否 | 客户单价 |
| customer_total_amount | string | 是 | 客户总价 |
| translator_fee | string | 否 | 译员费用 |
| translator_price | string | 否 | 翻译单价 |
| translator_payment_status | string | 否 | 译费支付状态 |
| translator_payment_method | string | 否 | 译费支付方式 |
| project_fee | string | 否 | 项目费用 |
| project_details | string | 否 | 项目明细 |
| cost_details | string | 否 | 费用明细 |
| refund_amount | string | 否 | 项目退款 |
| refund_reason | string | 否 | 退款原因 |
| payment_status | string | 否 | 支付状态 |
| payment_date | string | 否 | 支付日期 (YYYY-MM-DD) |
| payment_method | string | 否 | 支付方式 |
| payment_remarks | string | 否 | 支付备注 |
| invoice_status | string | 否 | 发票状态 |
| invoice_info | string | 否 | 发票信息 |
| contract_number | string | 否 | 合同编号 |
| contract_info | string | 否 | 合同信息 |
| contract_remarks | string | 否 | 合同备注 |
| delivery_address | string | 否 | 收件地址 |
| order_address | string | 否 | 订单地址 |
| remarks | string | 否 | 备注 |
| follow_up_record | string | 否 | 回访记录 |

### 响应

成功时返回201状态码和新创建的订单对象：

```json
{
  "id": 25,
  "created_at": "2025-07-20T10:30:45Z",
  "updated_at": "2025-07-20T10:30:45Z",
  "is_deleted": false,
  "order_number": "PQ-202507-8765",
  "customer": 1,
  "source_platform": "官网",
  "project_manager": "五组",
  "customer_type": "老客户",
  "order_date": "2025-07-20",
  "service_type": "文档翻译",
  "language": "中英",
  "customer_count": "5000字",
  "translation_count": "5000字",
  "service_time": "2025-07-25",
  "project_location": "线上",
  "customer_contact": 5,
  "translator": "张三",
  "customer_price": "0.3元/字",
  "customer_total_amount": "1500.00",
  "translator_fee": "750.00",
  "translator_price": "0.15元/字",
  "translator_payment_status": "待付款",
  "translator_payment_method": "支付宝",
  "project_fee": "50.00",
  "project_details": "技术文档翻译，包含5个Word文档",
  "cost_details": "版式调整费用50元",
  "refund_amount": "0.00",
  "refund_reason": null,
  "payment_status": "paid",
  "payment_date": "2025-07-20",
  "payment_method": "微信支付",
  "payment_remarks": null,
  "invoice_status": "pending",
  "invoice_info": "需要开具增值税专用发票",
  "contract_number": null,
  "contract_info": null,
  "contract_remarks": null,
  "delivery_address": null,
  "order_address": null,
  "remarks": "客户要求保持原文格式",
  "follow_up_record": null,
  "tenant": 1,
  "payment_status_display": "已支付",
  "service_type_display": "文档翻译",
  "invoice_status_display": "待开具",
  "profit": 700.0,
  "profit_rate": 0.4667,
  "formatted_profit": "¥700.00",
  "formatted_profit_rate": "46.67%"
}
```

### 示例

```bash
curl -X 'POST' \
  'http://localhost:8000/api/v1/orders/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: application/json' \
  -d '{
    "source_platform": "官网",
    "project_manager": "五组",
    "customer_type": "老客户",
    "order_date": "2025-07-20",
    "service_type": "文档翻译",
    "language": "中英",
    "customer_count": "5000字",
    "translation_count": "5000字",
    "service_time": "2025-07-25",
    "project_location": "线上",
    "translator": "张三",
    "customer_price": "0.3元/字",
    "customer_total_amount": "1500.00",
    "translator_fee": "750.00",
    "translator_price": "0.15元/字",
    "translator_payment_status": "待付款",
    "translator_payment_method": "支付宝",
    "project_fee": "50.00",
    "project_details": "技术文档翻译，包含5个Word文档",
    "cost_details": "版式调整费用50元",
    "payment_status": "paid",
    "payment_date": "2025-07-20",
    "payment_method": "微信支付",
    "invoice_status": "pending",
    "invoice_info": "需要开具增值税专用发票",
    "remarks": "客户要求保持原文格式",
    "customer": 1,
    "customer_contact": 5
  }'
```

## 4. 更新订单

更新指定ID的订单信息，需要提供订单的所有字段（完整更新）。

### 请求

```
PUT /api/v1/orders/{id}/
```

### 路径参数

| 参数名 | 类型 | 描述 |
| --- | --- | --- |
| id | integer | 订单ID |

### 请求体

请求体与创建订单相同，但需要包含所有字段的值。

### 响应

成功时返回200状态码和更新后的订单对象。

### 示例

```bash
curl -X 'PUT' \
  'http://localhost:8000/api/v1/orders/1/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: application/json' \
  -d '{
    "source_platform": "官网",
    "project_manager": "五组",
    "customer_type": "老客户",
    "order_date": "2025-07-10",
    "service_type": "文档翻译",
    "language": "中英",
    "customer_count": "5000字",
    "translation_count": "5000字",
    "service_time": "2025-07-15",
    "project_location": "线上",
    "translator": "张三",
    "customer_price": "0.3元/字",
    "customer_total_amount": "1500.00",
    "translator_fee": "750.00",
    "translator_price": "0.15元/字",
    "translator_payment_status": "已付款",
    "translator_payment_method": "支付宝",
    "project_fee": "50.00",
    "project_details": "技术文档翻译，包含5个Word文档",
    "cost_details": "版式调整费用50元",
    "refund_amount": "0.00",
    "refund_reason": null,
    "payment_status": "paid",
    "payment_date": "2025-07-10",
    "payment_method": "微信支付",
    "payment_remarks": "已确认收款",
    "invoice_status": "issued",
    "invoice_info": "已开具电子发票",
    "contract_number": "",
    "contract_info": "",
    "contract_remarks": "",
    "delivery_address": "",
    "order_address": "北京市海淀区xx路xx号",
    "remarks": "客户要求保持原文格式，已完成交付",
    "follow_up_record": "2025-07-11已电话回访，客户表示满意",
    "customer": 3,
    "customer_contact": 12
  }'
```

## 5. 部分更新订单

部分更新指定ID的订单信息，只需提供需要更新的字段。

### 请求

```
PATCH /api/v1/orders/{id}/
```

### 路径参数

| 参数名 | 类型 | 描述 |
| --- | --- | --- |
| id | integer | 订单ID |

### 请求体

只需包含要更新的字段。

### 响应

成功时返回200状态码和更新后的订单对象。

### 示例

```bash
curl -X 'PATCH' \
  'http://localhost:8000/api/v1/orders/1/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: application/json' \
  -d '{
    "payment_status": "paid",
    "payment_date": "2025-07-18",
    "payment_method": "银行转账",
    "payment_remarks": "已确认收款"
  }'
```

## 6. 删除订单

删除指定ID的订单（软删除）。

### 请求

```
DELETE /api/v1/orders/{id}/
```

### 路径参数

| 参数名 | 类型 | 描述 |
| --- | --- | --- |
| id | integer | 订单ID |

### 响应

成功时返回204状态码，无响应内容。

### 示例

```bash
curl -X 'DELETE' \
  'http://localhost:8000/api/v1/orders/1/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
``` 