# 客户订单管理API

本文档介绍了客户订单管理API，用于获取特定客户的所有订单及订单详情。

## 1. 获取客户订单列表

获取特定客户的所有订单，支持分页、排序和筛选。

### 请求

```
GET /api/v1/orders/customers/{customer_id}/orders/
```

### 路径参数

| 参数名 | 类型 | 描述 |
| --- | --- | --- |
| customer_id | integer | 客户ID |

### 查询参数

| 参数名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| payment_status | string | 否 | 按支付状态筛选订单 |
| service_type | string | 否 | 按服务类型筛选订单 |
| order_date_from | string | 否 | 按订单日期范围筛选（起始），格式YYYY-MM-DD |
| order_date_to | string | 否 | 按订单日期范围筛选（结束），格式YYYY-MM-DD |
| search | string | 否 | 搜索订单编号、译员等信息 |
| page | integer | 否 | 页码，默认为1 |
| page_size | integer | 否 | 每页数量，默认为10 |
| ordering | string | 否 | 排序字段，可用字段: created_at, order_date, customer_total_amount, payment_status |

### 响应

```json
{
  "count": 2,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": 15,
      "customer_name": "上海环球公司",
      "created_by_info": {
        "id": 1,
        "username": "admin",
        "display_name": "管理员"
      },
      "customer_contact_info": {
        "id": 8,
        "username": "zhangsan",
        "display_name": "张三",
        "phone": "13800138000",
        "email": "zhangsan@example.com"
      },
      "profit": 1000.00,
      "profit_rate": 0.40,
      "formatted_profit": "¥1000.00",
      "formatted_profit_rate": "40.00%",
      "created_at": "2025-07-15T08:30:45Z",
      "updated_at": "2025-07-15T08:30:45Z",
      "is_deleted": false,
      "order_number": "PQ-202507-5678",
      "service_type": "文档翻译",
      "language": "中英",
      "customer_count": "5000字",
      "customer_total_amount": "2500.00",
      "payment_status": "paid",
      "payment_status_display": "已支付"
    },
    {
      "id": 16,
      "customer_name": "上海环球公司",
      "created_by_info": {
        "id": 1,
        "username": "admin",
        "display_name": "管理员"
      },
      "customer_contact_info": {
        "id": 8,
        "username": "zhangsan",
        "display_name": "张三",
        "phone": "13800138000",
        "email": "zhangsan@example.com"
      },
      "profit": 800.00,
      "profit_rate": 0.32,
      "formatted_profit": "¥800.00",
      "formatted_profit_rate": "32.00%",
      "created_at": "2025-07-16T09:45:30Z",
      "updated_at": "2025-07-16T09:45:30Z",
      "is_deleted": false,
      "order_number": "PQ-202507-9876",
      "service_type": "口译服务",
      "language": "中日",
      "customer_count": "1天",
      "customer_total_amount": "2500.00",
      "payment_status": "unpaid",
      "payment_status_display": "未支付"
    }
  ]
}
```

### 示例

```bash
# 获取客户ID为5的所有订单
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/customers/5/orders/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

# 获取客户ID为5的已支付订单
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/customers/5/orders/?payment_status=paid' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

# 按日期范围筛选客户订单
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/customers/5/orders/?order_date_from=2025-07-01&order_date_to=2025-07-31' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

# 搜索客户订单
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/customers/5/orders/?search=张三' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
```

## 2. 获取客户订单详情

获取特定客户的指定订单详情。

### 请求

```
GET /api/v1/orders/customers/{customer_id}/orders/{id}/
```

### 路径参数

| 参数名 | 类型 | 描述 |
| --- | --- | --- |
| customer_id | integer | 客户ID |
| id | integer | 订单ID |

### 响应

```json
{
  "id": 15,
  "customer": {
    "id": 5,
    "name": "上海环球公司",
    "code": "SH001",
    "contact_name": "张三",
    "contact_phone": "13800138000",
    "contact_email": "zhangsan@example.com"
  },
  "customer_contact": {
    "id": 8,
    "username": "zhangsan",
    "display_name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com"
  },
  "history_count": 2,
  "profit": 1000.00,
  "profit_rate": 0.40,
  "formatted_profit": "¥1000.00",
  "formatted_profit_rate": "40.00%",
  "created_at": "2025-07-15T08:30:45Z",
  "updated_at": "2025-07-15T08:30:45Z",
  "is_deleted": false,
  "order_number": "PQ-202507-5678",
  "source_platform": "官网",
  "project_manager": "五组",
  "customer_type": "老客户",
  "order_date": "2025-07-15",
  "service_type": "文档翻译",
  "service_type_display": "文档翻译",
  "language": "中英",
  "customer_count": "5000字",
  "translation_count": "5000字",
  "service_time": "2025-07-20",
  "project_location": "线上",
  "translator": "张三",
  "customer_price": "0.5元/字",
  "customer_total_amount": "2500.00",
  "translator_fee": "1250.00",
  "translator_price": "0.25元/字",
  "translator_payment_status": "已付款",
  "translator_payment_method": "支付宝",
  "project_fee": "250.00",
  "project_details": "技术文档翻译，包含10个Word文档",
  "cost_details": "版式调整费用250元",
  "refund_amount": "0.00",
  "refund_reason": null,
  "payment_status": "paid",
  "payment_status_display": "已支付",
  "payment_date": "2025-07-15",
  "payment_method": "银行转账",
  "payment_remarks": "已确认收款",
  "invoice_status": "issued",
  "invoice_status_display": "已开具",
  "invoice_info": "增值税专用发票已邮寄",
  "contract_number": "HT-202507-001",
  "contract_info": "合同已签署",
  "contract_remarks": "客户要求提前交付",
  "delivery_address": "上海市浦东新区xx路xx号",
  "order_address": "上海市浦东新区xx路xx号",
  "remarks": "客户要求保持原文格式",
  "follow_up_record": "2025-07-16已电话回访，客户表示满意",
  "tenant": 1
}
```

### 示例

```bash
# 获取客户ID为5的订单ID为15的详情
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/customers/5/orders/15/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
```

## 客户订单API说明

### 过滤参数

客户订单API支持以下过滤参数：

1. **按支付状态筛选**：
   - `payment_status=paid` - 已支付的订单
   - `payment_status=unpaid` - 未支付的订单

2. **按服务类型筛选**：
   - `service_type=文档翻译`
   - `service_type=口译服务`
   - `service_type=校对服务`

3. **按日期范围筛选**：
   - `order_date_from=2025-07-01` - 起始日期
   - `order_date_to=2025-07-31` - 结束日期

4. **搜索功能**：
   - `search=关键词` - 搜索订单编号、译员等信息

### 排序选项

客户订单API支持以下排序选项：

- `ordering=created_at` - 按创建时间升序
- `ordering=-created_at` - 按创建时间降序
- `ordering=order_date` - 按订单日期升序
- `ordering=-order_date` - 按订单日期降序
- `ordering=customer_total_amount` - 按客户总金额升序
- `ordering=-customer_total_amount` - 按客户总金额降序
- `ordering=payment_status` - 按支付状态升序
- `ordering=-payment_status` - 按支付状态降序

### 注意事项

- 客户订单API只返回特定客户的订单数据，必须提供有效的客户ID
- 用户必须拥有查看该客户订单的权限
- 接口默认返回未删除的订单（is_deleted=False）
- 支持分页功能，可通过page和page_size参数控制 