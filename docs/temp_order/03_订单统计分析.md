# 订单统计分析API

本文档介绍了订单的统计分析API，包括获取订单统计数据和服务时间提醒功能。

## 1. 获取订单统计数据

获取订单的统计数据，包括总数、总金额、毛利、毛利率等，并按不同维度进行分组统计。

### 请求

```
GET /api/v1/orders/statistics/
```

### 查询参数

| 参数名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| period | string | 否 | 统计周期，可选值: daily, weekly, monthly, yearly，默认为monthly |
| start_date | string | 否 | 开始日期，格式YYYY-MM-DD，默认为前30天 |
| end_date | string | 否 | 结束日期，格式YYYY-MM-DD，默认为当天 |
| customer | integer | 否 | 按客户ID筛选 |
| service_type | string | 否 | 按服务类型筛选 |

### 响应

```json
{
  "period": "monthly",
  "start_date": "2025-01-01",
  "end_date": "2025-07-31",
  "total_orders": 125,
  "customer_total_amount": "350000.00",
  "total_profit": "120000.00",
  "average_profit_rate": 0.34,
  "by_period": [
    {
      "period": "2025-01",
      "count": 15,
      "customer_total_amount": "40000.00",
      "profit": "15000.00",
      "profit_rate": 0.375
    },
    {
      "period": "2025-02",
      "count": 18,
      "customer_total_amount": "45000.00",
      "profit": "16000.00",
      "profit_rate": 0.355
    },
    // ... 其他月份数据
  ],
  "by_service_type": [
    {
      "service_type": "文档翻译",
      "count": 80,
      "customer_total_amount": "250000.00",
      "profit": "85000.00",
      "profit_rate": 0.34
    },
    {
      "service_type": "口译服务",
      "count": 25,
      "customer_total_amount": "70000.00",
      "profit": "25000.00",
      "profit_rate": 0.357
    },
    {
      "service_type": "校对服务",
      "count": 20,
      "customer_total_amount": "30000.00",
      "profit": "10000.00",
      "profit_rate": 0.333
    }
  ],
  "by_payment_status": [
    {
      "payment_status": "paid",
      "count": 100,
      "customer_total_amount": "300000.00",
      "profit": "100000.00",
      "profit_rate": 0.333
    },
    {
      "payment_status": "unpaid",
      "count": 25,
      "customer_total_amount": "50000.00",
      "profit": "20000.00",
      "profit_rate": 0.4
    }
  ]
}
```

### 示例

```bash
# 获取2025年上半年的月度统计数据
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/statistics/?period=monthly&start_date=2025-01-01&end_date=2025-06-30' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

# 获取特定客户的统计数据
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/statistics/?customer=3' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

# 获取特定服务类型的统计数据
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/statistics/?service_type=文档翻译' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
```

## 2. 获取订单提醒

获取未来N天内需要交付的订单提醒列表，帮助管理人员及时关注即将到期的订单。

### 请求

```
GET /api/v1/orders/reminders/
```

### 查询参数

| 参数名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| days | integer | 否 | 未来天数范围，默认为7天 |
| keyword | string | 否 | 按关键词筛选订单 |

### 响应

```json
{
  "count": 5,
  "results": [
    {
      "id": 15,
      "order_number": "PQ-202507-5678",
      "customer_name": "上海环球公司",
      "service_type": "文档翻译",
      "service_time": "2025-07-22",
      "days_remaining": 2,
      "customer_total_amount": "2500.00",
      "payment_status": "paid",
      "translator": "张三",
      "project_manager": "五组"
    },
    {
      "id": 16,
      "order_number": "PQ-202507-9876",
      "customer_name": "上海环球公司",
      "service_type": "口译服务",
      "service_time": "2025-07-25",
      "days_remaining": 5,
      "customer_total_amount": "3000.00",
      "payment_status": "unpaid",
      "translator": "李四",
      "project_manager": "三组"
    },
    // ... 更多订单数据
  ],
  "summary": {
    "total": 5,
    "urgent": 2,
    "paid": 3,
    "unpaid": 2,
    "total_amount": "15000.00"
  }
}
```

### 示例

```bash
# 获取未来7天内的订单提醒（默认）
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/reminders/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

# 获取未来3天内的紧急订单提醒
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/reminders/?days=3' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

# 按关键词筛选订单提醒
curl -X 'GET' \
  'http://localhost:8000/api/v1/orders/reminders/?keyword=环球' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
```

## 订单统计数据说明

### 统计周期

API支持以下统计周期：
- `daily`: 按日统计，适合查看短期趋势
- `weekly`: 按周统计，适合查看中期趋势
- `monthly`: 按月统计（默认），适合查看长期趋势
- `yearly`: 按年统计，适合查看多年趋势

### 统计维度

API返回以下维度的统计数据：

1. **总体数据**：
   - `total_orders`: 订单总数
   - `customer_total_amount`: 订单总金额
   - `total_profit`: 总毛利
   - `average_profit_rate`: 平均毛利率

2. **按周期分组**：根据选择的统计周期（daily/weekly/monthly/yearly）对数据进行分组，每组包含：
   - `period`: 周期标识（如2025-01表示2025年1月）
   - `count`: 订单数量
   - `customer_total_amount`: 客户总金额
   - `profit`: 毛利
   - `profit_rate`: 毛利率

3. **按服务类型分组**：
   - `service_type`: 服务类型
   - `count`: 订单数量
   - `customer_total_amount`: 客户总金额
   - `profit`: 毛利
   - `profit_rate`: 毛利率

4. **按支付状态分组**：
   - `payment_status`: 支付状态
   - `count`: 订单数量
   - `customer_total_amount`: 客户总金额
   - `profit`: 毛利
   - `profit_rate`: 毛利率

### 提醒系统

提醒系统基于以下规则：
- 默认显示未来7天内需要交付的订单
- 未来3天内的订单被标记为紧急（urgent）
- 提醒按服务交付日期（service_time）排序
- 包含订单的基本信息和剩余天数 