# 订单批量操作API

本文档介绍了订单的批量操作API，包括导入、导出和批量更新订单。

## 1. 导出订单数据

将订单数据导出为Excel或CSV文件。

### 请求

```
POST /api/v1/orders/export/
```

### 请求体

| 参数名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| order_ids | array | 否 | 要导出的订单ID列表，如果不提供则导出所有订单 |
| format | string | 否 | 导出格式，支持 xlsx 和 csv，默认为 xlsx |

### 响应

成功时返回Excel或CSV文件，Content-Type取决于请求的format参数：
- xlsx: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
- csv: text/csv

### 示例

```bash
# 导出指定订单
curl -X 'POST' \
  'http://localhost:8000/api/v1/orders/export/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: application/json' \
  -d '{
    "order_ids": [1, 2, 3, 4, 5],
    "format": "xlsx"
  }' \
  --output orders.xlsx

# 导出所有订单为CSV
curl -X 'POST' \
  'http://localhost:8000/api/v1/orders/export/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: application/json' \
  -d '{
    "format": "csv"
  }' \
  --output orders.csv
```

## 2. 导入订单数据

从Excel文件导入订单数据。

### 请求

```
POST /api/v1/orders/import_data/
```

### 请求体

使用`multipart/form-data`格式提交：

| 参数名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| file | file | 是 | 包含订单数据的Excel文件 |
| update_existing | boolean | 否 | 是否更新已存在的订单，默认为false |

### 响应

```json
{
  "status": "success",
  "total_records": 10,
  "created": 8,
  "updated": 0,
  "failed": 2,
  "errors": [
    "行5: 客户ID不存在",
    "行8: 金额格式不正确"
  ]
}
```

### 示例

```bash
curl -X 'POST' \
  'http://localhost:8000/api/v1/orders/import_data/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@orders.xlsx' \
  -F 'update_existing=false'
```

## 3. 批量操作订单

批量更新或删除订单。

### 请求

```
POST /api/v1/orders/bulk_operations/
```

### 请求体

| 参数名 | 类型 | 必填 | 描述 |
| --- | --- | --- | --- |
| order_ids | array | 是 | 要操作的订单ID列表 |
| action | string | 是 | 操作类型，可选值: update, delete |
| data | object | 仅在action=update时必填 | 要更新的字段和值 |

### 响应

```json
{
  "status": "success",
  "message": "成功更新3个订单",
  "updated_count": 3,
  "errors": []
}
```

### 示例

```bash
# 批量更新支付状态
curl -X 'POST' \
  'http://localhost:8000/api/v1/orders/bulk_operations/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: application/json' \
  -d '{
    "order_ids": [1, 2, 3],
    "action": "update",
    "data": {
      "payment_status": "paid",
      "payment_date": "2025-07-18",
      "payment_method": "银行转账"
    }
  }'

# 批量删除订单
curl -X 'POST' \
  'http://localhost:8000/api/v1/orders/bulk_operations/' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \
  -H 'Content-Type: application/json' \
  -d '{
    "order_ids": [4, 5, 6],
    "action": "delete"
  }'
```

## 导入/导出文件格式说明

### 导出格式

导出的Excel/CSV文件包含以下字段：

| 列名 | 描述 |
| --- | --- |
| 订单编号 | 系统生成的唯一订单编号 |
| 客户名称 | 客户公司名称 |
| 客户联系人 | 客户联系人姓名 |
| 服务类型 | 订单的服务类型 |
| 语种 | 翻译或服务的语种 |
| 客户数量 | 客户订购的数量（如字数、天数等） |
| 客户单价 | 客户的单价（如每字、每天的价格） |
| 客户总价 | 客户需支付的总金额 |
| 译员 | 执行翻译的译员姓名 |
| 译员费用 | 支付给译员的费用 |
| 项目费用 | 除译员费用外的其他项目费用 |
| 毛利 | 客户总价减去译员费用和项目费用 |
| 毛利率 | 毛利除以客户总价的百分比 |
| 支付状态 | 客户支付状态 |
| 支付日期 | 客户付款的日期 |
| 支付方式 | 客户支付的方式（如微信、支付宝、银行转账） |
| 下单日期 | 订单创建日期 |
| 服务时间 | 服务交付日期 |
| 备注 | 订单相关备注 |

### 导入格式

导入的Excel文件需要包含以下必填字段：

| 列名 | 必填 | 描述 |
| --- | --- | --- |
| 客户名称/ID | 是 | 客户名称或客户ID |
| 服务类型 | 是 | 订单的服务类型 |
| 语种 | 是 | 翻译或服务的语种 |
| 客户数量 | 是 | 客户订购的数量 |
| 客户总价 | 是 | 客户需支付的总金额 |

以下字段为可选：

| 列名 | 描述 |
| --- | --- |
| 客户联系人 | 客户联系人姓名或ID |
| 来源平台 | 订单来源平台 |
| 项目负责人 | 负责项目的人员或团队 |
| 客户类型 | 客户类型分类 |
| 下单日期 | 订单创建日期 |
| 翻译数量 | 翻译的实际数量 |
| 服务时间 | 服务交付日期 |
| 项目地点 | 项目执行地点 |
| 译员 | 执行翻译的译员姓名 |
| 客户单价 | 客户的单价 |
| 译员费用 | 支付给译员的费用 |
| 译员单价 | 译员的单价 |
| 译员支付状态 | 译员费用的支付状态 |
| 译员支付方式 | 支付给译员的方式 |
| 项目费用 | 除译员费用外的其他项目费用 |
| 项目明细 | 项目费用的详细说明 |
| 费用明细 | 其他费用的详细说明 |
| 退款金额 | 项目退款金额 |
| 退款原因 | 退款的原因 |
| 支付状态 | 客户支付状态 |
| 支付日期 | 客户付款的日期 |
| 支付方式 | 客户支付的方式 |
| 支付备注 | 关于支付的备注信息 |
| 发票状态 | 发票开具状态 |
| 发票信息 | 发票相关信息 |
| 备注 | 订单相关备注 |
| 回访记录 | 客户回访记录 | 