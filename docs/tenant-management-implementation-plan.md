# 租户管理功能实现计划

## 1. 项目概述

本计划旨在为现有的Vue3后端管理系统添加租户管理功能。该功能将仅对超级管理员开放，用于管理多租户SaaS应用中的租户及其资源配额。

## 2. 需求分析

根据租户管理模块文档，我们需要实现以下功能：

1. **租户基础操作**：
   - 获取租户列表
   - 创建租户
   - 查看租户详情
   - 编辑租户信息
   - 删除租户

2. **租户配额管理**：
   - 查看租户配额
   - 更新租户配额
   - 查看配额使用情况

3. **租户状态管理**：
   - 暂停租户
   - 激活租户

4. **租户用户管理**：
   - 查看租户下的用户列表

所有这些功能需要集成到现有的Vue3管理系统中，并且仅对具有超级管理员权限的用户可见。

## 3. 技术架构

基于现有项目技术栈，我们将使用以下技术实现租户管理功能：

- **前端框架**：Vue 3 + TypeScript
- **UI组件库**：Element Plus
- **状态管理**：Pinia
- **HTTP客户端**：Axios（通过项目封装的http模块）
- **路由**：Vue Router
- **国际化**：Vue I18n

## 4. API集成规范

根据租户管理API文档，前端需要集成以下API端点：

### 4.1 租户基础操作API

| 端点 | 方法 | 描述 | 权限要求 |
|------|------|------|---------|
| `/api/v1/tenants/` | GET | 获取租户列表 | 超级管理员 |
| `/api/v1/tenants/` | POST | 创建新租户 | 超级管理员 |
| `/api/v1/tenants/{id}/` | GET | 获取租户详情 | 超级管理员 |
| `/api/v1/tenants/{id}/` | PUT | 更新租户信息 | 超级管理员 |
| `/api/v1/tenants/{id}/` | DELETE | 删除租户 | 超级管理员 |
| `/api/v1/tenants/{id}/comprehensive/` | GET | 获取租户综合信息 | 超级管理员或该租户管理员 |

### 4.2 租户配额管理API

| 端点 | 方法 | 描述 | 权限要求 |
|------|------|------|---------|
| `/api/v1/tenants/{id}/quota/` | GET | 获取租户配额 | 超级管理员或该租户管理员 |
| `/api/v1/tenants/{id}/quota/` | PUT | 更新租户配额 | 超级管理员 |
| `/api/v1/tenants/{id}/quota/usage/` | GET | 获取租户配额使用情况 | 超级管理员或该租户管理员 |

### 4.3 租户状态管理API

| 端点 | 方法 | 描述 | 权限要求 |
|------|------|------|---------|
| `/api/v1/tenants/{id}/suspend/` | POST | 暂停租户 | 超级管理员 |
| `/api/v1/tenants/{id}/activate/` | POST | 激活租户 | 超级管理员 |

### 4.4 租户用户管理API

| 端点 | 方法 | 描述 | 权限要求 |
|------|------|------|---------|
| `/api/v1/tenants/{id}/users/` | GET | 获取租户用户列表 | 超级管理员或该租户管理员 |

## 5. 数据模型

### 5.1 租户模型

租户的核心数据模型如下：

```
Tenant {
  id: number            // 租户ID
  name: string          // 租户名称
  status: string        // 租户状态（active/suspended/deleted）
  contact_name: string  // 联系人姓名
  contact_email: string // 联系人邮箱
  contact_phone: string // 联系人电话
  created_at: string    // 创建时间
  updated_at: string    // 更新时间
  user_count: number    // 用户数量（只在详情中返回）
  admin_count: number   // 管理员数量（只在详情中返回）
}
```

### 5.2 租户配额模型

```
TenantQuota {
  id: number            // 配额ID
  tenant: {             // 所属租户
    id: number
    name: string
  }
  max_users: number     // 最大用户数
  max_admins: number    // 最大管理员数
  max_storage_mb: number // 最大存储空间(MB)
  max_products: number  // 最大产品数
  current_storage_used_mb: number // 当前已使用存储空间(MB)
  created_at: string    // 创建时间
  updated_at: string    // 更新时间
}
```

### 5.3 租户用户模型

```
TenantUser {
  id: number            // 用户ID
  username: string      // 用户名
  email: string         // 邮箱
  nick_name: string     // 昵称
  is_active: boolean    // 是否激活
  is_admin: boolean     // 是否管理员
  status: string        // 状态
  date_joined: string   // 加入时间
}
```

## 6. 用户界面设计

### 6.1 页面结构与导航

租户管理模块将添加到系统的主导航菜单中，仅对超级管理员可见。

**导航路径**：
- 主菜单 > 租户管理 > 租户列表

**页面层次结构**：
```
租户管理
├── 租户列表页
│   ├── 创建租户页
│   ├── 编辑租户页
│   └── 租户详情页
│       ├── 配额管理页
│       └── 租户用户页
```

### 6.2 租户列表页线框图

```
+---------------------------------------------------------------+
|                           系统头部                             |
+---------------+-----------------------------------------------+
|               |  租户管理 > 租户列表                           |
|               |  +------------------------------------------+ |
|               |  | 搜索框   状态筛选   创建租户按钮         | |
|               |  +------------------------------------------+ |
|               |  | 租户列表表格                             | |
|  侧边导航栏    |  | +------+------+--------+--------+------+ | |
|               |  | | ID   | 名称 | 状态   | 联系人 | 操作 | | |
|               |  | +------+------+--------+--------+------+ | |
|               |  | | 1    | 租户A| 活跃   | 张三   | ...  | | |
|               |  | +------+------+--------+--------+------+ | |
|               |  | | 2    | 租户B| 已暂停 | 李四   | ...  | | |
|               |  | +------+------+--------+--------+------+ | |
|               |  |                                          | |
|               |  | 分页控件                                 | |
|               |  +------------------------------------------+ |
+---------------+-----------------------------------------------+
```

**租户列表表格列**：
- ID：租户ID
- 名称：租户名称
- 状态：使用不同颜色的标签显示（活跃-绿色、已暂停-橙色、已删除-红色）
- 联系人：联系人姓名
- 联系邮箱：联系人邮箱
- 创建时间：租户创建时间
- 操作：查看、编辑、删除、激活/暂停按钮

### 6.3 创建/编辑租户页线框图

```
+---------------------------------------------------------------+
|                           系统头部                             |
+---------------+-----------------------------------------------+
|               |  租户管理 > 创建租户/编辑租户                  |
|               |  +------------------------------------------+ |
|               |  | 返回按钮                                 | |
|               |  +------------------------------------------+ |
|               |  | 租户表单                                 | |
|  侧边导航栏    |  | +--------------------------------------+ | |
|               |  | | 租户名称 *                           | | |
|               |  | +--------------------------------------+ | |
|               |  | | 租户状态                             | | |
|               |  | +--------------------------------------+ | |
|               |  | | 联系人姓名                           | | |
|               |  | +--------------------------------------+ | |
|               |  | | 联系人邮箱                           | | |
|               |  | +--------------------------------------+ | |
|               |  | | 联系人电话                           | | |
|               |  | +--------------------------------------+ | |
|               |  |                                          | |
|               |  | 提交按钮    取消按钮                     | |
|               |  +------------------------------------------+ |
+---------------+-----------------------------------------------+
```

### 6.4 租户详情页线框图

```
+---------------------------------------------------------------+
|                           系统头部                             |
+---------------+-----------------------------------------------+
|               |  租户管理 > 租户详情                           |
|               |  +------------------------------------------+ |
|               |  | 返回按钮    编辑按钮    删除按钮          | |
|               |  +------------------------------------------+ |
|               |  | 基本信息卡片                             | |
|               |  | +--------------------------------------+ | |
|               |  | | 租户ID: 1                           | | |
|  侧边导航栏    |  | | 租户名称: 租户A                     | | |
|               |  | | 状态: [活跃]                        | | |
|               |  | | 联系人: 张三                        | | |
|               |  | | 邮箱: zhangsan@example.com         | | |
|               |  | | 电话: 13800138000                  | | |
|               |  | | 创建时间: 2025-04-20 10:00:00      | | |
|               |  | +--------------------------------------+ | |
|               |  |                                          | |
|               |  | 配额使用情况卡片                         | |
|               |  | +--------------------------------------+ | |
|               |  | | 用户数: 10/20  [进度条-50%]          | | |
|               |  | | 管理员数: 2/5  [进度条-40%]          | | |
|               |  | | 存储空间: 120MB/2GB  [进度条-6%]     | | |
|               |  | | 产品数: 25/100  [进度条-25%]         | | |
|               |  | |                                      | | |
|               |  | | 管理配额按钮                         | | |
|               |  | +--------------------------------------+ | |
|               |  |                                          | |
|               |  | 用户统计卡片                             | |
|               |  | +--------------------------------------+ | |
|               |  | | 用户总数: 10                        | | |
|               |  | | 管理员数: 2                         | | |
|               |  | |                                      | | |
|               |  | | 查看用户按钮                         | | |
|               |  | +--------------------------------------+ | |
|               |  |                                          | |
|               |  | 操作按钮: [激活/暂停租户]                | |
|               |  +------------------------------------------+ |
+---------------+-----------------------------------------------+
```

### 6.5 配额管理页线框图

```
+---------------------------------------------------------------+
|                           系统头部                             |
+---------------+-----------------------------------------------+
|               |  租户管理 > 配额管理                           |
|               |  +------------------------------------------+ |
|               |  | 返回按钮                                 | |
|               |  +------------------------------------------+ |
|               |  | 配额使用情况图表                         | |
|               |  | +--------------------------------------+ | |
|  侧边导航栏    |  | | [仪表盘/饼图展示各项配额使用情况]     | | |
|               |  | +--------------------------------------+ | |
|               |  |                                          | |
|               |  | 配额设置表单                             | |
|               |  | +--------------------------------------+ | |
|               |  | | 最大用户数                           | | |
|               |  | +--------------------------------------+ | |
|               |  | | 最大管理员数                         | | |
|               |  | +--------------------------------------+ | |
|               |  | | 最大存储空间(MB)                     | | |
|               |  | +--------------------------------------+ | |
|               |  | | 最大产品数                           | | |
|               |  | +--------------------------------------+ | |
|               |  |                                          | |
|               |  | 保存按钮    取消按钮                     | |
|               |  +------------------------------------------+ |
+---------------+-----------------------------------------------+
```

### 6.6 租户用户页线框图

```
+---------------------------------------------------------------+
|                           系统头部                             |
+---------------+-----------------------------------------------+
|               |  租户管理 > 租户用户                           |
|               |  +------------------------------------------+ |
|               |  | 返回按钮                                 | |
|               |  +------------------------------------------+ |
|               |  | 搜索和筛选                               | |
|               |  | +--------------------------------------+ | |
|  侧边导航栏    |  | | 搜索框  角色筛选  状态筛选           | | |
|               |  | +--------------------------------------+ | |
|               |  |                                          | |
|               |  | 用户列表表格                             | |
|               |  | +----+--------+-------+-------+--------+ | |
|               |  | | ID | 用户名 | 邮箱  | 角色  | 状态   | | |
|               |  | +----+--------+-------+-------+--------+ | |
|               |  | | 1  | user1  | email | 管理员| 活跃   | | |
|               |  | +----+--------+-------+-------+--------+ | |
|               |  | | 2  | user2  | email | 用户  | 活跃   | | |
|               |  | +----+--------+-------+-------+--------+ | |
|               |  |                                          | |
|               |  | 分页控件                                 | |
|               |  +------------------------------------------+ |
+---------------+-----------------------------------------------+
```

## 7. 交互设计

### 7.1 租户状态管理

当操作租户状态（激活/暂停）时，应显示确认对话框：

**暂停租户确认对话框**：
```
+---------------------------------------+
|             确认暂停租户             |
+---------------------------------------+
| 您确定要暂停"租户A"吗？              |
|                                       |
| 暂停后，该租户下的所有用户将无法      |
| 登录系统，但租户数据将被保留。        |
|                                       |
|      [取消]             [确认]        |
+---------------------------------------+
```

**激活租户确认对话框**：
```
+---------------------------------------+
|             确认激活租户             |
+---------------------------------------+
| 您确定要激活"租户A"吗？              |
|                                       |
| 激活后，该租户下的用户将可以          |
| 正常使用系统。                        |
|                                       |
|      [取消]             [确认]        |
+---------------------------------------+
```

### 7.2 删除租户确认

```
+---------------------------------------+
|             确认删除租户             |
+---------------------------------------+
| 您确定要删除"租户A"吗？              |
|                                       |
| 此操作不可逆，但租户数据将保留        |
| 在数据库中（软删除）。                |
|                                       |
|      [取消]             [确认]        |
+---------------------------------------+
```

### 7.3 表单验证

所有表单应实现适当的前端验证：

- **租户名称**：必填，最大长度100
- **联系人邮箱**：有效的邮箱格式
- **联系人电话**：有效的电话号码格式
- **配额字段**：必须为正整数

## 8. 国际化

所有文本内容需支持中文和英文两种语言，包括：

- 菜单项
- 页面标题
- 表单标签和提示
- 按钮文本
- 确认对话框内容
- 状态标签
- 错误提示

## 9. 权限控制

### 9.1 菜单级权限

租户管理模块仅对具有`super_admin`角色的用户可见。

### 9.2 操作级权限

- **查看租户列表**：仅超级管理员
- **创建租户**：仅超级管理员
- **编辑租户**：仅超级管理员
- **删除租户**：仅超级管理员
- **管理租户配额**：仅超级管理员
- **查看租户用户**：超级管理员和相应的租户管理员

## 10. 实现计划

### 10.1 阶段一：需求分析与设计（2天）

1. 分析需求文档
2. 设计UI线框图
3. 设计数据模型和API集成规范
4. 确定技术方案和架构

### 10.2 阶段二：前端开发（5天）

1. 创建API接口定义
2. 设置路由配置
3. 添加国际化支持
4. 创建状态管理
5. 开发组件和页面

### 10.3 阶段三：测试与优化（3天）

1. 单元测试
2. 集成测试
3. UI/UX优化
4. 性能优化

### 10.4 阶段四：文档和部署（1天）

1. 编写开发文档
2. 编写用户手册
3. 部署与配置

## 11. 总结

本计划提供了在现有Vue3后端管理系统中添加租户管理功能的详细设计方案。主要内容包括需求分析、技术架构、API集成规范、数据模型、用户界面设计、交互设计、国际化、权限控制和实现计划。

该租户管理功能将为超级管理员提供全面的租户生命周期管理能力，包括创建租户、配置租户资源配额、管理租户状态以及查看租户用户信息。

实施此计划将帮助系统实现多租户架构下的有效管理，提高系统的可扩展性和用户体验。 