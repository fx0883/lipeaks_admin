# 许可证系统方案A重构更新 - 需求规范

## 📋 项目概述

### 背景
Lipeaks许可证管理系统正处于RIPER-5方案A重构阶段，需要完成字段语义化重命名、API接口优化、前端系统适配等关键更新。本规范基于temp0918和temp0926文档包的深度分析，定义了完整的更新需求和实施标准。

### 目标
- 完成LicensePlan模型字段的语义化重构
- 实现许可证激活API的跨平台优化
- 确保前端系统与新API的完全兼容
- 维持系统的向后兼容性和数据完整性

## 🎯 功能需求

### FR-001: API字段重构
**优先级**: 高
**描述**: 完成LicensePlan模型的字段语义化重命名

**用户故事**:
作为系统管理员，我希望许可证方案的字段名称能够清晰区分模板配置和实际使用值，以便更好地理解和管理许可证方案。

**验收标准**:
- [ ] `max_machines`字段重命名为`default_max_activations`
- [ ] `validity_days`字段重命名为`default_validity_days` 
- [ ] 数据库迁移完成，无数据丢失
- [ ] API响应格式更新为新字段名
- [ ] 向后兼容性处理机制就位

### FR-002: 许可证激活API增强
**优先级**: 高  
**描述**: 实现跨平台硬件指纹识别和安全机制优化

**用户故事**:
作为软件用户，我希望能够在macOS（包括Apple Silicon）上顺利激活许可证，并享受安全可靠的激活体验。

**验收标准**:
- [ ] macOS硬件指纹生成支持Intel和Apple Silicon
- [ ] RSA-2048数字签名验证机制
- [ ] 频率限制和异常检测保护
- [ ] 离线激活模式支持
- [ ] 心跳检测和状态同步
- [ ] 用户友好的错误处理

### FR-003: 前端系统适配
**优先级**: 高
**描述**: 更新前端组件以适配新的API结构

**用户故事**:
作为管理员用户，我希望前端界面能够正确显示和操作许可证方案信息，不受后端字段重命名的影响。

**验收标准**:
- [ ] 所有表单组件字段名更新
- [ ] 表格显示列配置更新
- [ ] TypeScript类型定义更新
- [ ] API调用代码适配新字段
- [ ] 验证规则和错误处理更新

### FR-004: 数据迁移与兼容性
**优先级**: 中
**描述**: 确保现有数据的平滑迁移和系统兼容性

**用户故事**:
作为系统运维人员，我希望系统更新过程中不会丢失任何现有数据，并且能够平滑过渡到新版本。

**验收标准**:
- [ ] 数据库字段迁移脚本执行成功
- [ ] 历史数据完整性验证
- [ ] API版本兼容性处理
- [ ] 客户端SDK更新指南

## 🔧 技术需求

### TR-001: 数据库层更新
- 执行字段重命名迁移
- 保持数据完整性和一致性
- 优化索引和查询性能

### TR-002: API层重构  
- 更新序列化器字段映射
- 实现向后兼容性处理
- 优化响应格式和错误处理

### TR-003: 前端层适配
- 更新Vue.js/React组件
- 修改TypeScript类型定义
- 适配API调用和数据处理逻辑

### TR-004: 测试体系更新
- 更新单元测试用例
- 修改集成测试场景
- 执行回归测试验证

## 🛡️ 安全需求

### SR-001: 数据安全保障
- 迁移过程中的数据加密保护
- 敏感信息的安全处理
- 访问权限控制验证

### SR-002: API安全增强
- RSA数字签名完整性验证
- 频率限制和异常检测
- 审计日志记录和监控

## 📊 性能需求

### PR-001: 响应时间要求
- API响应时间P95 < 500ms
- 前端页面加载时间 < 2s
- 数据库查询优化

### PR-002: 并发处理能力
- 支持1000+并发激活请求
- 前端组件渲染性能优化
- 缓存策略优化

## 🔄 兼容性需求

### CR-001: 向后兼容性
- 支持旧版本客户端过渡期使用
- API版本控制和路由
- 渐进式迁移支持

### CR-002: 跨平台兼容性
- macOS Intel和Apple Silicon支持
- Windows和Linux客户端兼容
- 浏览器兼容性保证

## ✅ 验收标准

### 功能验收
- [ ] 所有新字段名在API中正确显示
- [ ] 前端界面功能完全正常
- [ ] 许可证激活流程端到端测试通过
- [ ] 数据迁移完成且无数据丢失

### 性能验收
- [ ] API响应时间达标
- [ ] 前端加载性能满足要求
- [ ] 并发处理能力验证通过

### 安全验收
- [ ] 安全测试通过
- [ ] 权限控制验证正确
- [ ] 审计日志记录完整

### 兼容性验收
- [ ] 跨平台功能测试通过
- [ ] 浏览器兼容性测试通过
- [ ] 向后兼容性验证通过

## 📝 约束条件

### 技术约束
- 必须基于现有Django + Vue.js技术栈
- 保持与多租户架构的兼容性
- 遵循现有的代码规范和架构模式

### 时间约束
- 完整更新周期不超过2周
- 关键功能更新优先级最高
- 分阶段发布和验证

### 资源约束
- 利用现有开发团队资源
- 最小化对生产环境的影响
- 充分利用现有测试和部署基础设施

## 🚀 成功标准

更新完成后，系统应达到：
- ✅ 功能完整性：所有许可证相关功能正常工作
- ✅ 性能稳定性：系统性能指标达到或超过更新前水平
- ✅ 用户体验：界面操作流畅，错误处理友好
- ✅ 数据完整性：所有历史数据正确迁移和显示
- ✅ 安全合规性：安全机制正常运行，审计记录完整

---

*需求规范版本: v1.0*  
*创建日期: 2025年9月26日*  
*基于文档: temp0918/license_activation_api.md, temp0926/前端更新指南包*
